///<jscompress sourcefile="leaflet.js" />
/*
 Leaflet 1.0.0-rc.1 (6ea195a), a JS library for interactive maps. http://leafletjs.com
 (c) 2010-2015 Vladimir Agafonkin, (c) 2010-2011 CloudMade
*////<jscompress sourcefile="layerindex.js" />
/*
 * Spatial index of layer objects using RTree.js
 *////<jscompress sourcefile="rtmap.js" />
/*
 * this library depend on leafletjs ;
 * this public library
 * *////<jscompress sourcefile="location.js" />
/*
  location.js 微信定位相关
  依赖 rtmap.lbspoisdk, a JavaScript library for scan beacon to ask position in indoor maps. http://www.rtmap.com
*/

//定义
(function(f,m,n){function z(){var a=f.L;c.noConflict=function(){f.L=a;return this};f.L=c}var c={version:"1.0.0-rc.1"};"object"===typeof module&&"object"===typeof module.exports?module.exports=c:"function"===typeof define&&define.amd&&define(c);"undefined"!==typeof f&&z();c.Util={extend:function(a){var b,d,c,g;d=1;for(c=arguments.length;d<c;d++)for(b in g=arguments[d],g)a[b]=g[b];return a},create:Object.create||function(){function a(){}return function(b){a.prototype=b;return new a}}(),bind:function(a,b){var d=Array.prototype.slice;if(a.bind)return a.bind.apply(a,d.call(arguments,1));var c=d.call(arguments,2);return function(){return a.apply(b,c.length?c.concat(d.call(arguments)):arguments)}},stamp:function(a){a._leaflet_id=a._leaflet_id||++c.Util.lastId;return a._leaflet_id},lastId:0,throttle:function(a,b,d){var c,g,l,f;f=function(){c=!1;g&&(l.apply(d,g),g=!1)};return l=function(){c?g=arguments:(a.apply(d,arguments),setTimeout(f,b),c=!0)}},wrapNum:function(a,b,d){var c=b[1];b=b[0];var g=c-b;return a===c&&d?a:((a-b)%g+g)%g+b},falseFn:function(){return!1},formatNum:function(a,b){var d=Math.pow(10,b||5);return Math.round(a*d)/d},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return c.Util.trim(a).split(/\s+/)},setOptions:function(a,b){a.hasOwnProperty("options")||(a.options=a.options?c.Util.create(a.options):{});for(var d in b)a.options[d]=b[d];return a.options},getParamString:function(a,b,d){var c=[],g;for(g in a)c.push(encodeURIComponent(d?g.toUpperCase():g)+"\x3d"+encodeURIComponent(a[g]));return(b&&-1!==b.indexOf("?")?"\x26":"?")+c.join("\x26")},template:function(a,b){return a.replace(c.Util.templateRe,function(a,c){var g=b[c];if(g===n)throw Error("No value provided for variable "+a);"function"===typeof g&&(g=g(b));return g})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},indexOf:function(a,b){for(var d=0;d<a.length;d++)if(a[d]===b)return d;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs\x3d"};(function(){function a(a){return f["webkit"+a]||f["moz"+a]||f["ms"+a]}function b(a){var b=+new Date,c=Math.max(0,16-(b-d));d=b+c;return f.setTimeout(a,c)}var d=0,e=f.requestAnimationFrame||a("RequestAnimationFrame")||b,g=f.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(a){f.clearTimeout(a)};c.Util.requestAnimFrame=function(a,d,g){if(g&&e===b)a.call(d);else return e.call(f,c.bind(a,d))};c.Util.cancelAnimFrame=function(a){a&&g.call(f,a)}})();c.extend=c.Util.extend;c.bind=c.Util.bind;c.stamp=c.Util.stamp;c.setOptions=c.Util.setOptions;c.Class=function(){};c.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments);this.callInitHooks()},d=b.__super__=this.prototype,e=c.Util.create(d);e.constructor=b;b.prototype=e;for(var g in this)this.hasOwnProperty(g)&&"prototype"!==g&&(b[g]=this[g]);a.statics&&(c.extend(b,a.statics),delete a.statics);a.includes&&(c.Util.extend.apply(null,[e].concat(a.includes)),delete a.includes);e.options&&(a.options=c.Util.extend(c.Util.create(e.options),a.options));c.extend(e,a);e._initHooks=[];e.callInitHooks=function(){if(!this._initHooksCalled){d.callInitHooks&&d.callInitHooks.call(this);this._initHooksCalled=!0;for(var a=0,b=e._initHooks.length;a<b;a++)e._initHooks[a].call(this)}};return b};c.Class.include=function(a){c.extend(this.prototype,a);return this};c.Class.mergeOptions=function(a){c.extend(this.prototype.options,a);return this};c.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1);this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push("function"===typeof a?a:function(){this[a].apply(this,b)});return this};c.Evented=c.Class.extend({on:function(a,b,d){if("object"===typeof a)for(var e in a)this._on(e,a[e],b);else{a=c.Util.splitWords(a);e=0;for(var g=a.length;e<g;e++)this._on(a[e],b,d)}return this},off:function(a,b,d){if(a)if("object"===typeof a)for(var e in a)this._off(e,a[e],b);else{a=c.Util.splitWords(a);e=0;for(var g=a.length;e<g;e++)this._off(a[e],b,d)}else delete this._events;return this},_on:function(a,b,d){var e=this._events=this._events||{},g=d&&d!==this&&c.stamp(d);if(g){var l=a+"_idx";a+="_len";l=e[l]=e[l]||{};g=c.stamp(b)+"_"+g;l[g]||(l[g]={fn:b,ctx:d},e[a]=(e[a]||0)+1)}else e[a]=e[a]||[],e[a].push({fn:b})},_off:function(a,b,d){var e=this._events,g=a+"_idx",l=a+"_len";if(e)if(b){d=d&&d!==this&&c.stamp(d);var f;if(d)b=c.stamp(b)+"_"+d,(g=e[g])&&g[b]&&(f=g[b],delete g[b],e[l]--);else if(g=e[a])for(e=0,l=g.length;e<l;e++)if(g[e].fn===b){f=g[e];g.splice(e,1);break}f&&(f.fn=c.Util.falseFn)}else delete e[a],delete e[g],delete e[l]},fire:function(a,b,d){if(!this.listens(a,d))return this;b=c.Util.extend({},b,{type:a,target:this});var e=this._events;if(e){var g=e[a+"_idx"],l,f;if(e[a])for(l=e[a].slice(),a=0,e=l.length;a<e;a++)l[a].fn.call(this,b);for(f in g)g[f].fn.call(g[f].ctx,b)}d&&this._propagateEvent(b);return this},listens:function(a,b){var d=this._events;if(d&&(d[a]||d[a+"_len"]))return!0;if(b)for(var c in this._eventParents)if(this._eventParents[c].listens(a,b))return!0;return!1},once:function(a,b,d){if("object"===typeof a){for(var e in a)this.once(e,a[e],b);return this}var g=c.bind(function(){this.off(a,b,d).off(a,g,d)},this);return this.on(a,b,d).on(a,g,d)},addEventParent:function(a){this._eventParents=this._eventParents||{};this._eventParents[c.stamp(a)]=a;return this},removeEventParent:function(a){this._eventParents&&delete this._eventParents[c.stamp(a)];return this},_propagateEvent:function(a){for(var b in this._eventParents)this._eventParents[b].fire(a.type,c.extend({layer:a.target},a),!0)}});var h=c.Evented.prototype;h.addEventListener=h.on;h.removeEventListener=h.clearAllEventListeners=h.off;h.addOneTimeEventListener=h.once;h.fireEvent=h.fire;h.hasEventListeners=h.listens;c.Mixin={Events:h};(function(){var a=navigator.userAgent.toLowerCase(),b=m.documentElement,d="ActiveXObject"in f,e=-1!==a.indexOf("webkit"),g=-1!==a.indexOf("phantom"),l=-1!==a.search("android [23]"),E=-1!==a.indexOf("chrome"),k=-1!==a.indexOf("gecko")&&!e&&!f.opera&&!d,p="undefined"!==typeof orientation||-1!==a.indexOf("mobile"),h=!f.PointerEvent&&f.MSPointerEvent,q=f.PointerEvent||h,t=d&&"transition"in b.style,v="WebKitCSSMatrix"in f&&"m11"in new f.WebKitCSSMatrix&&!l,w="MozPerspective"in b.style,b="OTransition"in b.style,z=!f.L_NO_TOUCH&&(q||"ontouchstart"in f||f.DocumentTouch&&m instanceof f.DocumentTouch);c.Browser={ie:d,ielt9:d&&!m.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in m),webkit:e,gecko:k,android:-1!==a.indexOf("android"),android23:l,chrome:E,safari:!E&&-1!==a.indexOf("safari"),ie3d:t,webkit3d:v,gecko3d:w,opera12:b,any3d:!f.L_DISABLE_3D&&(t||v||w)&&!b&&!g,mobile:p,mobileWebkit:p&&e,mobileWebkit3d:p&&v,mobileOpera:p&&f.opera,mobileGecko:p&&k,touch:!!z,msPointer:!!h,pointer:!!q,retina:1<(f.devicePixelRatio||f.screen.deviceXDPI/f.screen.logicalXDPI)}})();c.Point=function(a,b,d){this.x=d?Math.round(a):a;this.y=d?Math.round(b):b};c.Point.prototype={clone:function(){return new c.Point(this.x,this.y)},add:function(a){return this.clone()._add(c.point(a))},_add:function(a){this.x+=a.x;this.y+=a.y;return this},subtract:function(a){return this.clone()._subtract(c.point(a))},_subtract:function(a){this.x-=a.x;this.y-=a.y;return this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){this.x/=a;this.y/=a;return this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){this.x*=a;this.y*=a;return this},scaleBy:function(a){return new c.Point(this.x*a.x,this.y*a.y)},unscaleBy:function(a){return new c.Point(this.x/a.x,this.y/a.y)},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){return this.clone()._ceil()},_ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},distanceTo:function(a){a=c.point(a);var b=a.x-this.x;a=a.y-this.y;return Math.sqrt(b*b+a*a)},equals:function(a){a=c.point(a);return a.x===this.x&&a.y===this.y},contains:function(a){a=c.point(a);return Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+c.Util.formatNum(this.x)+", "+c.Util.formatNum(this.y)+")"}};c.point=function(a,b,d){return a instanceof c.Point?a:c.Util.isArray(a)?new c.Point(a[0],a[1]):a===n||null===a?a:new c.Point(a,b,d)};c.Bounds=function(a,b){if(a)for(var d=b?[a,b]:a,c=0,g=d.length;c<g;c++)this.extend(d[c])};c.Bounds.prototype={extend:function(a){a=c.point(a);this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone());return this},getCenter:function(a){return new c.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new c.Point(this.min.x,this.max.y)},getTopRight:function(){return new c.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(a){var b;a="number"===typeof a[0]||a instanceof c.Point?c.point(a):c.bounds(a);a instanceof c.Bounds?(b=a.min,a=a.max):b=a;return b.x>=this.min.x&&a.x<=this.max.x&&b.y>=this.min.y&&a.y<=this.max.y},intersects:function(a){a=c.bounds(a);var b=this.min,d=this.max,e=a.min;a=a.max;var g=a.y>=b.y&&e.y<=d.y;return a.x>=b.x&&e.x<=d.x&&g},overlaps:function(a){a=c.bounds(a);var b=this.min,d=this.max,e=a.min;a=a.max;var g=a.y>b.y&&e.y<d.y;return a.x>b.x&&e.x<d.x&&g},isValid:function(){return!(!this.min||!this.max)}};c.bounds=function(a,b){return!a||a instanceof c.Bounds?a:new c.Bounds(a,b)};c.Transformation=function(a,b,d,c){this._a=a;this._b=b;this._c=d;this._d=c};c.Transformation.prototype={transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){b=b||1;a.x=b*(this._a*a.x+this._b);a.y=b*(this._c*a.y+this._d);return a},untransform:function(a,b){b=b||1;return new c.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}};c.DomUtil={get:function(a){return"string"===typeof a?m.getElementById(a):a},getStyle:function(a,b){var d=a.style[b]||a.currentStyle&&a.currentStyle[b];d&&"auto"!==d||!m.defaultView||(d=(d=m.defaultView.getComputedStyle(a,null))?d[b]:null);return"auto"===d?null:d},create:function(a,b,d){a=m.createElement(a);a.className=b;d&&d.appendChild(a);return a},remove:function(a){var b=a.parentNode;b&&b.removeChild(a)},empty:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},toFront:function(a){a.parentNode.appendChild(a)},toBack:function(a){var b=a.parentNode;b.insertBefore(a,b.firstChild)},hasClass:function(a,b){if(a.classList!==n)return a.classList.contains(b);var d=c.DomUtil.getClass(a);return 0<d.length&&(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(d)},addClass:function(a,b){if(a.classList!==n)for(var d=c.Util.splitWords(b),e=0,g=d.length;e<g;e++)a.classList.add(d[e]);else c.DomUtil.hasClass(a,b)||(d=c.DomUtil.getClass(a),c.DomUtil.setClass(a,(d?d+" ":"")+b))},removeClass:function(a,b){a.classList!==n?a.classList.remove(b):c.DomUtil.setClass(a,c.Util.trim((" "+c.DomUtil.getClass(a)+" ").replace(" "+b+" "," ")))},setClass:function(a,b){a.className.baseVal===n?a.className=b:a.className.baseVal=b},getClass:function(a){return a.className.baseVal===n?a.className:a.className.baseVal},setOpacity:function(a,b){"opacity"in a.style?a.style.opacity=b:"filter"in a.style&&c.DomUtil._setOpacityIE(a,b)},_setOpacityIE:function(a,b){var d=!1;try{d=a.filters.item("DXImageTransform.Microsoft.Alpha")}catch(c){if(1===b)return}b=Math.round(100*b);d?(d.Enabled=100!==b,d.Opacity=b):a.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(opacity\x3d"+b+")"},testProp:function(a){for(var b=m.documentElement.style,d=0;d<a.length;d++)if(a[d]in b)return a[d];return!1},setTransform:function(a,b,d){b=b||new c.Point(0,0);a.style[c.DomUtil.TRANSFORM]=(c.Browser.ie3d?"translate("+b.x+"px,"+b.y+"px)":"translate3d("+b.x+"px,"+b.y+"px,0)")+(d?" scale("+d+")":"")},setPosition:function(a,b){a._leaflet_pos=b;c.Browser.any3d?c.DomUtil.setTransform(a,b):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._leaflet_pos||new c.Point(0,0)}};(function(){c.DomUtil.TRANSFORM=c.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var a=c.DomUtil.TRANSITION=c.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);c.DomUtil.TRANSITION_END="webkitTransition"===a||"OTransition"===a?a+"End":"transitionend";if("onselectstart"in m)c.DomUtil.disableTextSelection=function(){c.DomEvent.on(f,"selectstart",c.DomEvent.preventDefault)},c.DomUtil.enableTextSelection=function(){c.DomEvent.off(f,"selectstart",c.DomEvent.preventDefault)};else{var b=c.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);c.DomUtil.disableTextSelection=function(){if(b){var a=m.documentElement.style;this._userSelect=a[b];a[b]="none"}};c.DomUtil.enableTextSelection=function(){b&&(m.documentElement.style[b]=this._userSelect,delete this._userSelect)}}c.DomUtil.disableImageDrag=function(){c.DomEvent.on(f,"dragstart",c.DomEvent.preventDefault)};c.DomUtil.enableImageDrag=function(){c.DomEvent.off(f,"dragstart",c.DomEvent.preventDefault)};c.DomUtil.preventOutline=function(a){for(;-1===a.tabIndex;)a=a.parentNode;a&&a.style&&(c.DomUtil.restoreOutline(),this._outlineElement=a,this._outlineStyle=a.style.outline,a.style.outline="none",c.DomEvent.on(f,"keydown",c.DomUtil.restoreOutline,this))};c.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,c.DomEvent.off(f,"keydown",c.DomUtil.restoreOutline,this))}})();c.LatLng=function(a,b,d){if(isNaN(a)||isNaN(b))throw Error("Invalid LatLng object: ("+a+", "+b+")");this.lat=+a;this.lng=+b;d!==n&&(this.alt=+d)};c.LatLng.prototype={equals:function(a,b){if(!a)return!1;a=c.latLng(a);return Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng))<=(b===n?1E-9:b)},toString:function(a){return"LatLng("+c.Util.formatNum(this.lat,a)+", "+c.Util.formatNum(this.lng,a)+")"},distanceTo:function(a){return c.CRS.Earth.distance(this,c.latLng(a))},wrap:function(){return c.CRS.Earth.wrapLatLng(this)},toBounds:function(a){a=180*a/40075017;var b=a/Math.cos(Math.PI/180*this.lat);return c.latLngBounds([this.lat-a,this.lng-b],[this.lat+a,this.lng+b])},clone:function(){return new c.LatLng(this.lat,this.lng,this.alt)}};c.latLng=function(a,b,d){return a instanceof c.LatLng?a:c.Util.isArray(a)&&"object"!==typeof a[0]?3===a.length?new c.LatLng(a[0],a[1],a[2]):2===a.length?new c.LatLng(a[0],a[1]):null:a===n||null===a?a:"object"===typeof a&&"lat"in a?new c.LatLng(a.lat,"lng"in a?a.lng:a.lon,a.alt):b===n?null:new c.LatLng(a,b,d)};c.LatLngBounds=function(a,b){if(a)for(var d=b?[a,b]:a,c=0,g=d.length;c<g;c++)this.extend(d[c])};c.LatLngBounds.prototype={extend:function(a){var b=this._southWest,d=this._northEast,e;if(a instanceof c.LatLng)e=a;else if(a instanceof c.LatLngBounds){if(e=a._southWest,a=a._northEast,!e||!a)return this}else return a?this.extend(c.latLng(a)||c.latLngBounds(a)):this;b||d?(b.lat=Math.min(e.lat,b.lat),b.lng=Math.min(e.lng,b.lng),d.lat=Math.max(a.lat,d.lat),d.lng=Math.max(a.lng,d.lng)):(this._southWest=new c.LatLng(e.lat,e.lng),this._northEast=new c.LatLng(a.lat,a.lng));return this},pad:function(a){var b=this._southWest,d=this._northEast,e=Math.abs(b.lat-d.lat)*a;a*=Math.abs(b.lng-d.lng);return new c.LatLngBounds(new c.LatLng(b.lat-e,b.lng-a),new c.LatLng(d.lat+e,d.lng+a))},getCenter:function(){return new c.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new c.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new c.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(a){a="number"===typeof a[0]||a instanceof c.LatLng?c.latLng(a):c.latLngBounds(a);var b=this._southWest,d=this._northEast,e;a instanceof c.LatLngBounds?(e=a.getSouthWest(),a=a.getNorthEast()):e=a;return e.lat>=b.lat&&a.lat<=d.lat&&e.lng>=b.lng&&a.lng<=d.lng},intersects:function(a){a=c.latLngBounds(a);var b=this._southWest,d=this._northEast,e=a.getSouthWest();a=a.getNorthEast();var g=a.lng>=b.lng&&e.lng<=d.lng;return a.lat>=b.lat&&e.lat<=d.lat&&g},overlaps:function(a){a=c.latLngBounds(a);var b=this._southWest,d=this._northEast,e=a.getSouthWest();a=a.getNorthEast();var g=a.lng>b.lng&&e.lng<d.lng;return a.lat>b.lat&&e.lat<d.lat&&g},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join()},equals:function(a){if(!a)return!1;a=c.latLngBounds(a);return this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())},isValid:function(){return!(!this._southWest||!this._northEast)}};c.latLngBounds=function(a,b){return a instanceof c.LatLngBounds?a:new c.LatLngBounds(a,b)};c.Projection={};c.Projection.LonLat={project:function(a){return new c.Point(a.lng,a.lat)},unproject:function(a){return new c.LatLng(a.y,a.x)},bounds:c.bounds([-180,-90],[180,90])};c.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(a){var b=Math.PI/180,d=this.MAX_LATITUDE,d=Math.max(Math.min(d,a.lat),-d),d=Math.sin(d*b);return new c.Point(this.R*a.lng*b,this.R*Math.log((1+d)/(1-d))/2)},unproject:function(a){var b=180/Math.PI;return new c.LatLng((2*Math.atan(Math.exp(a.y/this.R))-Math.PI/2)*b,a.x*b/this.R)},bounds:function(){var a=6378137*Math.PI;return c.bounds([-a,-a],[a,a])}()};c.CRS={latLngToPoint:function(a,b){var d=this.projection.project(a),c=this.scale(b);return this.transformation._transform(d,c)},pointToLatLng:function(a,b){var d=this.scale(b),d=this.transformation.untransform(a,d);return this.projection.unproject(d)},project:function(a){return this.projection.project(a)},unproject:function(a){return this.projection.unproject(a)},scale:function(a){return 256*Math.pow(2,a)},zoom:function(a){return Math.log(a/256)/Math.LN2},getProjectedBounds:function(a){if(this.infinite)return null;var b=this.projection.bounds,d=this.scale(a);a=this.transformation.transform(b.min,d);b=this.transformation.transform(b.max,d);return c.bounds(a,b)},infinite:!1,wrapLatLng:function(a){var b=this.wrapLng?c.Util.wrapNum(a.lng,this.wrapLng,!0):a.lng,d=this.wrapLat?c.Util.wrapNum(a.lat,this.wrapLat,!0):a.lat;return c.latLng(d,b,a.alt)}};c.CRS.Simple=c.extend({},c.CRS,{projection:c.Projection.LonLat,transformation:new c.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)},zoom:function(a){return Math.log(a)/Math.LN2},distance:function(a,b){var d=b.lng-a.lng,c=b.lat-a.lat;return Math.sqrt(d*d+c*c)},infinite:!0});c.CRS.Earth=c.extend({},c.CRS,{wrapLng:[-180,180],R:6371E3,distance:function(a,b){var d=Math.PI/180,c=a.lat*d,g=b.lat*d,d=Math.sin(c)*Math.sin(g)+Math.cos(c)*Math.cos(g)*Math.cos((b.lng-a.lng)*d);return this.R*Math.acos(Math.min(d,1))}});c.CRS.EPSG3857=c.extend({},c.CRS.Earth,{code:"EPSG:3857",projection:c.Projection.SphericalMercator,transformation:function(){var a=.5/(Math.PI*c.Projection.SphericalMercator.R);return new c.Transformation(a,.5,-a,.5)}()});c.CRS.EPSG900913=c.extend({},c.CRS.EPSG3857,{code:"EPSG:900913"});c.CRS.EPSG4326=c.extend({},c.CRS.Earth,{code:"EPSG:4326",projection:c.Projection.LonLat,transformation:new c.Transformation(1/180,1,-1/180,.5)});c.Map=c.Evented.extend({options:{crs:c.CRS.EPSG3857,center:n,zoom:n,minZoom:n,maxZoom:n,layers:[],maxBounds:n,renderer:n,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(a,b){b=c.setOptions(this,b);this._initContainer(a);this._initLayout();this._onResize=c.bind(this._onResize,this);this._initEvents();b.maxBounds&&this.setMaxBounds(b.maxBounds);b.zoom!==n&&(this._zoom=this._limitZoom(b.zoom));b.center&&b.zoom!==n&&this.setView(c.latLng(b.center),b.zoom,{reset:!0});this._handlers=[];this._layers={};this._zoomBoundLayers={};this._sizeChanged=!0;this.callInitHooks();this._addLayers(this.options.layers)},setView:function(a,b){b=b===n?this.getZoom():b;this._resetView(c.latLng(a),b);return this},setZoom:function(a,b){return this._loaded?this.setView(this.getCenter(),a,{zoom:b}):(this._zoom=a,this)},zoomIn:function(a,b){a=a||(c.Browser.any3d?this.options.zoomDelta:1);return this.setZoom(this._zoom+a,b)},zoomOut:function(a,b){a=a||(c.Browser.any3d?this.options.zoomDelta:1);return this.setZoom(this._zoom-a,b)},setZoomAround:function(a,b,d){var e=this.getZoomScale(b),g=this.getSize().divideBy(2);a=(a instanceof c.Point?a:this.latLngToContainerPoint(a)).subtract(g).multiplyBy(1-1/e);g=this.containerPointToLatLng(g.add(a));return this.setView(g,b,{zoom:d})},_getBoundsCenterZoom:function(a,b){b=b||{};a=a.getBounds?a.getBounds():c.latLngBounds(a);var d=c.point(b.paddingTopLeft||b.padding||[0,0]),e=c.point(b.paddingBottomRight||b.padding||[0,0]),g=this.getBoundsZoom(a,!1,d.add(e)),g="number"===typeof b.maxZoom?Math.min(b.maxZoom,g):g,d=e.subtract(d).divideBy(2),e=this.project(a.getSouthWest(),g),l=this.project(a.getNorthEast(),g);return{center:this.unproject(e.add(l).divideBy(2).add(d),g),zoom:g}},fitBounds:function(a,b){a=c.latLngBounds(a);if(!a.isValid())throw Error("Bounds are not valid.");var d=this._getBoundsCenterZoom(a,b);return this.setView(d.center,d.zoom,b)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,b){return this.setView(a,this._zoom,{pan:b})},panBy:function(a){this.fire("movestart");this._rawPanBy(c.point(a));this.fire("move");return this.fire("moveend")},setMaxBounds:function(a){if(a=c.latLngBounds(a))this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds);else return this.off("moveend",this._panInsideMaxBounds);this.options.maxBounds=a;this._loaded&&this._panInsideMaxBounds();return this.on("moveend",this._panInsideMaxBounds)},setMinZoom:function(a){this.options.minZoom=a;return this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(a):this},setMaxZoom:function(a){this.options.maxZoom=a;return this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(a):this},panInsideBounds:function(a,b){this._enforcingBounds=!0;var d=this.getCenter(),e=this._limitCenter(d,this._zoom,c.latLngBounds(a));d.equals(e)||this.panTo(e,b);this._enforcingBounds=!1;return this},invalidateSize:function(a){if(!this._loaded)return this;a=c.extend({animate:!1,pan:!0},!0===a?{animate:!0}:a);var b=this.getSize();this._sizeChanged=!0;this._lastCenter=null;var d=this.getSize(),e=b.divideBy(2).round(),g=d.divideBy(2).round(),e=e.subtract(g);if(!e.x&&!e.y)return this;a.animate&&a.pan?this.panBy(e):(a.pan&&this._rawPanBy(e),this.fire("move"),a.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(c.bind(this.fire,this,"moveend"),200)):this.fire("moveend"));return this.fire("resize",{oldSize:b,newSize:d})},stop:function(){this.setZoom(this._limitZoom(this._zoom));this.options.zoomSnap||this.fire("viewreset");return this._stop()},addHandler:function(a,b){if(!b)return this;var d=this[a]=new b(this);this._handlers.push(d);this.options[a]&&d.enable();return this},remove:function(){this._initEvents(!0);try{delete this._container._leaflet}catch(a){this._container._leaflet=n}c.DomUtil.remove(this._mapPane);this._clearControlPos&&this._clearControlPos();this._clearHandlers();this._loaded&&this.fire("unload");for(var b in this._layers)this._layers[b].remove();return this},createPane:function(a,b){var d="leaflet-pane"+(a?" leaflet-"+a.replace("Pane","")+"-pane":""),d=c.DomUtil.create("div",d,b||this._mapPane);a&&(this._panes[a]=d);return d},getCenter:function(){this._checkIfLoaded();return this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var a=this.getPixelBounds(),b=this.unproject(a.getBottomLeft()),a=this.unproject(a.getTopRight());return new c.LatLngBounds(b,a)},getMinZoom:function(){return this.options.minZoom===n?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===n?this._layersMaxZoom===n?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(a,b,d){a=c.latLngBounds(a);d=c.point(d||[0,0]);var e=this.getZoom()||0,g=this.getMinZoom(),l=this.getMaxZoom(),f=a.getNorthWest(),k=a.getSouthEast();a=this.getSize();f=this.project(k,e).subtract(this.project(f,e)).add(d);d=c.Browser.any3d?this.options.zoomSnap:1;a=Math.min(a.x/f.x,a.y/f.y);e=this.getScaleZoom(a,e);d&&(e=Math.round(e/(d/100))*(d/100),e=b?Math.ceil(e/d)*d:Math.floor(e/d)*d);return Math.max(g,Math.min(l,e))},getSize:function(){if(!this._size||this._sizeChanged)this._size=new c.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1;return this._size.clone()},getPixelBounds:function(a,b){var d=this._getTopLeftPoint(a,b);return new c.Bounds(d,d.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._pixelOrigin},getPixelWorldBounds:function(a){return this.options.crs.getProjectedBounds(a===n?this.getZoom():a)},getPane:function(a){return"string"===typeof a?this._panes[a]:a},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a,b){var d=this.options.crs;b=b===n?this._zoom:b;return d.scale(a)/d.scale(b)},getScaleZoom:function(a,b){var d=this.options.crs;b=b===n?this._zoom:b;return d.zoom(a*d.scale(b))},project:function(a,b){b=b===n?this._zoom:b;return this.options.crs.latLngToPoint(c.latLng(a),b)},unproject:function(a,b){b=b===n?this._zoom:b;return this.options.crs.pointToLatLng(c.point(a),b)},layerPointToLatLng:function(a){a=c.point(a).add(this.getPixelOrigin());return this.unproject(a)},latLngToLayerPoint:function(a){return this.project(c.latLng(a))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(a){return this.options.crs.wrapLatLng(c.latLng(a))},distance:function(a,b){return this.options.crs.distance(c.latLng(a),c.latLng(b))},containerPointToLayerPoint:function(a){return c.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return c.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){a=this.containerPointToLayerPoint(c.point(a));return this.layerPointToLatLng(a)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(c.latLng(a)))},mouseEventToContainerPoint:function(a){return c.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){a=this._container=c.DomUtil.get(a);if(!a)throw Error("Map container not found.");if(a._leaflet)throw Error("Map container is already initialized.");c.DomEvent.addListener(a,"scroll",this._onScroll,this);a._leaflet=!0},_initLayout:function(){var a=this._container;this._fadeAnimated=this.options.fadeAnimation&&c.Browser.any3d;c.DomUtil.addClass(a,"leaflet-container"+(c.Browser.touch?" leaflet-touch":"")+(c.Browser.retina?" leaflet-retina":"")+(c.Browser.ielt9?" leaflet-oldie":"")+(c.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var b=c.DomUtil.getStyle(a,"position");"absolute"!==b&&"relative"!==b&&"fixed"!==b&&(a.style.position="relative");this._initPanes();this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._paneRenderers={};this._mapPane=this.createPane("mapPane",this._container);c.DomUtil.setPosition(this._mapPane,new c.Point(0,0));this.createPane("tilePane");this.createPane("shadowPane");this.createPane("overlayPane");this.createPane("markerPane");this.createPane("popupPane");this.options.markerZoomAnimation||(c.DomUtil.addClass(a.markerPane,"leaflet-zoom-hide"),c.DomUtil.addClass(a.shadowPane,"leaflet-zoom-hide"))},_resetView:function(a,b){c.DomUtil.setPosition(this._mapPane,new c.Point(0,0));var d=!this._loaded;this._loaded=!0;b=this._limitZoom(b);this.fire("viewprereset");var e=this._zoom!==b;this._moveStart(e)._move(a,b)._moveEnd(e);this.fire("viewreset");d&&this.fire("load")},_moveStart:function(a){a&&this.fire("zoomstart");return this.fire("movestart")},_move:function(a,b,d){b===n&&(b=this._zoom);var c=this._zoom!==b;this._zoom=b;this._lastCenter=a;this._pixelOrigin=this._getNewPixelOrigin(a);(c||d&&d.pinch)&&this.fire("zoom",d);return this.fire("move",d)},_moveEnd:function(a){a&&this.fire("zoomend");return this.fire("moveend")},_stop:function(){c.Util.cancelAnimFrame(this._flyToFrame);this._panAnim&&this._panAnim.stop();return this},_rawPanBy:function(a){c.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw Error("Set map center and zoom first.");},_initEvents:function(a){if(c.DomEvent){this._targets={};this._targets[c.stamp(this._container)]=this;a=a?"off":"on";c.DomEvent[a](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this);if(this.options.trackResize)c.DomEvent[a](f,"resize",this._onResize,this);if(c.Browser.any3d&&this.options.transform3DLimit)this[a]("moveend",this._onMoveEnd)}},_onResize:function(){c.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=c.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0;this._container.scrollLeft=0},_onMoveEnd:function(){var a=this._getMapPanePos();Math.max(Math.abs(a.x),Math.abs(a.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(a,b){for(var d=[],e,g="mouseout"===b||"mouseover"===b,l=a.target||a.srcElement,f=!1;l;){if((e=this._targets[c.stamp(l)])&&("click"===b||"preclick"===b)&&!a._simulated&&this._draggableMoved(e)){f=!0;break}if(e&&e.listens(b,!0)){if(g&&!c.DomEvent._isExternalTarget(l,a))break;d.push(e);if(g)break}if(l===this._container)break;l=l.parentNode}d.length||f||g||!c.DomEvent._isExternalTarget(l,a)||(d=[this]);return d},_handleDOMEvent:function(a){if(this._loaded&&!c.DomEvent._skipped(a)){var b="keypress"===a.type&&13===a.keyCode?"click":a.type;if("click"===a.type){var d=c.Util.extend({},a);d.type="preclick";this._handleDOMEvent(d)}"mousedown"===b&&c.DomUtil.preventOutline(a.target||a.srcElement);this._fireDOMEvent(a,b)}},_fireDOMEvent:function(a,b,d){if(!a._stopped&&(d=(d||[]).concat(this._findEventTargets(a,b)),d.length)){var e=d[0];"contextmenu"===b&&e.listens(b,!0)&&c.DomEvent.preventDefault(a);var g={originalEvent:a};if("keypress"!==a.type){var l=e instanceof c.Marker;g.containerPoint=l?this.latLngToContainerPoint(e.getLatLng()):this.mouseEventToContainerPoint(a);g.layerPoint=this.containerPointToLayerPoint(g.containerPoint);g.latlng=l?e.getLatLng():this.layerPointToLatLng(g.layerPoint)}for(a=0;a<d.length&&!(d[a].fire(b,g,!1),g.originalEvent._stopped||d[a].options.nonBubblingEvents&&-1!==c.Util.indexOf(d[a].options.nonBubblingEvents,b));a++);}},_draggableMoved:function(a){a=a.options.draggable?a:this;return a.dragging&&a.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var a=0,b=this._handlers.length;a<b;a++)this._handlers[a].disable()},whenReady:function(a,b){if(this._loaded)a.call(b||this,{target:this});else this.on("load",a,b);return this},_getMapPanePos:function(){return c.DomUtil.getPosition(this._mapPane)||new c.Point(0,0)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(a,b){return(a&&b!==n?this._getNewPixelOrigin(a,b):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(a,b){var d=this.getSize()._divideBy(2);return this.project(a,b)._subtract(d)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(a,b,d){d=this._getNewPixelOrigin(d,b);return this.project(a,b)._subtract(d)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(a,b,d){if(!d)return a;var e=this.project(a,b),g=this.getSize().divideBy(2),g=new c.Bounds(e.subtract(g),e.add(g));d=this._getBoundsOffset(g,d,b);return d.round().equals([0,0])?a:this.unproject(e.add(d),b)},_limitOffset:function(a,b){if(!b)return a;var d=this.getPixelBounds(),d=new c.Bounds(d.min.add(a),d.max.add(a));return a.add(this._getBoundsOffset(d,b))},_getBoundsOffset:function(a,b,d){d=c.bounds(this.project(b.getNorthEast(),d),this.project(b.getSouthWest(),d));b=d.min.subtract(a.min);d=d.max.subtract(a.max);a=this._rebound(b.x,-d.x);b=this._rebound(b.y,-d.y);return new c.Point(a,b)},_rebound:function(a,b){return 0<a+b?Math.round(a-b)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(b))},_limitZoom:function(a){var b=this.getMinZoom(),d=this.getMaxZoom(),e=c.Browser.any3d?this.options.zoomSnap:1;e&&(a=Math.round(a/e)*e);return Math.max(b,Math.min(d,a))}});c.map=function(a,b){return new c.Map(a,b)};c.Layer=c.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[]},addTo:function(a){a.addLayer(this);return this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(a){a&&a.removeLayer(this);return this},getPane:function(a){return this._map.getPane(a?this.options[a]||a:this.options.pane)},addInteractiveTarget:function(a){this._map._targets[c.stamp(a)]=this;return this},removeInteractiveTarget:function(a){delete this._map._targets[c.stamp(a)];return this},_layerAdd:function(a){a=a.target;if(a.hasLayer(this)){this._map=a;this._zoomAnimated=a._zoomAnimated;if(this.getEvents)a.on(this.getEvents(),this);this.onAdd(a);this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution());this.fire("add");a.fire("layeradd",{layer:this})}}});c.Map.include({addLayer:function(a){var b=c.stamp(a);if(this._layers[b])return a;this._layers[b]=a;a._mapToAdd=this;a.beforeAdd&&a.beforeAdd(this);this.whenReady(a._layerAdd,a);return this},removeLayer:function(a){var b=c.stamp(a);if(!this._layers[b])return this;if(this._loaded)a.onRemove(this);a.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(a.getAttribution());a.getEvents&&this.off(a.getEvents(),a);delete this._layers[b];this._loaded&&(this.fire("layerremove",{layer:a}),a.fire("remove"));a._map=a._mapToAdd=null;return this},hasLayer:function(a){return!!a&&c.stamp(a)in this._layers},eachLayer:function(a,b){for(var d in this._layers)a.call(b,this._layers[d]);return this},_addLayers:function(a){a=a?c.Util.isArray(a)?a:[a]:[];for(var b=0,d=a.length;b<d;b++)this.addLayer(a[b])},_addZoomLimit:function(a){if(isNaN(a.options.maxZoom)||!isNaN(a.options.minZoom))this._zoomBoundLayers[c.stamp(a)]=a,this._updateZoomLevels()},_removeZoomLimit:function(a){a=c.stamp(a);this._zoomBoundLayers[a]&&(delete this._zoomBoundLayers[a],this._updateZoomLevels())},_updateZoomLevels:function(){var a=Infinity,b=-Infinity,d=this._getZoomSpan(),c;for(c in this._zoomBoundLayers)var g=this._zoomBoundLayers[c].options,a=g.minZoom===n?a:Math.min(a,g.minZoom),b=g.maxZoom===n?b:Math.max(b,g.maxZoom);this._layersMaxZoom=-Infinity===b?n:b;this._layersMinZoom=Infinity===a?n:a;d!==this._getZoomSpan()&&this.fire("zoomlevelschange")}});c.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:c.bounds([-2.003750834279E7,-1.549657073972E7],[2.003750834279E7,1.876465623138E7]),project:function(a){var b=Math.PI/180,d=this.R,e=a.lat*b,g=this.R_MINOR/d,g=Math.sqrt(1-g*g),l=g*Math.sin(e),e=Math.tan(Math.PI/4-e/2)/Math.pow((1-l)/(1+l),g/2),e=-d*Math.log(Math.max(e,1E-10));return new c.Point(a.lng*b*d,e)},unproject:function(a){for(var b=180/Math.PI,d=this.R,e=this.R_MINOR/d,e=Math.sqrt(1-e*e),g=Math.exp(-a.y/d),l=Math.PI/2-2*Math.atan(g),f=0,k=.1;15>f&&1E-7<Math.abs(k);f++)k=e*Math.sin(l),k=Math.pow((1-k)/(1+k),e/2),k=Math.PI/2-2*Math.atan(g*k)-l,l+=k;return new c.LatLng(l*b,a.x*b/d)}};c.Projection.Mercator_ex={R:6378137,R_MINOR:6356752.314245179,bounds:c.bounds([-2.003750834279E7,-1.549657073972E7],[2.003750834279E7,1.876465623138E7]),project:function(a){return new c.Point(a.lat,a.lng)},unproject:function(a){return new c.LatLng(a.x,a.y)}};c.CRS.EPSG3395=c.extend({},c.CRS.Earth,{code:"EPSG:3395",projection:c.Projection.Mercator,transformation:function(){var a=.5/(Math.PI*c.Projection.Mercator.R);return new c.Transformation(a,.5,-a,.5)}()});c.GridLayer=c.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:c.Browser.mobile,updateInterval:200,attribution:null,zIndex:1,bounds:null,minZoom:0,noWrap:!1,pane:"tilePane"},initialize:function(a){c.setOptions(this,a)},onAdd:function(){this._initContainer();this._levels={};this._tiles={};this._resetView();this._update()},beforeAdd:function(a){a._addZoomLimit(this)},onRemove:function(a){this._removeAllTiles();c.DomUtil.remove(this._container);a._removeZoomLimit(this);this._tileZoom=this._container=null},bringToFront:function(){this._map&&(c.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max));return this},bringToBack:function(){this._map&&(c.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min));return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){this.options.opacity=a;this._updateOpacity();return this},setZIndex:function(a){this.options.zIndex=a;this._updateZIndex();return this},isLoading:function(){return this._loading},redraw:function(){this._map&&(this._removeAllTiles(),this._update());return this},getEvents:function(){var a={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};this.options.updateWhenIdle||(this._onMove||(this._onMove=c.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),a.move=this._onMove);this._zoomAnimated&&(a.zoomanim=this._animateZoom);return a},createTile:function(){return m.createElement("div")},getTileSize:function(){var a=this.options.tileSize;return a instanceof c.Point?a:new c.Point(a,a)},_updateZIndex:function(){this._container&&this.options.zIndex!==n&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(a){for(var b=this.getPane().children,d=-a(-Infinity,Infinity),c=0,g=b.length,l;c<g;c++)l=b[c].style.zIndex,b[c]!==this._container&&l&&(d=a(d,+l));isFinite(d)&&(this.options.zIndex=d+a(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!c.Browser.ielt9){c.DomUtil.setOpacity(this._container,this.options.opacity);var a=+new Date,b=!1,d=!1,e;for(e in this._tiles){var g=this._tiles[e];if(g.current&&g.loaded){var l=Math.min(1,(a-g.loaded)/200);c.DomUtil.setOpacity(g.el,l);1>l?b=!0:(g.active&&(d=!0),g.active=!0)}}d&&!this._noPrune&&this._pruneTiles();b&&(c.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=c.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=c.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),1>this.options.opacity&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var a=this._tileZoom,b=this.options.maxZoom;if(a===n)return n;for(var d in this._levels)this._levels[d].el.children.length||d===a?this._levels[d].el.style.zIndex=b-Math.abs(a-d):(c.DomUtil.remove(this._levels[d].el),this._removeTilesAtZoom(d),delete this._levels[d]);d=this._levels[a];var e=this._map;d||(d=this._levels[a]={},d.el=c.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),d.el.style.zIndex=b,d.origin=e.project(e.unproject(e.getPixelOrigin()),a).round(),d.zoom=a,this._setZoomTransform(d,e.getCenter(),e.getZoom()),c.Util.falseFn(d.el.offsetWidth));return this._level=d},_pruneTiles:function(){if(this._map){var a,b;b=this._map.getZoom();if(b>this.options.maxZoom||b<this.options.minZoom)this._removeAllTiles();else{for(a in this._tiles)b=this._tiles[a],b.retain=b.current;for(a in this._tiles)b=this._tiles[a],b.current&&!b.active&&(b=b.coords,this._retainParent(b.x,b.y,b.z,b.z-5)||this._retainChildren(b.x,b.y,b.z,b.z+2));for(a in this._tiles)this._tiles[a].retain||this._removeTile(a)}}},_removeTilesAtZoom:function(a){for(var b in this._tiles)this._tiles[b].coords.z===a&&this._removeTile(b)},_removeAllTiles:function(){for(var a in this._tiles)this._removeTile(a)},_invalidateAll:function(){for(var a in this._levels)c.DomUtil.remove(this._levels[a].el),delete this._levels[a];this._removeAllTiles();this._tileZoom=null},_retainParent:function(a,b,d,e){a=Math.floor(a/2);b=Math.floor(b/2);--d;var g=new c.Point(+a,+b);g.z=+d;g=this._tileCoordsToKey(g);if((g=this._tiles[g])&&g.active)return g.retain=!0;g&&g.loaded&&(g.retain=!0);return d>e?this._retainParent(a,b,d,e):!1},_retainChildren:function(a,b,d,e){for(var g=2*a;g<2*a+2;g++)for(var l=2*b;l<2*b+2;l++){var f=new c.Point(g,l);f.z=d+1;f=this._tileCoordsToKey(f);(f=this._tiles[f])&&f.active?f.retain=!0:(f&&f.loaded&&(f.retain=!0),d+1<e&&this._retainChildren(g,l,d+1,e))}},_resetView:function(a){a=a&&(a.pinch||a.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),a,a)},_animateZoom:function(a){this._setView(a.center,a.zoom,!0,a.noUpdate)},_setView:function(a,b,d,c){var g=Math.round(b);if(this.options.maxZoom!==n&&g>this.options.maxZoom||this.options.minZoom!==n&&g<this.options.minZoom)g=n;var l=g!==this._tileZoom;if(!c||l)this._tileZoom=g,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),g!==n&&this._update(a),d||this._pruneTiles(),this._noPrune=!!d;this._setZoomTransforms(a,b)},_setZoomTransforms:function(a,b){for(var d in this._levels)this._setZoomTransform(this._levels[d],a,b)},_setZoomTransform:function(a,b,d){var e=this._map.getZoomScale(d,a.zoom);b=a.origin.multiplyBy(e).subtract(this._map._getNewPixelOrigin(b,d)).round();c.Browser.any3d?c.DomUtil.setTransform(a.el,b,e):c.DomUtil.setPosition(a.el,b)},_resetGrid:function(){var a=this._map,b=a.options.crs,d=this._tileSize=this.getTileSize(),c=this._tileZoom,g=this._map.getPixelWorldBounds(this._tileZoom);g&&(this._globalTileRange=this._pxBoundsToTileRange(g));this._wrapX=b.wrapLng&&!this.options.noWrap&&[Math.floor(a.project([0,b.wrapLng[0]],c).x/d.x),Math.ceil(a.project([0,b.wrapLng[1]],c).x/d.y)];this._wrapY=b.wrapLat&&!this.options.noWrap&&[Math.floor(a.project([b.wrapLat[0],0],c).y/d.x),Math.ceil(a.project([b.wrapLat[1],0],c).y/d.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._resetView()},_getTiledPixelBounds:function(a){var b=this._map,d=b._animatingZoom?Math.max(b._animateToZoom,b.getZoom()):b.getZoom(),d=b.getZoomScale(d,this._tileZoom);a=b.project(a,this._tileZoom).floor();b=b.getSize().divideBy(2*d);return new c.Bounds(a.subtract(b),a.add(b))},_update:function(a){var b=this._map;if(b){var d=b.getZoom();a===n&&(a=b.getCenter());if(this._tileZoom!==n){var b=this._getTiledPixelBounds(a),e=this._pxBoundsToTileRange(b),g=e.getCenter(),b=[],l;for(l in this._tiles)this._tiles[l].current=!1;if(1<Math.abs(d-this._tileZoom))this._setView(a,d);else{for(d=e.min.y;d<=e.max.y;d++)for(a=e.min.x;a<=e.max.x;a++)if(l=new c.Point(a,d),l.z=this._tileZoom,this._isValidTile(l)){var f=this._tiles[this._tileCoordsToKey(l)];f?f.current=!0:b.push(l)}b.sort(function(a,b){return a.distanceTo(g)-b.distanceTo(g)});if(0!==b.length){this._loading||(this._loading=!0,this.fire("loading"));e=m.createDocumentFragment();for(a=0;a<b.length;a++)this._addTile(b[a],e);this._level.el.appendChild(e)}}}}},_isValidTile:function(a){var b=this._map.options.crs;if(!b.infinite){var d=this._globalTileRange;if(!b.wrapLng&&(a.x<d.min.x||a.x>d.max.x)||!b.wrapLat&&(a.y<d.min.y||a.y>d.max.y))return!1}if(!this.options.bounds)return!0;a=this._tileCoordsToBounds(a);return c.latLngBounds(this.options.bounds).overlaps(a)},_keyToBounds:function(a){return this._tileCoordsToBounds(this._keyToTileCoords(a))},_tileCoordsToBounds:function(a){var b=this._map,d=this.getTileSize(),e=a.scaleBy(d),d=e.add(d),e=b.wrapLatLng(b.unproject(e,a.z));a=b.wrapLatLng(b.unproject(d,a.z));return new c.LatLngBounds(e,a)},_tileCoordsToKey:function(a){return a.x+":"+a.y+":"+a.z},_keyToTileCoords:function(a){a=a.split(":");var b=new c.Point(+a[0],+a[1]);b.z=+a[2];return b},_removeTile:function(a){var b=this._tiles[a];b&&(c.DomUtil.remove(b.el),delete this._tiles[a],this.fire("tileunload",{tile:b.el,coords:this._keyToTileCoords(a)}))},_initTile:function(a){c.DomUtil.addClass(a,"leaflet-tile");var b=this.getTileSize();a.style.width=b.x+"px";a.style.height=b.y+"px";a.onselectstart=c.Util.falseFn;a.onmousemove=c.Util.falseFn;c.Browser.ielt9&&1>this.options.opacity&&c.DomUtil.setOpacity(a,this.options.opacity);c.Browser.android&&!c.Browser.android23&&(a.style.WebkitBackfaceVisibility="hidden")},_addTile:function(a,b){var d=this._getTilePos(a),e=this._tileCoordsToKey(a),g=this.createTile(this._wrapCoords(a),c.bind(this._tileReady,this,a));this._initTile(g);2>this.createTile.length&&c.Util.requestAnimFrame(c.bind(this._tileReady,this,a,null,g));c.DomUtil.setPosition(g,d);this._tiles[e]={el:g,coords:a,current:!0};b.appendChild(g);this.fire("tileloadstart",{tile:g,coords:a})},_tileReady:function(a,b,d){this._map&&(b&&this.fire("tileerror",{error:b,tile:d,coords:a}),b=this._tileCoordsToKey(a),d=this._tiles[b])&&(d.loaded=+new Date,this._map._fadeAnimated?(c.DomUtil.setOpacity(d.el,0),c.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=c.Util.requestAnimFrame(this._updateOpacity,this)):(d.active=!0,this._pruneTiles()),c.DomUtil.addClass(d.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:d.el,coords:a}),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),c.Browser.ielt9||!this._map._fadeAnimated?c.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(c.bind(this._pruneTiles,this),250)))},_getTilePos:function(a){return a.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(a){var b=new c.Point(this._wrapX?c.Util.wrapNum(a.x,this._wrapX):a.x,this._wrapY?c.Util.wrapNum(a.y,this._wrapY):a.y);b.z=a.z;return b},_pxBoundsToTileRange:function(a){var b=this.getTileSize();return new c.Bounds(a.min.unscaleBy(b).floor(),a.max.unscaleBy(b).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var a in this._tiles)if(!this._tiles[a].loaded)return!1;return!0}});c.gridLayer=function(a){return new c.GridLayer(a)};c.TileLayer=c.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(a,b){this._url=a;b=c.setOptions(this,b);b.detectRetina&&c.Browser.retina&&0<b.maxZoom&&(b.tileSize=Math.floor(b.tileSize/2),b.zoomOffset++,b.minZoom=Math.max(0,b.minZoom),b.maxZoom--);"string"===typeof b.subdomains&&(b.subdomains=b.subdomains.split(""));if(!c.Browser.android)this.on("tileunload",this._onTileRemove)},setUrl:function(a,b){this._url=a;b||this.redraw();return this},createTile:function(a,b){var d=m.createElement("img");c.DomEvent.on(d,"load",c.bind(this._tileOnLoad,this,b,d));c.DomEvent.on(d,"error",c.bind(this._tileOnError,this,b,d));this.options.crossOrigin&&(d.crossOrigin="");d.alt="";d.src=this.getTileUrl(a);return d},getTileUrl:function(a){var b={r:c.Browser.retina?"@2x":"",s:this._getSubdomain(a),x:a.x,y:a.y,z:this._getZoomForUrl()};this._map&&!this._map.options.crs.infinite&&(a=this._globalTileRange.max.y-a.y,this.options.tms&&(b.y=a),b["-y"]=a);return c.Util.template(this._url,c.extend(b,this.options))},_tileOnLoad:function(a,b){c.Browser.ielt9?setTimeout(c.bind(a,this,null,b),0):a(null,b)},_tileOnError:function(a,b,d){var c=this.options.errorTileUrl;c&&(b.src=c);a(d,b)},getTileSize:function(){var a=this._map,b=c.GridLayer.prototype.getTileSize.call(this),d=this._tileZoom+this.options.zoomOffset,e=this.options.maxNativeZoom;return null!==e&&d>e?b.divideBy(a.getZoomScale(e,d)).round():b},_onTileRemove:function(a){a.tile.onload=null},_getZoomForUrl:function(){var a=this.options,b=this._tileZoom;a.zoomReverse&&(b=a.maxZoom-b);b+=a.zoomOffset;return null!==a.maxNativeZoom?Math.min(b,a.maxNativeZoom):b},_getSubdomain:function(a){a=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[a]},_abortLoading:function(){var a,b;for(a in this._tiles)this._tiles[a].coords.z!==this._tileZoom&&(b=this._tiles[a].el,b.onload=c.Util.falseFn,b.onerror=c.Util.falseFn,b.complete||(b.src=c.Util.emptyImageUrl,c.DomUtil.remove(b)))}});c.tileLayer=function(a,b){return new c.TileLayer(a,b)};c.TileLayer.WMS=c.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(a,b){this._url=a;var d=c.extend({},this.defaultWmsParams),e;for(e in b)e in this.options||(d[e]=b[e]);b=c.setOptions(this,b);d.width=d.height=b.tileSize*(b.detectRetina&&c.Browser.retina?2:1);this.wmsParams=d},onAdd:function(a){this._crs=this.options.crs||a.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);this.wmsParams[1.3<=this._wmsVersion?"crs":"srs"]=this._crs.code;c.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(a){var b=this._tileCoordsToBounds(a),d=this._crs.project(b.getNorthWest()),b=this._crs.project(b.getSouthEast()),d=(1.3<=this._wmsVersion&&this._crs===c.CRS.EPSG4326?[b.y,d.x,d.y,b.x]:[d.x,b.y,b.x,d.y]).join(",");a=c.TileLayer.prototype.getTileUrl.call(this,a);return a+c.Util.getParamString(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"\x26BBOX\x3d":"\x26bbox\x3d")+d},setParams:function(a,b){c.extend(this.wmsParams,a);b||this.redraw();return this}});c.tileLayer.wms=function(a,b){return new c.TileLayer.WMS(a,b)};c.ImageOverlay=c.Layer.extend({options:{opacity:1,alt:"",interactive:!1,attribution:null},initialize:function(a,b,d){this._url=a;this._bounds=c.latLngBounds(b);c.setOptions(this,d)},onAdd:function(){this._image||(this._initImage(),1>this.options.opacity&&this._updateOpacity());this.options.interactive&&(c.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image));this.getPane().appendChild(this._image);this._reset()},onRemove:function(){c.DomUtil.remove(this._image);this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(a){this.options.opacity=a;this._image&&this._updateOpacity();return this},setStyle:function(a){a.opacity&&this.setOpacity(a.opacity);return this},bringToFront:function(){this._map&&c.DomUtil.toFront(this._image);return this},bringToBack:function(){this._map&&c.DomUtil.toBack(this._image);return this},setUrl:function(a){this._url=a;this._image&&(this._image.src=a);return this},setBounds:function(a){this._bounds=a;this._map&&this._reset();return this},getAttribution:function(){return this.options.attribution},getEvents:function(){var a={zoom:this._reset,viewreset:this._reset};this._zoomAnimated&&(a.zoomanim=this._animateZoom);return a},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var a=this._image=c.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));a.onselectstart=c.Util.falseFn;a.onmousemove=c.Util.falseFn;a.onload=c.bind(this.fire,this,"load");this.options.crossOrigin&&(a.crossOrigin="");a.src=this._url;a.alt=this.options.alt},_animateZoom:function(a){var b=this._map.getZoomScale(a.zoom);a=this._map._latLngToNewLayerPoint(this._bounds.getNorthWest(),a.zoom,a.center);c.DomUtil.setTransform(this._image,a,b)},_reset:function(){var a=this._image,b=new c.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),d=b.getSize();c.DomUtil.setPosition(a,b.min);a.style.width=d.x+"px";a.style.height=d.y+"px"},_updateOpacity:function(){c.DomUtil.setOpacity(this._image,this.options.opacity)}});c.imageOverlay=function(a,b,d){return new c.ImageOverlay(a,b,d)};c.Icon=c.Class.extend({initialize:function(a){c.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(a,b){var d=this._getIconUrl(a);if(!d){if("icon"===a)throw Error("iconUrl not set in Icon options (see the docs).");return null}d=this._createImg(d,b&&"IMG"===b.tagName?b:null);this._setIconStyles(d,a);return d},_setIconStyles:function(a,b){var d=this.options,e=c.point(d[b+"Size"]),g=c.point("shadow"===b&&d.shadowAnchor||d.iconAnchor||e&&e.divideBy(2,!0));a.className="leaflet-marker-"+b+" "+(d.className||"");g&&(a.style.marginLeft=-g.x+"px",a.style.marginTop=-g.y+"px");e&&(a.style.width=e.x+"px",a.style.height=e.y+"px")},_createImg:function(a,b){b=b||m.createElement("img");b.src=a;return b},_getIconUrl:function(a){return c.Browser.retina&&this.options[a+"RetinaUrl"]||this.options[a+"Url"]}});c.icon=function(a){return new c.Icon(a)};c.Icon.Default=c.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(a){var b=a+"Url";if(this.options[b])return this.options[b];b=c.Icon.Default.imagePath;if(!b)throw Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return b+"/marker-"+a+(c.Browser.retina&&"icon"===a?"-2x":"")+".png"}});c.Icon.Default.imagePath=function(){var a=m.getElementsByTagName("script"),b=/[\/^]rtmap_sdk[\-\._]?([\w\-\._]*)\.js\??/,d,c,g;d=0;for(c=a.length;d<c;d++)if(g=a[d].src||"",g.match(b))return a=g.split(b)[0],(a?a+"/":"")+"images"}();c.Marker=c.Layer.extend({options:{icon:new c.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(a,b){c.setOptions(this,b);this._latlng=c.latLng(a)},onAdd:function(a){this._zoomAnimated=this._zoomAnimated&&a.options.markerZoomAnimation;this._initIcon();this.update()},onRemove:function(){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks());this._removeIcon();this._removeShadow()},getEvents:function(){var a={zoom:this.update,viewreset:this.update};this._zoomAnimated&&(a.zoomanim=this._animateZoom);return a},getLatLng:function(){return this._latlng},setLatLng:function(a){var b=this._latlng;this._latlng=c.latLng(a);this.update();return this.fire("move",{oldLatLng:b,latlng:this._latlng})},setZIndexOffset:function(a){this.options.zIndexOffset=a;return this.update()},setIcon:function(a){this.options.icon=a;this._map&&(this._initIcon(),this.update());this._popup&&this.bindPopup(this._popup,this._popup.options);return this},getElement:function(){return this._icon},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a)}return this},_initIcon:function(){var a=this.options,b="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),d=a.icon.createIcon(this._icon),e=!1;d!==this._icon&&(this._icon&&this._removeIcon(),e=!0,a.title&&(d.title=a.title),a.alt&&(d.alt=a.alt));c.DomUtil.addClass(d,b);a.keyboard&&(d.tabIndex="0");this._icon=d;if(a.riseOnHover)this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var d=a.icon.createShadow(this._shadow),g=!1;d!==this._shadow&&(this._removeShadow(),g=!0);d&&c.DomUtil.addClass(d,b);this._shadow=d;1>a.opacity&&this._updateOpacity();e&&this.getPane().appendChild(this._icon);this._initInteraction();d&&g&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex});c.DomUtil.remove(this._icon);this.removeInteractiveTarget(this._icon);this._icon=null},_removeShadow:function(){this._shadow&&c.DomUtil.remove(this._shadow);this._shadow=null},_setPos:function(a){c.DomUtil.setPosition(this._icon,a);this._shadow&&c.DomUtil.setPosition(this._shadow,a);this._zIndex=a.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){a=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(a)},_initInteraction:function(){if(this.options.interactive&&(c.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),c.Handler.MarkerDrag)){var a=this.options.draggable;this.dragging&&(a=this.dragging.enabled(),this.dragging.disable());this.dragging=new c.Handler.MarkerDrag(this);a&&this.dragging.enable()}},setOpacity:function(a){this.options.opacity=a;this._map&&this._updateOpacity();return this},_updateOpacity:function(){var a=this.options.opacity;c.DomUtil.setOpacity(this._icon,a);this._shadow&&c.DomUtil.setOpacity(this._shadow,a)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});c.marker=function(a,b){return new c.Marker(a,b)};c.DivIcon=c.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(a){a=a&&"DIV"===a.tagName?a:m.createElement("div");var b=this.options;a.innerHTML=!1!==b.html?b.html:"";b.bgPos&&(b=c.point(b.bgPos),a.style.backgroundPosition=-b.x+"px "+-b.y+"px");this._setIconStyles(a,"icon");return a},createShadow:function(){return null}});c.divIcon=function(a){return new c.DivIcon(a)};c.Map.mergeOptions({closePopupOnClick:!0});c.Popup=c.Layer.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,offset:[0,7],autoClose:!0,zoomAnimation:!0,className:"",pane:"popupPane"},initialize:function(a,b){c.setOptions(this,a);this._source=b},onAdd:function(a){this._zoomAnimated=this._zoomAnimated&&this.options.zoomAnimation;this._container||this._initLayout();a._fadeAnimated&&c.DomUtil.setOpacity(this._container,0);clearTimeout(this._removeTimeout);this.getPane().appendChild(this._container);this.update();a._fadeAnimated&&c.DomUtil.setOpacity(this._container,1);a.fire("popupopen",{popup:this});this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source.on("preclick",c.DomEvent.stopPropagation))},openOn:function(a){a.openPopup(this);return this},onRemove:function(a){a._fadeAnimated?(c.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(c.bind(c.DomUtil.remove,c.DomUtil,this._container),200)):c.DomUtil.remove(this._container);a.fire("popupclose",{popup:this});this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source.off("preclick",c.DomEvent.stopPropagation))},getLatLng:function(){return this._latlng},setLatLng:function(a){this._latlng=c.latLng(a);this._map&&(this._updatePosition(),this._adjustPan());return this},getContent:function(){return this._content},setContent:function(a){this._content=a;this.update();return this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var a={zoom:this._updatePosition,viewreset:this._updatePosition};this._zoomAnimated&&(a.zoomanim=this._animateZoom);if("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)a.preclick=this._close;this.options.keepInView&&(a.moveend=this._adjustPan);return a},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){this._map&&c.DomUtil.toFront(this._container);return this},bringToBack:function(){this._map&&c.DomUtil.toBack(this._container);return this},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var a=this._container=c.DomUtil.create("div","leaflet-popup "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"));if(this.options.closeButton){var b=this._closeButton=c.DomUtil.create("a","leaflet-popup-close-button",a);b.href="#close";b.innerHTML="\x26#215;";c.DomEvent.on(b,"click",this._onCloseButtonClick,this)}b=this._wrapper=c.DomUtil.create("div","leaflet-popup-content-wrapper",a);this._contentNode=c.DomUtil.create("div","leaflet-popup-content",b);c.DomEvent.disableClickPropagation(b).disableScrollPropagation(this._contentNode).on(b,"contextmenu",c.DomEvent.stopPropagation);this._tipContainer=c.DomUtil.create("div","leaflet-popup-tip-container",a);this._tip=c.DomUtil.create("div","leaflet-popup-tip",this._tipContainer)},_updateContent:function(){if(this._content){var a=this._contentNode,b="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof b)a.innerHTML=b;else{for(;a.hasChildNodes();)a.removeChild(a.firstChild);a.appendChild(b)}this.fire("contentupdate")}},_updateLayout:function(){var a=this._contentNode,b=a.style;b.width="";b.whiteSpace="nowrap";var d=a.offsetWidth,d=Math.min(d,this.options.maxWidth),d=Math.max(d,this.options.minWidth);b.width=d+1+"px";b.whiteSpace="";b.height="";var d=a.offsetHeight,e=this.options.maxHeight;e&&d>e?(b.height=e+"px",c.DomUtil.addClass(a,"leaflet-popup-scrolled")):c.DomUtil.removeClass(a,"leaflet-popup-scrolled");this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var a=this._map.latLngToLayerPoint(this._latlng),b=c.point(this.options.offset);this._zoomAnimated?c.DomUtil.setPosition(this._container,a):b=b.add(a);a=this._containerBottom=-b.y;b=this._containerLeft=-Math.round(this._containerWidth/2)+b.x;this._container.style.bottom=a+"px";this._container.style.left=b+"px"}},_animateZoom:function(a){a=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);c.DomUtil.setPosition(this._container,a)},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var a=this._map,b=this._container.offsetHeight,d=this._containerWidth,e=new c.Point(this._containerLeft,-b-this._containerBottom);this._zoomAnimated&&e._add(c.DomUtil.getPosition(this._container));var e=a.layerPointToContainerPoint(e),g=c.point(this.options.autoPanPadding),l=c.point(this.options.autoPanPaddingTopLeft||g),g=c.point(this.options.autoPanPaddingBottomRight||g),f=a.getSize(),k=0,p=0;e.x+d+g.x>f.x&&(k=e.x+d-f.x+g.x);0>e.x-k-l.x&&(k=e.x-l.x);e.y+b+g.y>f.y&&(p=e.y+b-f.y+g.y);0>e.y-p-l.y&&(p=e.y-l.y);(k||p)&&a.fire("autopanstart").panBy([k,p])}},_onCloseButtonClick:function(a){this._close();c.DomEvent.stop(a)}});c.popup=function(a,b){return new c.Popup(a,b)};c.Map.include({openPopup:function(a,b,d){a instanceof c.Popup||(a=(new c.Popup(d)).setContent(a));b&&a.setLatLng(b);if(this.hasLayer(a))return this;this._popup&&this._popup.options.autoClose&&this.closePopup();this._popup=a;return this.addLayer(a)},closePopup:function(a){a&&a!==this._popup||(a=this._popup,this._popup=null);a&&this.removeLayer(a);return this}});c.Layer.include({bindPopup:function(a,b){if(a instanceof c.Popup)c.setOptions(a,b),this._popup=a,a._source=this;else{if(!this._popup||b)this._popup=new c.Popup(b,this);this._popup.setContent(a)}this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0);this._originalPopupOffset=this._popup.options.offset;return this},unbindPopup:function(){this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null);return this},openPopup:function(a,b){a instanceof c.Layer||(b=a,a=this);if(a instanceof c.FeatureGroup)for(var d in this._layers){a=this._layers[d];break}b||(b=a.getCenter?a.getCenter():a.getLatLng());this._popup&&this._map&&(this._popup.options.offset=this._popupAnchor(a),this._popup._source=a,this._popup.update(),this._map.openPopup(this._popup,b));return this},closePopup:function(){this._popup&&this._popup._close();return this},togglePopup:function(a){this._popup&&(this._popup._map?this.closePopup():this.openPopup(a));return this},isPopupOpen:function(){return this._popup.isOpen()},setPopupContent:function(a){this._popup&&this._popup.setContent(a);return this},getPopup:function(){return this._popup},_openPopup:function(a){var b=a.layer||a.target;this._popup&&this._map&&(b instanceof c.Path?this.openPopup(a.layer||a.target,a.latlng):this._map.hasLayer(this._popup)&&this._popup._source===b?this.closePopup():this.openPopup(b,a.latlng))},_popupAnchor:function(a){a=a._getPopupAnchor?a._getPopupAnchor():[0,0];var b=this._originalPopupOffset||c.Popup.prototype.options.offset;return c.point(a).add(b)},_movePopup:function(a){this._popup.setLatLng(a.latlng)}});c.Marker.include({_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]}});c.LayerGroup=c.Layer.extend({initialize:function(a){this._layers={};var b,d;if(a)for(b=0,d=a.length;b<d;b++)this.addLayer(a[b])},addLayer:function(a){var b=this.getLayerId(a);this._layers[b]=a;this._map&&this._map.addLayer(a);return this},removeLayer:function(a){a=a in this._layers?a:this.getLayerId(a);this._map&&this._layers[a]&&this._map.removeLayer(this._layers[a]);delete this._layers[a];return this},hasLayer:function(a){return!!a&&(a in this._layers||this.getLayerId(a)in this._layers)},clearLayers:function(){for(var a in this._layers)this.removeLayer(this._layers[a]);return this},invoke:function(a){var b=Array.prototype.slice.call(arguments,1),d,c;for(d in this._layers)c=this._layers[d],c[a]&&c[a].apply(c,b);return this},onAdd:function(a){for(var b in this._layers)a.addLayer(this._layers[b])},onRemove:function(a){for(var b in this._layers)a.removeLayer(this._layers[b])},eachLayer:function(a,b){for(var d in this._layers)a.call(b,this._layers[d]);return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var a=[],b;for(b in this._layers)a.push(this._layers[b]);return a},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return c.stamp(a)}});c.layerGroup=function(a){return new c.LayerGroup(a)};c.FeatureGroup=c.LayerGroup.extend({addLayer:function(a){if(this.hasLayer(a))return this;a.addEventParent(this);c.LayerGroup.prototype.addLayer.call(this,a);return this.fire("layeradd",{layer:a})},removeLayer:function(a){if(!this.hasLayer(a))return this;a in this._layers&&(a=this._layers[a]);a.removeEventParent(this);c.LayerGroup.prototype.removeLayer.call(this,a);return this.fire("layerremove",{layer:a})},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new c.LatLngBounds,b;for(b in this._layers){var d=this._layers[b];a.extend(d.getBounds?d.getBounds():d.getLatLng())}return a}});c.featureGroup=function(a){return new c.FeatureGroup(a)};c.Renderer=c.Layer.extend({options:{padding:.1},initialize:function(a){c.setOptions(this,a);c.stamp(this)},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&c.DomUtil.addClass(this._container,"leaflet-zoom-animated"));this.getPane().appendChild(this._container);this._update()},onRemove:function(){c.DomUtil.remove(this._container)},getEvents:function(){var a={viewreset:this._reset,zoom:this._onZoom,moveend:this._update};this._zoomAnimated&&(a.zoomanim=this._onAnimZoom);return a},_onAnimZoom:function(a){this._updateTransform(a.center,a.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(a,b){var d=this._map.getZoomScale(b,this._zoom),e=c.DomUtil.getPosition(this._container),g=this._map.getSize().multiplyBy(.5+this.options.padding),l=this._map.project(this._center,b),l=this._map.project(a,b).subtract(l),e=g.multiplyBy(-d).add(e).add(g).subtract(l);c.Browser.any3d?c.DomUtil.setTransform(this._container,e,d):c.DomUtil.setPosition(this._container,e)},_reset:function(){this._update();this._updateTransform(this._center,this._zoom)},_update:function(){var a=this.options.padding,b=this._map.getSize(),d=this._map.containerPointToLayerPoint(b.multiplyBy(-a)).round();this._bounds=new c.Bounds(d,d.add(b.multiplyBy(1+2*a)).round());this._center=this._map.getCenter();this._zoom=this._map.getZoom()}});c.Map.include({getRenderer:function(a){a=a.options.renderer||this._getPaneRenderer(a.options.pane)||this.options.renderer||this._renderer;a||(a=this._renderer=this.options.preferCanvas&&c.canvas()||c.svg());this.hasLayer(a)||this.addLayer(a);return a},_getPaneRenderer:function(a){if("overlayPane"===a||a===n)return!1;var b=this._paneRenderers[a];b===n&&(b=c.SVG&&c.svg({pane:a})||c.Canvas&&c.canvas({pane:a}),this._paneRenderers[a]=b);return b}});c.Path=c.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(a){this._renderer=a.getRenderer(this)},onAdd:function(){this._renderer._initPath(this);this._reset();this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},getEvents:function(){return{zoomend:this._project,moveend:this._update,viewreset:this._reset}},redraw:function(){this._map&&this._renderer._updatePath(this);return this},setStyle:function(a){c.setOptions(this,a);this._renderer&&this._renderer._updateStyle(this);return this},bringToFront:function(){this._renderer&&this._renderer._bringToFront(this);return this},bringToBack:function(){this._renderer&&this._renderer._bringToBack(this);return this},getElement:function(){return this._path},_reset:function(){this._project();this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(c.Browser.touch?10:0)}});c.LineUtil={simplify:function(a,b){if(!b||!a.length)return a.slice();var d=b*b;a=this._reducePoints(a,d);return a=this._simplifyDP(a,d)},pointToSegmentDistance:function(a,b,d){return Math.sqrt(this._sqClosestPointOnSegment(a,b,d,!0))},closestPointOnSegment:function(a,b,d){return this._sqClosestPointOnSegment(a,b,d)},_simplifyDP:function(a,b){var d=a.length,c=new (typeof Uint8Array!==n+""?Uint8Array:Array)(d);c[0]=c[d-1]=1;this._simplifyDPStep(a,c,b,0,d-1);var g,l=[];for(g=0;g<d;g++)c[g]&&l.push(a[g]);return l},_simplifyDPStep:function(a,b,d,c,g){var l=0,f,k,p;for(k=c+1;k<=g-1;k++)p=this._sqClosestPointOnSegment(a[k],a[c],a[g],!0),p>l&&(f=k,l=p);l>d&&(b[f]=1,this._simplifyDPStep(a,b,d,c,f),this._simplifyDPStep(a,b,d,f,g))},_reducePoints:function(a,b){for(var c=[a[0]],e=1,g=0,l=a.length;e<l;e++)this._sqDist(a[e],a[g])>b&&(c.push(a[e]),g=e);g<l-1&&c.push(a[l-1]);return c},clipSegment:function(a,b,c,e,g){e=e?this._lastCode:this._getBitCode(a,c);var l=this._getBitCode(b,c),f,k,p;for(this._lastCode=l;;){if(!(e|l))return[a,b];if(e&l)return!1;f=e||l;k=this._getEdgeIntersection(a,b,f,c,g);p=this._getBitCode(k,c);f===e?(a=k,e=p):(b=k,l=p)}},_getEdgeIntersection:function(a,b,d,e,g){var l=b.x-a.x;b=b.y-a.y;var f=e.min;e=e.max;var k,p;d&8?(k=a.x+l*(e.y-a.y)/b,p=e.y):d&4?(k=a.x+l*(f.y-a.y)/b,p=f.y):d&2?(k=e.x,p=a.y+b*(e.x-a.x)/l):d&1&&(k=f.x,p=a.y+b*(f.x-a.x)/l);return new c.Point(k,p,g)},_getBitCode:function(a,b){var c=0;a.x<b.min.x?c|=1:a.x>b.max.x&&(c|=2);a.y<b.min.y?c|=4:a.y>b.max.y&&(c|=8);return c},_sqDist:function(a,b){var c=b.x-a.x,e=b.y-a.y;return c*c+e*e},_sqClosestPointOnSegment:function(a,b,d,e){var g=b.x;b=b.y;var l=d.x-g,f=d.y-b,k=l*l+f*f;0<k&&(k=((a.x-g)*l+(a.y-b)*f)/k,1<k?(g=d.x,b=d.y):0<k&&(g+=l*k,b+=f*k));l=a.x-g;f=a.y-b;return e?l*l+f*f:new c.Point(g,b)}};c.Polyline=c.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(a,b){c.setOptions(this,b);this._setLatLngs(a)},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){this._setLatLngs(a);return this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(a){for(var b=Infinity,d=null,e=c.LineUtil._sqClosestPointOnSegment,g,l,f=0,k=this._parts.length;f<k;f++)for(var p=this._parts[f],h=1,q=p.length;h<q;h++){g=p[h-1];l=p[h];var t=e(a,g,l,!0);t<b&&(b=t,d=e(a,g,l))}d&&(d.distance=Math.sqrt(b));return d},getCenter:function(){var a,b,c,e,g,l,f=this._rings[0],k=f.length;if(!k)return null;for(b=a=0;a<k-1;a++)b+=f[a].distanceTo(f[a+1])/2;if(0===b)return this._map.layerPointToLatLng(f[0]);for(e=a=0;a<k-1;a++)if(g=f[a],l=f[a+1],c=g.distanceTo(l),e+=c,e>b)return a=(e-b)/c,this._map.layerPointToLatLng([l.x-a*(l.x-g.x),l.y-a*(l.y-g.y)])},getBounds:function(){return this._bounds},addLatLng:function(a,b){b=b||this._defaultShape();a=c.latLng(a);b.push(a);this._bounds.extend(a);return this.redraw()},_setLatLngs:function(a){this._bounds=new c.LatLngBounds;this._latlngs=this._convertLatLngs(a)},_defaultShape:function(){return c.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(a){for(var b=[],d=c.Polyline._flat(a),e=0,g=a.length;e<g;e++)d?(b[e]=c.latLng(a[e]),this._bounds.extend(b[e])):b[e]=this._convertLatLngs(a[e]);return b},_project:function(){var a=new c.Bounds;this._rings=[];this._projectLatlngs(this._latlngs,this._rings,a);var b=this._clickTolerance(),b=new c.Point(b,b);this._bounds.isValid()&&a.isValid()&&(a.min._subtract(b),a.max._add(b),this._pxBounds=a)},_projectLatlngs:function(a,b,d){var e=a.length,g,f;if(a[0]instanceof c.LatLng){f=[];for(g=0;g<e;g++)f[g]=this._map.latLngToLayerPoint(a[g]),d.extend(f[g]);b.push(f)}else for(g=0;g<e;g++)this._projectLatlngs(a[g],b,d)},_clipPoints:function(){var a=this._renderer._bounds;this._parts=[];if(this._pxBounds&&this._pxBounds.intersects(a))if(this.options.noClip)this._parts=this._rings;else{var b=this._parts,d,e,g,f,h,k,p;g=d=0;for(f=this._rings.length;d<f;d++)for(p=this._rings[d],e=0,h=p.length;e<h-1;e++)if(k=c.LineUtil.clipSegment(p[e],p[e+1],a,e,!0))if(b[g]=b[g]||[],b[g].push(k[0]),k[1]!==p[e+1]||e===h-2)b[g].push(k[1]),g++}},_simplifyPoints:function(){for(var a=this._parts,b=this.options.smoothFactor,d=0,e=a.length;d<e;d++)a[d]=c.LineUtil.simplify(a[d],b)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}});c.polyline=function(a,b){return new c.Polyline(a,b)};c.Polyline._flat=function(a){return!c.Util.isArray(a[0])||"object"!==typeof a[0][0]&&"undefined"!==typeof a[0][0]};c.PolyUtil={};c.PolyUtil.clipPolygon=function(a,b,d){var e,g=[1,4,2,8],f,h,k,p,r,q,t=c.LineUtil;f=0;for(r=a.length;f<r;f++)a[f]._code=t._getBitCode(a[f],b);for(k=0;4>k;k++){q=g[k];e=[];f=0;r=a.length;for(h=r-1;f<r;h=f++)(p=a[f],h=a[h],p._code&q)?h._code&q||(h=t._getEdgeIntersection(h,p,q,b,d),h._code=t._getBitCode(h,b),e.push(h)):(h._code&q&&(h=t._getEdgeIntersection(h,p,q,b,d),h._code=t._getBitCode(h,b),e.push(h)),e.push(p));a=e}return a};c.Polygon=c.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){var a,b,c,e,g,f,h,k=this._rings[0],p=k.length;if(!p)return null;a=g=f=h=0;for(b=p-1;a<p;b=a++)c=k[a],b=k[b],e=c.y*b.x-b.y*c.x,f+=(c.x+b.x)*e,h+=(c.y+b.y)*e,g+=3*e;return this._map.layerPointToLatLng(0===g?k[0]:[f/g,h/g])},_convertLatLngs:function(a){a=c.Polyline.prototype._convertLatLngs.call(this,a);var b=a.length;2<=b&&a[0]instanceof c.LatLng&&a[0].equals(a[b-1])&&a.pop();return a},_setLatLngs:function(a){c.Polyline.prototype._setLatLngs.call(this,a);c.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return c.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var a=this._renderer._bounds,b=this.options.weight,b=new c.Point(b,b),a=new c.Bounds(a.min.subtract(b),a.max.add(b));this._parts=[];if(this._pxBounds&&this._pxBounds.intersects(a))if(this.options.noClip)this._parts=this._rings;else for(var b=0,d=this._rings.length,e;b<d;b++)e=c.PolyUtil.clipPolygon(this._rings[b],a,!0),e.length&&this._parts.push(e)},_updatePath:function(){this._renderer._updatePoly(this,!0)}});c.polygon=function(a,b){return new c.Polygon(a,b)};c.Rectangle=c.Polygon.extend({initialize:function(a,b){c.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),b)},setBounds:function(a){return this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){a=c.latLngBounds(a);return[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]}});c.rectangle=function(a,b){return new c.Rectangle(a,b)};c.CircleMarker=c.Path.extend({options:{fill:!0,radius:10},initialize:function(a,b){c.setOptions(this,b);this._latlng=c.latLng(a);this._radius=this.options.radius},setLatLng:function(a){this._latlng=c.latLng(a);this.redraw();return this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(a){this.options.radius=this._radius=a;return this.redraw()},getRadius:function(){return this._radius},setStyle:function(a){var b=a&&a.radius||this._radius;c.Path.prototype.setStyle.call(this,a);this.setRadius(b);return this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng);this._updateBounds()},_updateBounds:function(){var a=this._radius,b=this._radiusY||a,d=this._clickTolerance(),a=[a+d,b+d];this._pxBounds=new c.Bounds(this._point.subtract(a),this._point.add(a))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}});c.circleMarker=function(a,b){return new c.CircleMarker(a,b)};c.Circle=c.CircleMarker.extend({initialize:function(a,b,d){"number"===typeof b&&(b=c.extend({},d,{radius:b}));c.setOptions(this,b);this._latlng=c.latLng(a);if(isNaN(this.options.radius))throw Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(a){this._mRadius=a;return this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var a=[this._radius,this._radiusY||this._radius];return new c.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(a)),this._map.layerPointToLatLng(this._point.add(a)))},setStyle:c.Path.prototype.setStyle,_project:function(){var a=this._latlng.lng,b=this._latlng.lat,d=this._map,e=d.options.crs;if(e.distance===c.CRS.Earth.distance){var g=Math.PI/180,e=this._mRadius/c.CRS.Earth.R/g,f=d.project([b+e,a]),h=d.project([b-e,a]),h=f.add(h).divideBy(2),k=d.unproject(h).lat,g=Math.acos((Math.cos(e*g)-Math.sin(b*g)*Math.sin(k*g))/(Math.cos(b*g)*Math.cos(k*g)))/g;if(isNaN(g)||0===g)g=e/Math.cos(Math.PI/180*b);this._point=h.subtract(d.getPixelOrigin());this._radius=isNaN(g)?0:Math.max(Math.round(h.x-d.project([k,a-g]).x),1);this._radiusY=Math.max(Math.round(h.y-f.y),1)}else a=e.unproject(e.project(this._latlng).subtract([this._mRadius,0])),this._point=d.latLngToLayerPoint(this._latlng),this._radius=this._point.x-d.latLngToLayerPoint(a).x;this._updateBounds()}});c.circle=function(a,b,d){return new c.Circle(a,b,d)};c.SVG=c.Renderer.extend({getEvents:function(){var a=c.Renderer.prototype.getEvents.call(this);a.zoomstart=this._onZoomStart;return a},_initContainer:function(){this._container=c.SVG.create("svg");this._container.setAttribute("pointer-events","none");this._rootGroup=c.SVG.create("g");this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){c.Renderer.prototype._update.call(this);var a=this._bounds,b=a.getSize(),d=this._container;this._svgSize&&this._svgSize.equals(b)||(this._svgSize=b,d.setAttribute("width",b.x),d.setAttribute("height",b.y));c.DomUtil.setPosition(d,a.min);d.setAttribute("viewBox",[a.min.x,a.min.y,b.x,b.y].join(" "))}},_initPath:function(a){var b=a._path=c.SVG.create("path");a.options.className&&c.DomUtil.addClass(b,a.options.className);a.options.interactive&&c.DomUtil.addClass(b,"leaflet-interactive");this._updateStyle(a)},_addPath:function(a){this._rootGroup.appendChild(a._path);a.addInteractiveTarget(a._path)},_removePath:function(a){c.DomUtil.remove(a._path);a.removeInteractiveTarget(a._path)},_updatePath:function(a){a._project();a._update()},_updateStyle:function(a){var b=a._path;a=a.options;b&&(a.stroke?(b.setAttribute("stroke",a.color),b.setAttribute("stroke-opacity",a.opacity),b.setAttribute("stroke-width",a.weight),b.setAttribute("stroke-linecap",a.lineCap),b.setAttribute("stroke-linejoin",a.lineJoin),a.dashArray?b.setAttribute("stroke-dasharray",a.dashArray):b.removeAttribute("stroke-dasharray"),a.dashOffset?b.setAttribute("stroke-dashoffset",a.dashOffset):b.removeAttribute("stroke-dashoffset")):b.setAttribute("stroke","none"),a.fill?(b.setAttribute("fill",a.fillColor||a.color),b.setAttribute("fill-opacity",a.fillOpacity),b.setAttribute("fill-rule",a.fillRule||"evenodd")):b.setAttribute("fill","none"))},_updatePoly:function(a,b){this._setPath(a,c.SVG.pointsToPath(a._parts,b))},_updateCircle:function(a){var b=a._point,c=a._radius,e="a"+c+","+(a._radiusY||c)+" 0 1,0 ",b=a._empty()?"M0 0":"M"+(b.x-c)+","+b.y+e+2*c+",0 "+e+2*-c+",0 ";this._setPath(a,b)},_setPath:function(a,b){a._path.setAttribute("d",b)},_bringToFront:function(a){c.DomUtil.toFront(a._path)},_bringToBack:function(a){c.DomUtil.toBack(a._path)}});c.extend(c.SVG,{create:function(a){return m.createElementNS("http://www.w3.org/2000/svg",a)},pointsToPath:function(a,b){var d="",e,g,f,h,k,p;e=0;for(f=a.length;e<f;e++){k=a[e];g=0;for(h=k.length;g<h;g++)p=k[g],d+=(g?"L":"M")+p.x+" "+p.y;d+=b?c.Browser.svg?"z":"x":""}return d||"M0 0"}});c.Browser.svg=!(!m.createElementNS||!c.SVG.create("svg").createSVGRect);c.svg=function(a){return c.Browser.svg||c.Browser.vml?new c.SVG(a):null};c.Browser.vml=!c.Browser.svg&&function(){try{var a=m.createElement("div");a.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';var b=a.firstChild;b.style.behavior="url(#default#VML)";return b&&"object"===typeof b.adj}catch(c){return!1}}();c.SVG.include(c.Browser.vml?{_initContainer:function(){this._container=c.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||c.Renderer.prototype._update.call(this)},_initPath:function(a){var b=a._container=c.SVG.create("shape");c.DomUtil.addClass(b,"leaflet-vml-shape "+(this.options.className||""));b.coordsize="1 1";a._path=c.SVG.create("path");b.appendChild(a._path);this._updateStyle(a)},_addPath:function(a){var b=a._container;this._container.appendChild(b);a.options.interactive&&a.addInteractiveTarget(b)},_removePath:function(a){var b=a._container;c.DomUtil.remove(b);a.removeInteractiveTarget(b)},_updateStyle:function(a){var b=a._stroke,d=a._fill,e=a.options,g=a._container;g.stroked=!!e.stroke;g.filled=!!e.fill;e.stroke?(b||(b=a._stroke=c.SVG.create("stroke")),g.appendChild(b),b.weight=e.weight+"px",b.color=e.color,b.opacity=e.opacity,b.dashStyle=e.dashArray?c.Util.isArray(e.dashArray)?e.dashArray.join(" "):e.dashArray.replace(/( *, *)/g," "):"",b.endcap=e.lineCap.replace("butt","flat"),b.joinstyle=e.lineJoin):b&&(g.removeChild(b),a._stroke=null);e.fill?(d||(d=a._fill=c.SVG.create("fill")),g.appendChild(d),d.color=e.fillColor||e.color,d.opacity=e.fillOpacity):d&&(g.removeChild(d),a._fill=null)},_updateCircle:function(a){var b=a._point.round(),c=Math.round(a._radius),e=Math.round(a._radiusY||c);this._setPath(a,a._empty()?"M0 0":"AL "+b.x+","+b.y+" "+c+","+e+" 0,23592600")},_setPath:function(a,b){a._path.v=b},_bringToFront:function(a){c.DomUtil.toFront(a._container)},_bringToBack:function(a){c.DomUtil.toBack(a._container)}}:{});c.Browser.vml&&(c.SVG.create=function(){try{return m.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(a){return m.createElement("\x3clvml:"+a+' class\x3d"lvml"\x3e')}}catch(a){return function(a){return m.createElement("\x3c"+a+' xmlns\x3d"urn:schemas-microsoft.com:vml" class\x3d"lvml"\x3e')}}}());c.Canvas=c.Renderer.extend({onAdd:function(){c.Renderer.prototype.onAdd.call(this);this._layers=this._layers||{};this._draw()},_initContainer:function(){var a=this._container=m.createElement("canvas");c.DomEvent.on(a,"mousemove",c.Util.throttle(this._onMouseMove,32,this),this).on(a,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(a,"mouseout",this._handleMouseOut,this);this._ctx=a.getContext("2d")},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={};c.Renderer.prototype._update.call(this);var a=this._bounds,b=this._container,d=a.getSize(),e=c.Browser.retina?2:1;c.DomUtil.setPosition(b,a.min);b.width=e*d.x;b.height=e*d.y;b.style.width=d.x+"px";b.style.height=d.y+"px";c.Browser.retina&&this._ctx.scale(2,2);this._ctx.translate(-a.min.x,-a.min.y)}},_initPath:function(a){this._updateDashArray(a);this._layers[c.stamp(a)]=a},_addPath:c.Util.falseFn,_removePath:function(a){a._removed=!0;this._requestRedraw(a)},_updatePath:function(a){this._redrawBounds=a._pxBounds;this._draw(!0);a._project();a._update();this._draw();this._redrawBounds=null},_updateStyle:function(a){this._updateDashArray(a);this._requestRedraw(a)},_updateDashArray:function(a){if(a.options.dashArray){var b=a.options.dashArray.split(","),c=[],e;for(e=0;e<b.length;e++)c.push(Number(b[e]));a.options._dashArray=c}},_requestRedraw:function(a){if(this._map){var b=(a.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new c.Bounds;this._redrawBounds.extend(a._pxBounds.min.subtract([b,b]));this._redrawBounds.extend(a._pxBounds.max.add([b,b]));this._redrawRequest=this._redrawRequest||c.Util.requestAnimFrame(this._redraw,this)}},_redraw:function(){this._redrawRequest=null;this._draw(!0);this._draw();this._redrawBounds=null},_draw:function(a){this._clear=a;var b,c=this._redrawBounds;this._ctx.save();c&&(this._ctx.beginPath(),this._ctx.rect(c.min.x,c.min.y,c.max.x-c.min.x,c.max.y-c.min.y),this._ctx.clip());for(var e in this._layers)b=this._layers[e],c&&!b._pxBounds.intersects(c)||b._updatePath(),a&&b._removed&&(delete b._removed,delete this._layers[e]);this._ctx.restore()},_updatePoly:function(a,b){var c,e,g,f,h=a._parts,k=h.length,p=this._ctx;if(k){this._drawnLayers[a._leaflet_id]=a;p.beginPath();p.setLineDash&&p.setLineDash(a.options&&a.options._dashArray||[]);for(c=0;c<k;c++){e=0;for(g=h[c].length;e<g;e++)f=h[c][e],p[e?"lineTo":"moveTo"](f.x,f.y);b&&p.closePath()}this._fillStroke(p,a)}},_updateCircle:function(a){if(!a._empty()){var b=a._point,c=this._ctx,e=a._radius,g=(a._radiusY||e)/e;this._drawnLayers[a._leaflet_id]=a;1!==g&&(c.save(),c.scale(1,g));c.beginPath();c.arc(b.x,b.y/g,e,0,2*Math.PI,!1);1!==g&&c.restore();this._fillStroke(c,a)}},_fillStroke:function(a,b){var c=this._clear,e=b.options;a.globalCompositeOperation=c?"destination-out":"source-over";e.fill&&(a.globalAlpha=c?1:e.fillOpacity,a.fillStyle=e.fillColor||e.color,a.fill(e.fillRule||"evenodd"));e.stroke&&0!==e.weight&&(a.globalAlpha=c?1:e.opacity,b._prevWeight=a.lineWidth=c?b._prevWeight+1:e.weight,a.strokeStyle=e.color,a.lineCap=e.lineCap,a.lineJoin=e.lineJoin,a.stroke())},_onClick:function(a){var b=this._map.mouseEventToLayerPoint(a),d=[],e,g;for(g in this._layers)e=this._layers[g],e.options.interactive&&e._containsPoint(b)&&(c.DomEvent._fakeStop(a),d.push(e));d.length&&this._fireEvent(d,a)},_onMouseMove:function(a){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var b=this._map.mouseEventToLayerPoint(a);this._handleMouseOut(a,b);this._handleMouseHover(a,b)}},_handleMouseOut:function(a,b){var d=this._hoveredLayer;!d||"mouseout"!==a.type&&d._containsPoint(b)||(c.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([d],a,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(a,b){var d,e;for(d in this._drawnLayers)e=this._drawnLayers[d],e.options.interactive&&e._containsPoint(b)&&(c.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([e],a,"mouseover"),this._hoveredLayer=e);this._hoveredLayer&&this._fireEvent([this._hoveredLayer],a)},_fireEvent:function(a,b,c){this._map._fireDOMEvent(b,c||b.type,a)},_bringToFront:c.Util.falseFn,_bringToBack:c.Util.falseFn});c.Browser.canvas=!!m.createElement("canvas").getContext;c.canvas=function(a){return c.Browser.canvas?new c.Canvas(a):null};c.Polyline.prototype._containsPoint=function(a,b){var d,e,g,f,h,k,p=this._clickTolerance();if(!this._pxBounds.contains(a))return!1;d=0;for(f=this._parts.length;d<f;d++)for(k=this._parts[d],e=0,h=k.length,g=h-1;e<h;g=e++)if((b||0!==e)&&c.LineUtil.pointToSegmentDistance(a,k[g],k[e])<=p)return!0;return!1};c.Polygon.prototype._containsPoint=function(a){var b=!1,d,e,g,f,h,k,p;if(!this._pxBounds.contains(a))return!1;f=0;for(k=this._parts.length;f<k;f++)for(d=this._parts[f],h=0,p=d.length,g=p-1;h<p;g=h++)e=d[h],g=d[g],e.y>a.y!==g.y>a.y&&a.x<(g.x-e.x)*(a.y-e.y)/(g.y-e.y)+e.x&&(b=!b);return b||c.Polyline.prototype._containsPoint.call(this,a,!0)};c.CircleMarker.prototype._containsPoint=function(a){return a.distanceTo(this._point)<=this._radius+this._clickTolerance()};c.GeoJSON=c.FeatureGroup.extend({initialize:function(a,b){c.setOptions(this,b);this._layers={};a&&this.addData(a)},addData:function(a){var b=c.Util.isArray(a)?a:a.features,d,e;if(b){a=0;for(d=b.length;a<d;a++)e=b[a],(e.geometries||e.geometry||e.features||e.coordinates)&&this.addData(e);return this}b=this.options;if(b.filter&&!b.filter(a))return this;d=c.GeoJSON.geometryToLayer(a,b);if(!d)return this;d.feature=c.GeoJSON.asFeature(a);d.defaultOptions=d.options;this.resetStyle(d);if(b.onEachFeature)b.onEachFeature(a,d);return this.addLayer(d)},resetStyle:function(a){a.options=c.Util.extend({},a.defaultOptions);this._setLayerStyle(a,this.options.style);return this},setStyle:function(a){return this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"===typeof b&&(b=b(a.feature));a.setStyle&&a.setStyle(b)}});c.extend(c.GeoJSON,{geometryToLayer:function(a,b){var d="Feature"===a.type?a.geometry:a,e=d?d.coordinates:null,g=[],f=b&&b.pointToLayer,h=b&&b.coordsToLatLng||this.coordsToLatLng,k,p;if(!e&&!d)return null;switch(d.type){case "Point":return d=h(e),f?f(a,d):new c.Marker(d);case "MultiPoint":k=0;for(p=e.length;k<p;k++)d=h(e[k]),g.push(f?f(a,d):new c.Marker(d));return new c.FeatureGroup(g);case "LineString":case "MultiLineString":return g=this.coordsToLatLngs(e,"LineString"===d.type?0:1,h),new c.Polyline(g,b);case "Polygon":case "MultiPolygon":return g=this.coordsToLatLngs(e,"Polygon"===d.type?1:2,h),new c.Polygon(g,b);case "GeometryCollection":k=0;for(p=d.geometries.length;k<p;k++)(e=this.geometryToLayer({geometry:d.geometries[k],type:"Feature",properties:a.properties},b))&&g.push(e);return new c.FeatureGroup(g);default:throw Error("Invalid GeoJSON object.");}},coordsToLatLng:function(a){return new c.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(a,b,c){for(var e=[],g=0,f=a.length,h;g<f;g++)h=b?this.coordsToLatLngs(a[g],b-1,c):(c||this.coordsToLatLng)(a[g]),e.push(h);return e},latLngToCoords:function(a){return a.alt!==n?[a.lng,a.lat,a.alt]:[a.lng,a.lat]},latLngsToCoords:function(a,b,d){for(var e=[],g=0,f=a.length;g<f;g++)e.push(b?c.GeoJSON.latLngsToCoords(a[g],b-1,d):c.GeoJSON.latLngToCoords(a[g]));!b&&d&&e.push(e[0]);return e},getFeature:function(a,b){return a.feature?c.extend({},a.feature,{geometry:b}):c.GeoJSON.asFeature(b)},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a}}});h={toGeoJSON:function(){return c.GeoJSON.getFeature(this,{type:"Point",coordinates:c.GeoJSON.latLngToCoords(this.getLatLng())})}};c.Marker.include(h);c.Circle.include(h);c.CircleMarker.include(h);c.Polyline.prototype.toGeoJSON=function(){var a=!c.Polyline._flat(this._latlngs),b=c.GeoJSON.latLngsToCoords(this._latlngs,a?1:0);return c.GeoJSON.getFeature(this,{type:(a?"Multi":"")+"LineString",coordinates:b})};c.Polygon.prototype.toGeoJSON=function(){var a=!c.Polyline._flat(this._latlngs),b=a&&!c.Polyline._flat(this._latlngs[0]),d=c.GeoJSON.latLngsToCoords(this._latlngs,b?2:a?1:0,!0);a||(d=[d]);return c.GeoJSON.getFeature(this,{type:(b?"Multi":"")+"Polygon",coordinates:d})};c.LayerGroup.include({toMultiPoint:function(){var a=[];this.eachLayer(function(b){a.push(b.toGeoJSON().geometry.coordinates)});return c.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:a})},toGeoJSON:function(){var a=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===a)return this.toMultiPoint();var b="GeometryCollection"===a,d=[];this.eachLayer(function(a){a.toGeoJSON&&(a=a.toGeoJSON(),d.push(b?a.geometry:c.GeoJSON.asFeature(a)))});return b?c.GeoJSON.getFeature(this,{geometries:d,type:"GeometryCollection"}):{type:"FeatureCollection",features:d}}});c.geoJSON=function(a,b){return new c.GeoJSON(a,b)};c.geoJson=c.geoJSON;c.DomEvent={on:function(a,b,d,e){if("object"===typeof b)for(var g in b)this._on(a,g,b[g],d);else{b=c.Util.splitWords(b);g=0;for(var f=b.length;g<f;g++)this._on(a,b[g],d,e)}return this},off:function(a,b,d,e){if("object"===typeof b)for(var g in b)this._off(a,g,b[g],d);else{b=c.Util.splitWords(b);g=0;for(var f=b.length;g<f;g++)this._off(a,b[g],d,e)}return this},_on:function(a,b,d,e){var g=b+c.stamp(d)+(e?"_"+c.stamp(e):"");if(a._leaflet_events&&a._leaflet_events[g])return this;var l=function(b){return d.call(e||a,b||f.event)},h=l;c.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,l,g):c.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener?this.addDoubleTapListener(a,l,g):"addEventListener"in a?"mousewheel"===b?a.addEventListener("onwheel"in a?"wheel":"mousewheel",l,!1):"mouseenter"===b||"mouseleave"===b?(l=function(b){b=b||f.event;c.DomEvent._isExternalTarget(a,b)&&h(b)},a.addEventListener("mouseenter"===b?"mouseover":"mouseout",l,!1)):("click"===b&&c.Browser.android&&(l=function(a){return c.DomEvent._filterClick(a,h)}),a.addEventListener(b,l,!1)):"attachEvent"in a&&a.attachEvent("on"+b,l);a._leaflet_events=a._leaflet_events||{};a._leaflet_events[g]=l;return this},_off:function(a,b,d,e){d=b+c.stamp(d)+(e?"_"+c.stamp(e):"");e=a._leaflet_events&&a._leaflet_events[d];if(!e)return this;c.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,d):c.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,d):"removeEventListener"in a?"mousewheel"===b?a.removeEventListener("onwheel"in a?"wheel":"mousewheel",e,!1):a.removeEventListener("mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,e,!1):"detachEvent"in a&&a.detachEvent("on"+b,e);a._leaflet_events[d]=null;return this},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.originalEvent?a.originalEvent._stopped=!0:a.cancelBubble=!0;c.DomEvent._skipped(a);return this},disableScrollPropagation:function(a){return c.DomEvent.on(a,"mousewheel",c.DomEvent.stopPropagation)},disableClickPropagation:function(a){var b=c.DomEvent.stopPropagation;c.DomEvent.on(a,c.Draggable.START.join(" "),b);return c.DomEvent.on(a,{click:c.DomEvent._fakeStop,dblclick:b})},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;return this},stop:function(a){return c.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(a,b){if(!b)return new c.Point(a.clientX,a.clientY);var d=b.getBoundingClientRect();return new c.Point(a.clientX-d.left-b.clientLeft,a.clientY-d.top-b.clientTop)},getWheelDelta:function(a){return a.deltaY&&0===a.deltaMode?-a.deltaY:a.deltaY&&1===a.deltaMode?18*-a.deltaY:a.deltaY&&2===a.deltaMode?52*-a.deltaY:a.deltaX||a.deltaZ?0:a.wheelDelta?(a.wheelDeltaY||a.wheelDelta)/2:a.detail&&32765>Math.abs(a.detail)?18*-a.detail:a.detail?a.detail/-32765*52:0},_skipEvents:{},_fakeStop:function(a){c.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];this._skipEvents[a.type]=!1;return b},_isExternalTarget:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(e){return!1}return c!==a},_filterClick:function(a,b){var d=a.timeStamp||a.originalEvent&&a.originalEvent.timeStamp,e=c.DomEvent._lastClick&&d-c.DomEvent._lastClick;e&&100<e&&500>e||a.target._simulatedClick&&!a._simulated?c.DomEvent.stop(a):(c.DomEvent._lastClick=d,b(a))}};c.DomEvent.addListener=c.DomEvent.on;c.DomEvent.removeListener=c.DomEvent.off;c.Draggable=c.Evented.extend({options:{clickTolerance:3},statics:{START:c.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,b,c){this._element=a;this._dragStartTarget=b||a;this._preventOutline=c},enable:function(){this._enabled||(c.DomEvent.on(this._dragStartTarget,c.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(c.DomEvent.off(this._dragStartTarget,c.Draggable.START.join(" "),this._onDown,this),this._moved=this._enabled=!1)},_onDown:function(a){if(!(a._simulated||(this._moved=!1,c.DomUtil.hasClass(this._element,"leaflet-zoom-anim")||c.Draggable._dragging||a.shiftKey||1!==a.which&&1!==a.button&&!a.touches||!this._enabled||(c.Draggable._dragging=!0,this._preventOutline&&c.DomUtil.preventOutline(this._element),c.DomUtil.disableImageDrag(),c.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var b=a.touches?a.touches[0]:a;this._startPoint=new c.Point(b.clientX,b.clientY);this._startPos=this._newPos=c.DomUtil.getPosition(this._element);c.DomEvent.on(m,c.Draggable.MOVE[a.type],this._onMove,this).on(m,c.Draggable.END[a.type],this._onUp,this)}},_onMove:function(a){if(!a._simulated)if(a.touches&&1<a.touches.length)this._moved=!0;else{var b=a.touches&&1===a.touches.length?a.touches[0]:a,b=(new c.Point(b.clientX,b.clientY)).subtract(this._startPoint);!b.x&&!b.y||Math.abs(b.x)+Math.abs(b.y)<this.options.clickTolerance||(c.DomEvent.preventDefault(a),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=c.DomUtil.getPosition(this._element).subtract(b),c.DomUtil.addClass(m.body,"leaflet-dragging"),this._lastTarget=a.target||a.srcElement,f.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),c.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(b),this._moving=!0,c.Util.cancelAnimFrame(this._animRequest),this._lastEvent=a,this._animRequest=c.Util.requestAnimFrame(this._updatePosition,this,!0))}},_updatePosition:function(){var a={originalEvent:this._lastEvent};this.fire("predrag",a);c.DomUtil.setPosition(this._element,this._newPos);this.fire("drag",a)},_onUp:function(a){if(!a._simulated){c.DomUtil.removeClass(m.body,"leaflet-dragging");this._lastTarget&&(c.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var b in c.Draggable.MOVE)c.DomEvent.off(m,c.Draggable.MOVE[b],this._onMove,this).off(m,c.Draggable.END[b],this._onUp,this);c.DomUtil.enableImageDrag();c.DomUtil.enableTextSelection();this._moved&&this._moving&&(c.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)}));this._moving=!1;c.Draggable._dragging=!1}}});c.Handler=c.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}});c.Map.mergeOptions({dragging:!0,inertia:!c.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});c.Map.Drag=c.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new c.Draggable(a._mapPane,a._container);this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);this._draggable.on("predrag",this._onPreDragLimit,this);a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),a.on("zoomend",this._onZoomEnd,this),a.whenReady(this._onZoomEnd,this))}c.DomUtil.addClass(this._map._container,"leaflet-grab");this._draggable.enable();this._positions=[];this._times=[]},removeHooks:function(){c.DomUtil.removeClass(this._map._container,"leaflet-grab");this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var a=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var b=c.latLngBounds(this._map.options.maxBounds);this._offsetLimit=c.bounds(this._map.latLngToContainerPoint(b.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(b.getSouthEast()).multiplyBy(-1).add(this._map.getSize()));this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;a.fire("movestart").fire("dragstart");a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(a){if(this._map.options.inertia){var b=this._lastTime=+new Date,c=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(c);this._times.push(b);50<b-this._times[0]&&(this._positions.shift(),this._times.shift())}this._map.fire("move",a).fire("drag",a)},_onZoomEnd:function(){var a=this._map.getSize().divideBy(2);this._initialWorldOffset=this._map.latLngToLayerPoint([0,0]).subtract(a).x;this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(a,b){return a-(a-b)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var a=this._draggable._newPos.subtract(this._draggable._startPos),b=this._offsetLimit;a.x<b.min.x&&(a.x=this._viscousLimit(a.x,b.min.x));a.y<b.min.y&&(a.y=this._viscousLimit(a.y,b.min.y));a.x>b.max.x&&(a.x=this._viscousLimit(a.x,b.max.x));a.y>b.max.y&&(a.y=this._viscousLimit(a.y,b.max.y));this._draggable._newPos=this._draggable._startPos.add(a)}},_onPreDragWrap:function(){var a=this._worldWidth,b=Math.round(a/2),c=this._initialWorldOffset,e=this._draggable._newPos.x,g=(e-b+c)%a+b-c,a=(e+b+c)%a-b-c,c=Math.abs(g+c)<Math.abs(a+c)?g:a;this._draggable._absPos=this._draggable._newPos.clone();this._draggable._newPos.x=c},_onDragEnd:function(a){var b=this._map,d=b.options,e=!d.inertia||2>this._times.length;b.fire("dragend",a);if(e)b.fire("moveend");else{a=this._lastPos.subtract(this._positions[0]);var g=d.easeLinearity,e=a.multiplyBy(g/((this._lastTime-this._times[0])/1E3)),f=e.distanceTo([0,0]);a=Math.min(d.inertiaMaxSpeed,f);var e=e.multiplyBy(a/f),h=a/(d.inertiaDeceleration*g),k=e.multiplyBy(-h/2).round();k.x||k.y?(k=b._limitOffset(k,b.options.maxBounds),c.Util.requestAnimFrame(function(){b.panBy(k,{duration:h,easeLinearity:g,noMoveStart:!0,animate:!0})})):b.fire("moveend")}}});c.Map.addInitHook("addHandler","dragging",c.Map.Drag);c.Map.mergeOptions({doubleClickZoom:!0});c.Map.DoubleClickZoom=c.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(a){var b=this._map,c=b.getZoom(),e=b.options.zoomDelta,c=a.originalEvent.shiftKey?c-e:c+e;"center"===b.options.doubleClickZoom?b.setZoom(c):b.setZoomAround(a.containerPoint,c)}});c.Map.addInitHook("addHandler","doubleClickZoom",c.Map.DoubleClickZoom);c.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:50});c.Map.ScrollWheelZoom=c.Handler.extend({addHooks:function(){c.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);this._delta=0},removeHooks:function(){c.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(a){var b=c.DomEvent.getWheelDelta(a),d=this._map.options.wheelDebounceTime;this._delta+=b;this._lastMousePos=this._map.mouseEventToContainerPoint(a);this._startTime||(this._startTime=+new Date);b=Math.max(d-(+new Date-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(c.bind(this._performZoom,this),b);c.DomEvent.stop(a)},_performZoom:function(){var a=this._map,b=a.getZoom(),c=this._map.options.zoomSnap||0;a._stop();var e=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,c=c?Math.ceil(e/c)*c:e,c=a._limitZoom(b+(0<this._delta?c:-c))-b;this._delta=0;this._startTime=null;c&&("center"===a.options.scrollWheelZoom?a.setZoom(b+c):a.setZoomAround(this._lastMousePos,b+c))}});c.Map.addInitHook("addHandler","scrollWheelZoom",c.Map.ScrollWheelZoom);c.extend(c.DomEvent,{_touchstart:c.Browser.msPointer?"MSPointerDown":c.Browser.pointer?"pointerdown":"touchstart",_touchend:c.Browser.msPointer?"MSPointerUp":c.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(a,b,d){function e(a){if(!(1<(c.Browser.pointer?c.DomEvent._pointersCount:a.touches.length))){var b=Date.now(),d=b-(f||b);h=a.touches?a.touches[0]:a;k=0<d&&250>=d;f=b}}function g(){if(k&&!h.cancelBubble){if(c.Browser.pointer){var a={},d,e;for(e in h)d=h[e],a[e]=d&&d.bind?d.bind(h):d;h=a}h.type="dblclick";b(h);f=null}}var f,h,k=!1,p=this._touchstart,r=this._touchend;a["_leaflet_"+p+d]=e;a["_leaflet_"+r+d]=g;a["_leaflet_dblclick"+d]=b;a.addEventListener(p,e,!1);a.addEventListener(r,g,!1);c.Browser.edge||a.addEventListener("dblclick",b,!1);return this},removeDoubleTapListener:function(a,b){var d=a["_leaflet_"+this._touchend+b],e=a["_leaflet_dblclick"+b];a.removeEventListener(this._touchstart,a["_leaflet_"+this._touchstart+b],!1);a.removeEventListener(this._touchend,d,!1);c.Browser.edge||a.removeEventListener("dblclick",e,!1);return this}});c.extend(c.DomEvent,{POINTER_DOWN:c.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:c.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:c.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:c.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(a,b,c,e){"touchstart"===b?this._addPointerStart(a,c,e):"touchmove"===b?this._addPointerMove(a,c,e):"touchend"===b&&this._addPointerEnd(a,c,e);return this},removePointerListener:function(a,b,c){c=a["_leaflet_"+b+c];"touchstart"===b?a.removeEventListener(this.POINTER_DOWN,c,!1):"touchmove"===b?a.removeEventListener(this.POINTER_MOVE,c,!1):"touchend"===b&&(a.removeEventListener(this.POINTER_UP,c,!1),a.removeEventListener(this.POINTER_CANCEL,c,!1));return this},_addPointerStart:function(a,b,d){var e=c.bind(function(a){if("mouse"!==a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE)if(0>this.TAG_WHITE_LIST.indexOf(a.target.tagName))c.DomEvent.preventDefault(a);else return;this._handlePointer(a,b)},this);a["_leaflet_touchstart"+d]=e;a.addEventListener(this.POINTER_DOWN,e,!1);this._pointerDocListener||(a=c.bind(this._globalPointerUp,this),m.documentElement.addEventListener(this.POINTER_DOWN,c.bind(this._globalPointerDown,this),!0),m.documentElement.addEventListener(this.POINTER_MOVE,c.bind(this._globalPointerMove,this),!0),m.documentElement.addEventListener(this.POINTER_UP,a,!0),m.documentElement.addEventListener(this.POINTER_CANCEL,a,!0),this._pointerDocListener=!0)},_globalPointerDown:function(a){this._pointers[a.pointerId]=a;this._pointersCount++},_globalPointerMove:function(a){this._pointers[a.pointerId]&&(this._pointers[a.pointerId]=a)},_globalPointerUp:function(a){delete this._pointers[a.pointerId];this._pointersCount--},_handlePointer:function(a,b){a.touches=[];for(var c in this._pointers)a.touches.push(this._pointers[c]);a.changedTouches=[a];b(a)},_addPointerMove:function(a,b,d){var e=c.bind(function(a){(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons)&&this._handlePointer(a,b)},this);a["_leaflet_touchmove"+d]=e;a.addEventListener(this.POINTER_MOVE,e,!1)},_addPointerEnd:function(a,b,d){var e=c.bind(function(a){this._handlePointer(a,b)},this);a["_leaflet_touchend"+d]=e;a.addEventListener(this.POINTER_UP,e,!1);a.addEventListener(this.POINTER_CANCEL,e,!1)}});c.Map.mergeOptions({touchZoom:c.Browser.touch&&!c.Browser.android23,bounceAtZoomLimits:!0});c.Map.TouchZoom=c.Handler.extend({addHooks:function(){c.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){c.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&!b._animatingZoom&&!this._zooming){var d=b.mouseEventToContainerPoint(a.touches[0]),e=b.mouseEventToContainerPoint(a.touches[1]);this._centerPoint=b.getSize()._divideBy(2);this._startLatLng=b.containerPointToLatLng(this._centerPoint);"center"!==b.options.touchZoom&&(this._pinchStartLatLng=b.containerPointToLatLng(d.add(e)._divideBy(2)));this._startDist=d.distanceTo(e);this._startZoom=b.getZoom();this._moved=!1;this._zooming=!0;b._stop();c.DomEvent.on(m,"touchmove",this._onTouchMove,this).on(m,"touchend",this._onTouchEnd,this);c.DomEvent.preventDefault(a)}},_onTouchMove:function(a){if(a.touches&&2===a.touches.length&&this._zooming){var b=this._map,d=b.mouseEventToContainerPoint(a.touches[0]),e=b.mouseEventToContainerPoint(a.touches[1]),g=d.distanceTo(e)/this._startDist;this._zoom=b.getScaleZoom(g,this._startZoom);!b.options.bounceAtZoomLimits&&(this._zoom<b.getMinZoom()&&1>g||this._zoom>b.getMaxZoom()&&1<g)&&(this._zoom=b._limitZoom(this._zoom));if("center"===b.options.touchZoom){if(this._center=this._startLatLng,1===g)return}else{d=d._add(e)._divideBy(2)._subtract(this._centerPoint);if(1===g&&0===d.x&&0===d.y)return;this._center=b.unproject(b.project(this._pinchStartLatLng,this._zoom).subtract(d),this._zoom)}this._moved||(b._moveStart(!0),this._moved=!0);c.Util.cancelAnimFrame(this._animRequest);b=c.bind(b._move,b,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=c.Util.requestAnimFrame(b,this,!0);c.DomEvent.preventDefault(a)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,c.Util.cancelAnimFrame(this._animRequest),c.DomEvent.off(m,"touchmove",this._onTouchMove).off(m,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.snapZoom):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});c.Map.addInitHook("addHandler","touchZoom",c.Map.TouchZoom);c.Map.mergeOptions({tap:!0,tapTolerance:15});c.Map.Tap=c.Handler.extend({addHooks:function(){c.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){c.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(a){if(a.touches)if(c.DomEvent.preventDefault(a),this._fireClick=!0,1<a.touches.length)this._fireClick=!1,clearTimeout(this._holdTimeout);else{var b=a.touches[0];a=b.target;this._startPos=this._newPos=new c.Point(b.clientX,b.clientY);a.tagName&&"a"===a.tagName.toLowerCase()&&c.DomUtil.addClass(a,"leaflet-active");this._holdTimeout=setTimeout(c.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",b))},this),1E3);this._simulateEvent("mousedown",b);c.DomEvent.on(m,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(a){clearTimeout(this._holdTimeout);c.DomEvent.off(m,{touchmove:this._onMove,touchend:this._onUp},this);if(this._fireClick&&a&&a.changedTouches){a=a.changedTouches[0];var b=a.target;b&&b.tagName&&"a"===b.tagName.toLowerCase()&&c.DomUtil.removeClass(b,"leaflet-active");this._simulateEvent("mouseup",a);this._isTapValid()&&this._simulateEvent("click",a)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){a=a.touches[0];this._newPos=new c.Point(a.clientX,a.clientY);this._simulateEvent("mousemove",a)},_simulateEvent:function(a,b){var c=m.createEvent("MouseEvents");c._simulated=!0;b.target._simulatedClick=!0;c.initMouseEvent(a,!0,!0,f,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null);b.target.dispatchEvent(c)}});c.Browser.touch&&!c.Browser.pointer&&c.Map.addInitHook("addHandler","tap",c.Map.Tap);c.Map.mergeOptions({boxZoom:!0});c.Map.BoxZoom=c.Handler.extend({initialize:function(a){this._map=a;this._container=a._container;this._pane=a._panes.overlayPane},addHooks:function(){c.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){c.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(a){if(!a.shiftKey||1!==a.which&&1!==a.button)return!1;this._resetState();c.DomUtil.disableTextSelection();c.DomUtil.disableImageDrag();this._startPoint=this._map.mouseEventToContainerPoint(a);c.DomEvent.on(m,{contextmenu:c.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(a){this._moved||(this._moved=!0,this._box=c.DomUtil.create("div","leaflet-zoom-box",this._container),c.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart"));this._point=this._map.mouseEventToContainerPoint(a);a=new c.Bounds(this._point,this._startPoint);var b=a.getSize();c.DomUtil.setPosition(this._box,a.min);this._box.style.width=b.x+"px";this._box.style.height=b.y+"px"},_finish:function(){this._moved&&(c.DomUtil.remove(this._box),c.DomUtil.removeClass(this._container,"leaflet-crosshair"));c.DomUtil.enableTextSelection();c.DomUtil.enableImageDrag();c.DomEvent.off(m,{contextmenu:c.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(a){if(1===a.which||1===a.button)this._finish(),this._moved&&(setTimeout(c.bind(this._resetState,this),0),a=new c.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point)),this._map.fitBounds(a).fire("boxzoomend",{boxZoomBounds:a}))},_onKeyDown:function(a){27===a.keyCode&&this._finish()}});c.Map.addInitHook("addHandler","boxZoom",c.Map.BoxZoom);c.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80});c.Map.Keyboard=c.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(a){this._map=a;this._setPanDelta(a.options.keyboardPanDelta);this._setZoomDelta(a.options.zoomDelta)},addHooks:function(){var a=this._map._container;0>=a.tabIndex&&(a.tabIndex="0");c.DomEvent.on(a,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this);this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks();c.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this);this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var a=m.body,b=m.documentElement,c=a.scrollTop||b.scrollTop,a=a.scrollLeft||b.scrollLeft;this._map._container.focus();f.scrollTo(a,c)}},_onFocus:function(){this._focused=!0;this._map.fire("focus")},_onBlur:function(){this._focused=!1;this._map.fire("blur")},_setPanDelta:function(a){var b=this._panKeys={},c=this.keyCodes,e,g;e=0;for(g=c.left.length;e<g;e++)b[c.left[e]]=[-1*a,0];e=0;for(g=c.right.length;e<g;e++)b[c.right[e]]=[a,0];e=0;for(g=c.down.length;e<g;e++)b[c.down[e]]=[0,a];e=0;for(g=c.up.length;e<g;e++)b[c.up[e]]=[0,-1*a]},_setZoomDelta:function(a){var b=this._zoomKeys={},c=this.keyCodes,e,g;e=0;for(g=c.zoomIn.length;e<g;e++)b[c.zoomIn[e]]=a;e=0;for(g=c.zoomOut.length;e<g;e++)b[c.zoomOut[e]]=-a},_addHooks:function(){c.DomEvent.on(m,"keydown",this._onKeyDown,this)},_removeHooks:function(){c.DomEvent.off(m,"keydown",this._onKeyDown,this)},_onKeyDown:function(a){if(!(a.altKey||a.ctrlKey||a.metaKey)){var b=a.keyCode,d=this._map;if(b in this._panKeys){if(d._panAnim&&d._panAnim._inProgress)return;b=this._panKeys[b];a.shiftKey&&(b=c.point(b).multiplyBy(3));d.panBy(b);d.options.maxBounds&&d.panInsideBounds(d.options.maxBounds)}else if(b in this._zoomKeys)d.setZoom(d.getZoom()+(a.shiftKey?3:1)*this._zoomKeys[b]);else if(27===b)d.closePopup();else return;c.DomEvent.stop(a)}}});c.Map.addInitHook("addHandler","keyboard",c.Map.Keyboard);c.Handler.MarkerDrag=c.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new c.Draggable(a,a,!0));this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable();c.DomUtil.addClass(a,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable();this._marker._icon&&c.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(a){var b=this._marker,d=b._shadow,e=c.DomUtil.getPosition(b._icon),g=b._map.layerPointToLatLng(e);d&&c.DomUtil.setPosition(d,e);b._latlng=g;a.latlng=g;b.fire("move",a).fire("drag",a)},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}});c.Control=c.Class.extend({options:{position:"topright"},initialize:function(a){c.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;b&&b.removeControl(this);this.options.position=a;b&&b.addControl(this);return this},getContainer:function(){return this._container},addTo:function(a){this.remove();this._map=a;var b=this._container=this.onAdd(a),d=this.getPosition();a=a._controlCorners[d];c.DomUtil.addClass(b,"leaflet-control");-1!==d.indexOf("bottom")?a.insertBefore(b,a.firstChild):a.appendChild(b);return this},remove:function(){if(!this._map)return this;c.DomUtil.remove(this._container);if(this.onRemove)this.onRemove(this._map);this._map=null;return this},_refocusOnMap:function(a){this._map&&a&&0<a.screenX&&0<a.screenY&&this._map.getContainer().focus()}});c.control=function(a){return new c.Control(a)};c.Map.include({addControl:function(a){a.addTo(this);return this},removeControl:function(a){a.remove();return this},_initControlPos:function(){function a(a,g){b[a+g]=c.DomUtil.create("div","leaflet-"+a+" leaflet-"+g,d)}var b=this._controlCorners={},d=this._controlContainer=c.DomUtil.create("div","leaflet-control-container",this._container);a("top","left");a("top","right");a("bottom","left");a("bottom","right")},_clearControlPos:function(){c.DomUtil.remove(this._controlContainer)}});c.Control.Zoom=c.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(a){var b=c.DomUtil.create("div","leaflet-control-zoom leaflet-bar"),d=this.options;this._zoomInButton=this._createButton(d.zoomInText,d.zoomInTitle,"leaflet-control-zoom-in",b,this._zoomIn);this._zoomOutButton=this._createButton(d.zoomOutText,d.zoomOutTitle,"leaflet-control-zoom-out",b,this._zoomOut);this._updateDisabled();a.on("zoomend zoomlevelschange",this._updateDisabled,this);return b},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){this._disabled=!0;this._updateDisabled();return this},enable:function(){this._disabled=!1;this._updateDisabled();return this},_zoomIn:function(a){this._disabled||this._map.zoomIn(this._map.options.zoomDelta*(a.shiftKey?3:1))},_zoomOut:function(a){this._disabled||this._map.zoomOut(this._map.options.zoomDelta*(a.shiftKey?3:1))},_createButton:function(a,b,d,e,g){d=c.DomUtil.create("a",d,e);d.innerHTML=a;d.href="#";d.title=b;c.DomEvent.on(d,"mousedown dblclick",c.DomEvent.stopPropagation).on(d,"click",c.DomEvent.stop).on(d,"click",g,this).on(d,"click",this._refocusOnMap,this);return d},_updateDisabled:function(){var a=this._map;c.DomUtil.removeClass(this._zoomInButton,"leaflet-disabled");c.DomUtil.removeClass(this._zoomOutButton,"leaflet-disabled");(this._disabled||a._zoom===a.getMinZoom())&&c.DomUtil.addClass(this._zoomOutButton,"leaflet-disabled");(this._disabled||a._zoom===a.getMaxZoom())&&c.DomUtil.addClass(this._zoomInButton,"leaflet-disabled")}});c.Map.mergeOptions({zoomControl:!0});c.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new c.Control.Zoom,this.addControl(this.zoomControl))});c.control.zoom=function(a){return new c.Control.Zoom(a)};c.Control.Attribution=c.Control.extend({options:{position:"bottomright",prefix:'\x3ca href\x3d"http://leafletjs.com" title\x3d"A JS library for interactive maps"\x3eLeaflet\x3c/a\x3e'},initialize:function(a){c.setOptions(this,a);this._attributions={}},onAdd:function(a){a.attributionControl=this;this._container=c.DomUtil.create("div","leaflet-control-attribution");c.DomEvent&&c.DomEvent.disableClickPropagation(this._container);for(var b in a._layers)a._layers[b].getAttribution&&this.addAttribution(a._layers[b].getAttribution());this._update();return this._container},setPrefix:function(a){this.options.prefix=a;this._update();return this},addAttribution:function(a){if(!a)return this;this._attributions[a]||(this._attributions[a]=0);this._attributions[a]++;this._update();return this},removeAttribution:function(a){if(!a)return this;this._attributions[a]&&(this._attributions[a]--,this._update());return this},_update:function(){if(this._map){var a=[],b;for(b in this._attributions)this._attributions[b]&&a.push(b);b=[];this.options.prefix&&b.push(this.options.prefix);a.length&&b.push(a.join(", "));this._container.innerHTML=b.join(" | ")}}});c.Map.mergeOptions({attributionControl:!0});c.Map.addInitHook(function(){this.options.attributionControl&&(new c.Control.Attribution).addTo(this)});c.control.attribution=function(a){return new c.Control.Attribution(a)};c.Control.Scale=c.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(a){var b=c.DomUtil.create("div","leaflet-control-scale"),d=this.options;this._addScales(d,"leaflet-control-scale-line",b);a.on(d.updateWhenIdle?"moveend":"move",this._update,this);a.whenReady(this._update,this);return b},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(a,b,d){a.metric&&(this._mScale=c.DomUtil.create("div",b,d));a.imperial&&(this._iScale=c.DomUtil.create("div",b,d))},_update:function(){var a=this._map,b=a.getSize().y/2,a=a.distance(a.containerPointToLatLng([0,b]),a.containerPointToLatLng([this.options.maxWidth,b]));this._updateScales(a)},_updateScales:function(a){this.options.metric&&a&&this._updateMetric(a);this.options.imperial&&a&&this._updateImperial(a)},_updateMetric:function(a){var b=this._getRoundNum(a);this._updateScale(this._mScale,1E3>b?b+" m":b/1E3+" km",b/a)},_updateImperial:function(a){a*=3.2808399;var b;5280<a?(a/=5280,b=this._getRoundNum(a),this._updateScale(this._iScale,b+" mi",b/a)):(b=this._getRoundNum(a),this._updateScale(this._iScale,b+" ft",b/a))},_updateScale:function(a,b,c){a.style.width=Math.round(this.options.maxWidth*c)+"px";a.innerHTML=b},_getRoundNum:function(a){var b=Math.pow(10,(Math.floor(a)+"").length-1);a/=b;return b*(10<=a?10:5<=a?5:3<=a?3:2<=a?2:1)}});c.control.scale=function(a){return new c.Control.Scale(a)};c.Control.Layers=c.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1},initialize:function(a,b,d){c.setOptions(this,d);this._layers=[];this._lastZIndex=0;this._handlingClick=!1;for(var e in a)this._addLayer(a[e],e);for(e in b)this._addLayer(b[e],e,!0)},onAdd:function(a){this._initLayout();this._update();this._map=a;a.on("zoomend",this._checkDisabledLayers,this);return this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var a in this._layers)this._layers[a].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(a,b){this._addLayer(a,b);return this._map?this._update():this},addOverlay:function(a,b){this._addLayer(a,b,!0);return this._map?this._update():this},removeLayer:function(a){a.off("add remove",this._onLayerChange,this);a=this._getLayer(c.stamp(a));this._layers.splice(this._layers.indexOf(a),1);return this._map?this._update():this},expand:function(){c.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");this._form.style.height=null;var a=this._map.getSize().y-(this._container.offsetTop+50);a<this._form.clientHeight?(c.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=a+"px"):c.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar");this._checkDisabledLayers();return this},collapse:function(){c.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded");return this},_initLayout:function(){var a=this._container=c.DomUtil.create("div","leaflet-control-layers");a.setAttribute("aria-haspopup",!0);c.DomEvent.disableClickPropagation(a);c.Browser.touch||c.DomEvent.disableScrollPropagation(a);var b=this._form=c.DomUtil.create("form","leaflet-control-layers-list");if(this.options.collapsed){if(!c.Browser.android)c.DomEvent.on(a,{mouseenter:this.expand,mouseleave:this.collapse},this);var d=this._layersLink=c.DomUtil.create("a","leaflet-control-layers-toggle",a);d.href="#";d.title="Layers";if(c.Browser.touch)c.DomEvent.on(d,"click",c.DomEvent.stop).on(d,"click",this.expand,this);else c.DomEvent.on(d,"focus",this.expand,this);c.DomEvent.on(b,"click",function(){setTimeout(c.bind(this._onInputClick,this),0)},this);this._map.on("click",this.collapse,this)}else this.expand();this._baseLayersList=c.DomUtil.create("div","leaflet-control-layers-base",b);this._separator=c.DomUtil.create("div","leaflet-control-layers-separator",b);this._overlaysList=c.DomUtil.create("div","leaflet-control-layers-overlays",b);a.appendChild(b)},_getLayer:function(a){for(var b=0;b<=this._layers.length;b++)if(c.stamp(this._layers[b].layer)===a)return this._layers[b]},_addLayer:function(a,b,c){a.on("add remove",this._onLayerChange,this);this._layers.push({layer:a,name:b,overlay:c});this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;c.DomUtil.empty(this._baseLayersList);c.DomUtil.empty(this._overlaysList);var a,b,d,e,g=0;for(d in this._layers)e=this._layers[d],this._addItem(e),b=b||e.overlay,a=a||!e.overlay,g+=e.overlay?0:1;this.options.hideSingleBase&&(a=a&&1<g,this._baseLayersList.style.display=a?"":"none");this._separator.style.display=b&&a?"":"none";return this},_onLayerChange:function(a){this._handlingClick||this._update();var b=this._getLayer(c.stamp(a.target));(a=b.overlay?"add"===a.type?"overlayadd":"overlayremove":"add"===a.type?"baselayerchange":null)&&this._map.fire(a,b)},_createRadioElement:function(a,b){var c='\x3cinput type\x3d"radio" class\x3d"leaflet-control-layers-selector" name\x3d"'+a+'"'+(b?' checked\x3d"checked"':"")+"/\x3e",e=m.createElement("div");e.innerHTML=c;return e.firstChild},_addItem:function(a){var b=m.createElement("label"),d=this._map.hasLayer(a.layer),e;a.overlay?(e=m.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=d):e=this._createRadioElement("leaflet-base-layers",d);e.layerId=c.stamp(a.layer);c.DomEvent.on(e,"click",this._onInputClick,this);d=m.createElement("span");d.innerHTML=" "+a.name;var g=m.createElement("div");b.appendChild(g);g.appendChild(e);g.appendChild(d);(a.overlay?this._overlaysList:this._baseLayersList).appendChild(b);this._checkDisabledLayers();return b},_onInputClick:function(){var a=this._form.getElementsByTagName("input"),b,c,e,g=[],f=[];this._handlingClick=!0;for(var h=a.length-1;0<=h;h--)b=a[h],c=this._getLayer(b.layerId).layer,e=this._map.hasLayer(c),b.checked&&!e?g.push(c):!b.checked&&e&&f.push(c);for(h=0;h<f.length;h++)this._map.removeLayer(f[h]);for(h=0;h<g.length;h++)this._map.addLayer(g[h]);this._handlingClick=!1;this._refocusOnMap()},_checkDisabledLayers:function(){for(var a=this._form.getElementsByTagName("input"),b,c,e=this._map.getZoom(),g=a.length-1;0<=g;g--)b=a[g],c=this._getLayer(b.layerId).layer,b.disabled=c.options.minZoom!==n&&e<c.options.minZoom||c.options.maxZoom!==n&&e>c.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}});c.control.layers=function(a,b,d){return new c.Control.Layers(a,b,d)};c.PosAnimation=c.Evented.extend({run:function(a,b,d,e){this.stop();this._el=a;this._inProgress=!0;this._duration=d||.25;this._easeOutPower=1/Math.max(e||.5,.2);this._startPos=c.DomUtil.getPosition(a);this._offset=b.subtract(this._startPos);this._startTime=+new Date;this.fire("start");this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=c.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(a){var b=+new Date-this._startTime,c=1E3*this._duration;b<c?this._runFrame(this._easeOut(b/c),a):(this._runFrame(1),this._complete())},_runFrame:function(a,b){var d=this._startPos.add(this._offset.multiplyBy(a));b&&d._round();c.DomUtil.setPosition(this._el,d);this.fire("step")},_complete:function(){c.Util.cancelAnimFrame(this._animId);this._inProgress=!1;this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}});c.Map.include({setView:function(a,b,d){b=b===n?this._zoom:this._limitZoom(b);a=this._limitCenter(c.latLng(a),b,this.options.maxBounds);d=d||{};this._stop();if(this._loaded&&!d.reset&&!0!==d&&(d.animate!==n&&(d.zoom=c.extend({animate:d.animate},d.zoom),d.pan=c.extend({animate:d.animate,duration:d.duration},d.pan)),this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,b,d.zoom):this._tryAnimatedPan(a,d.pan)))return clearTimeout(this._sizeTimer),this;this._resetView(a,b);return this},panBy:function(a,b){a=c.point(a).round();b=b||{};if(!a.x&&!a.y)return this.fire("moveend");if(!0!==b.animate&&!this.getSize().contains(a))return this._resetView(this.unproject(this.project(this.getCenter()).add(a)),this.getZoom()),this;this._panAnim||(this._panAnim=new c.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this));b.noMoveStart||this.fire("movestart");if(!1!==b.animate){c.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var d=this._getMapPanePos().subtract(a).round();this._panAnim.run(this._mapPane,d,b.duration||.25,b.easeLinearity)}else this._rawPanBy(a),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){c.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(a,b){var c=this._getCenterOffset(a)._floor();if(!0!==(b&&b.animate)&&!this.getSize().contains(c))return!1;this.panBy(c,b);return!0}});c.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4});(h=c.DomUtil.TRANSITION&&c.Browser.any3d&&!c.Browser.mobileOpera)&&c.Map.addInitHook(function(){if(this._zoomAnimated=this.options.zoomAnimation)this._createAnimProxy(),c.DomEvent.on(this._proxy,c.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)});c.Map.include(h?{_createAnimProxy:function(){var a=this._proxy=c.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(a);this.on("zoomanim",function(b){var d=c.DomUtil.TRANSFORM,e=a.style[d];c.DomUtil.setTransform(a,this.project(b.center,b.zoom),this.getZoomScale(b.zoom,1));e===a.style[d]&&this._animatingZoom&&this._onZoomTransitionEnd()},this);this.on("load moveend",function(){var b=this.getCenter(),d=this.getZoom();c.DomUtil.setTransform(a,this.project(b,d),this.getZoomScale(d,1))},this)},_catchTransitionEnd:function(a){this._animatingZoom&&0<=a.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(a,b,d){if(this._animatingZoom)return!0;d=d||{};if(!this._zoomAnimated||!1===d.animate||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var e=this.getZoomScale(b),e=this._getCenterOffset(a)._divideBy(1-1/e);if(!0!==d.animate&&!this.getSize().contains(e))return!1;c.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(a,b,!0)},this);return!0},_animateZoom:function(a,b,d,e){d&&(this._animatingZoom=!0,this._animateToCenter=a,this._animateToZoom=b,c.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"));this.fire("zoomanim",{center:a,zoom:b,noUpdate:e});setTimeout(c.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(c.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),c.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}:{});c.Map.include({flyTo:function(a,b,d){function e(a){a=(z*z-w*w+2.0164*(a?-1:1)*2.0164*m*m)/(4.0328*(a?z:w)*m);a=Math.sqrt(a*a+1)-a;return 1E-9>a?-18:Math.log(a)}function g(a){return(Math.exp(a)-Math.exp(-a))/2}function f(a){return(Math.exp(a)+Math.exp(-a))/2}function h(a){return w*(f(x)/f(x+1.42*a))}function k(a){var b=f(x);a=x+1.42*a;a=g(a)/f(a);return w*(b*a-g(x))/2.0164}function p(){var d=(Date.now()-A)/B,e=(1-Math.pow(1-d,1.5))*D;1>=d?(this._flyToFrame=c.Util.requestAnimFrame(p,this),this._move(this.unproject(r.add(q.subtract(r).multiplyBy(k(e)/m)),v),this.getScaleZoom(w/h(e),v),{flyTo:!0})):this._move(a,b)._moveEnd(!0)}d=d||{};if(!1===d.animate||!c.Browser.any3d)return this.setView(a,b,d);this._stop();var r=this.project(this.getCenter()),q=this.project(a),t=this.getSize(),v=this._zoom;a=c.latLng(a);b=b===n?v:b;var w=Math.max(t.x,t.y),z=w*this.getZoomScale(v,b),m=q.distanceTo(r)||1,x=e(0),A=Date.now(),D=(e(1)-x)/1.42,B=d.duration?1E3*d.duration:800*D;this._moveStart(!0);p.call(this);return this},flyToBounds:function(a,b){var c=this._getBoundsCenterZoom(a,b);return this.flyTo(c.center,c.zoom,b)}});c.Map.include({_defaultLocateOptions:{timeout:1E4,watch:!1},locate:function(a){a=this._locateOptions=c.extend({},this._defaultLocateOptions,a);if(!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=c.bind(this._handleGeolocationResponse,this),d=c.bind(this._handleGeolocationError,this);a.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,d,a):navigator.geolocation.getCurrentPosition(b,d,a);return this},stopLocate:function(){navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId);this._locateOptions&&(this._locateOptions.setView=!1);return this},_handleGeolocationError:function(a){var b=a.code;a=a.message||(1===b?"permission denied":2===b?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld();this.fire("locationerror",{code:b,message:"Geolocation error: "+a+"."})},_handleGeolocationResponse:function(a){var b=new c.LatLng(a.coords.latitude,a.coords.longitude),d=b.toBounds(a.coords.accuracy),e=this._locateOptions;if(e.setView){var g=this.getBoundsZoom(d);this.setView(b,e.maxZoom?Math.min(g,e.maxZoom):g)}var b={latlng:b,bounds:d,timestamp:a.timestamp},f;for(f in a.coords)"number"===typeof a.coords[f]&&(b[f]=a.coords[f]);this.fire("locationfound",b)}})})(window,document);L.Map.include({hittest:function(f,m){var n=this.searchBuffer(userMarker.getLatLng(),Math.abs(map.getBounds().getNorth()-map.getBounds().getSouth()/10)),z=[];if(n)for(var c=0;c<n.length;c++)f!=n[c]&&this.distance(f.getLatLng(),n[c].getLatLng())<m&&z.push(n[c]);return z},clearIndex:function(){delete this._rtree},search:function(f){f=this._rtbounds(f);if(!this._rtree)return this._rtree;f=this._rtree.search(f)||[];for(var m=[],n=0;n<f.length;n++)m.push(f[n]);return m},searchBuffer:function(f,m){var n=L.latLngBounds(L.latLng(f.lat-m,f.lng-m),L.latLng(f.lat+m,f.lng+m));return this.search(n)},indexLayer:function(f){if(void 0===this.options.indexing||this.options.indexing){var m=this._layerBounds(f);this._rtree||(this._rtree=new RTree);this._rtree.insert(this._rtbounds(m),f)}},unindexLayer:function(f,m){this._rtree.remove(this._rtbounds(f),m)},_layerBounds:function(f){var m=null;f instanceof L.LayerGroup?(m=new L.LatLngBounds,f.eachLayer(function(f){f instanceof L.Circle||f instanceof L.Marker?m.extend(f.getLatLng()):f instanceof L.LayerGroup?m.extend(this._layerBounds(f)):m.extend(f.getBounds())},this)):"function"==typeof f.getLatLng?m=new L.LatLngBounds(f.getLatLng(),f.getLatLng()):"function"==typeof f.getBounds&&(m=f.getBounds());if(!m||!m.isValid())throw"Unable to get layer bounds";return m},_rtbounds:function(f){return{x:f.getSouthWest().lng,y:f.getSouthWest().lat,w:f.getSouthEast().lng-f.getSouthWest().lng,h:f.getNorthWest().lat-f.getSouthWest().lat}}});var RTree=function(f){var m=3,n=6;isNaN(f)||(m=Math.floor(f/2),n=f);var z={x:0,y:0,w:0,h:0,id:"root",nodes:[]},c=function(){var a={};return function(b){var c=0;b in a?c=a[b]++:a[b]=0;return b+"_"+c}}();RTree.Rectangle.squarified_ratio=function(a,b,c){var f=(a+b)/2;a*=b;return a*c/(a/(f*f))};var h=function(c,e,g){var f=[],h=[],k=[],p=1;if(!c||!RTree.Rectangle.overlap_rectangle(c,g))return k;c={x:c.x,y:c.y,w:c.w,h:c.h,target:e};h.push(g.nodes.length);f.push(g);do{g=f.pop();e=h.pop()-1;if("target"in c)for(;0<=e;){var r=g.nodes[e];if(RTree.Rectangle.overlap_rectangle(c,r))if(c.target&&"leaf"in r&&r.leaf===c.target||!c.target&&("leaf"in r||RTree.Rectangle.contains_rectangle(r,c))){"nodes"in r?(k=a(r,!0,[],r),g.nodes.splice(e,1)):k=g.nodes.splice(e,1);RTree.Rectangle.make_MBR(g.nodes,g);delete c.target;g.nodes.length<m&&(c.nodes=a(g,!0,[],g));break}else"nodes"in r&&(p+=1,h.push(e),f.push(g),g=r,e=r.nodes.length);--e}else if("nodes"in c){g.nodes.splice(e+1,1);0<g.nodes.length&&RTree.Rectangle.make_MBR(g.nodes,g);for(e=0;e<c.nodes.length;e++)b(c.nodes[e],g);c.nodes.length=0;0==f.length&&1>=g.nodes.length?(c.nodes=a(g,!0,c.nodes,g),g.nodes.length=0,f.push(g),h.push(1)):0<f.length&&g.nodes.length<m?(c.nodes=a(g,!0,c.nodes,g),g.nodes.length=0):delete c.nodes}else RTree.Rectangle.make_MBR(g.nodes,g);--p}while(0<f.length);return k},a=function(a,b,c,f){var h=[];if(!RTree.Rectangle.overlap_rectangle(a,f))return c;h.push(f.nodes);do{f=h.pop();for(var k=f.length-1;0<=k;k--){var p=f[k];RTree.Rectangle.overlap_rectangle(a,p)&&("nodes"in p?h.push(p.nodes):"leaf"in p&&(b?c.push(p):c.push(p.leaf)))}}while(0<h.length);return c},b=function(a,b){var c;if(0==b.nodes.length)b.x=a.x,b.y=a.y,b.w=a.w,b.h=a.h,b.nodes.push(a);else{var f=-1,h=[],k;h.push(b);var p=b.nodes;do{-1!=f&&(h.push(p[f]),p=p[f].nodes,f=-1);for(var r=p.length-1;0<=r;r--){var q=p[r];if("leaf"in q){f=-1;break}var t=RTree.Rectangle.squarified_ratio(q.w,q.h,q.nodes.length+1),v=Math.max(q.x+q.w,a.x+a.w)-Math.min(q.x,a.x),w=Math.max(q.y+q.h,a.y+a.h)-Math.min(q.y,a.y),q=RTree.Rectangle.squarified_ratio(v,w,q.nodes.length+2);if(0>f||Math.abs(q-t)<k)k=Math.abs(q-t),f=r}}while(-1!=f);f=a;do{if(c&&"nodes"in c&&0==c.nodes.length)for(k=c,c=h.pop(),p=0;p<c.nodes.length;p++){if(c.nodes[p]===k||0==c.nodes[p].nodes.length){c.nodes.splice(p,1);break}}else c=h.pop();if("leaf"in f||"nodes"in f||"[object Array]"===Object.prototype.toString.call(f)){if("[object Array]"===Object.prototype.toString.call(f)){for(k=0;k<f.length;k++)RTree.Rectangle.expand_rectangle(c,f[k]);c.nodes=c.nodes.concat(f)}else RTree.Rectangle.expand_rectangle(c,f),c.nodes.push(f);if(c.nodes.length<=n)f={x:c.x,y:c.y,w:c.w,h:c.h};else{k=f=c.nodes;p=k.length-1;r=0;t=k.length-1;q=0;w=v=void 0;for(v=k.length-2;0<=v;v--)w=k[v],w.x>k[r].x?r=v:w.x+w.w<k[p].x+k[p].w&&(p=v),w.y>k[q].y?q=v:w.y+w.h<k[t].y+k[t].h&&(t=v);v=Math.abs(k[p].x+k[p].w-k[r].x);w=Math.abs(k[t].y+k[t].h-k[q].y);v>w?p>r?(v=k.splice(p,1)[0],w=k.splice(r,1)[0]):(w=k.splice(r,1)[0],v=k.splice(p,1)[0]):t>q?(v=k.splice(t,1)[0],w=k.splice(q,1)[0]):(w=k.splice(q,1)[0],v=k.splice(t,1)[0]);for(k=[{x:v.x,y:v.y,w:v.w,h:v.h,nodes:[v]},{x:w.x,y:w.y,w:w.w,h:w.h,nodes:[w]}];0<f.length;){for(var p=f,r=k[0],t=k[1],v=RTree.Rectangle.squarified_ratio(r.w,r.h,r.nodes.length+1),w=RTree.Rectangle.squarified_ratio(t.w,t.h,t.nodes.length+1),z=void 0,u=void 0,q=void 0,x=p.length-1;0<=x;x--){var A=p[x],D,B;D=Math.min(r.x,A.x);B=Math.min(r.y,A.y);D=Math.max(r.x+r.w,A.x+A.w)-D;B=Math.max(r.y+r.h,A.y+A.h)-B;B=Math.abs(RTree.Rectangle.squarified_ratio(D,B,r.nodes.length+2)-v);var F;F=Math.min(t.x,A.x);D=Math.min(t.y,A.y);F=Math.max(t.x+t.w,A.x+A.w)-F;A=Math.max(t.y+t.h,A.y+A.h)-D;A=Math.abs(RTree.Rectangle.squarified_ratio(F,A,t.nodes.length+2)-w);if(!u||!z||Math.abs(A-B)<z)u=x,z=Math.abs(A-B),q=A<B?t:r}v=p.splice(u,1)[0];r.nodes.length+p.length+1<=m?(r.nodes.push(v),RTree.Rectangle.expand_rectangle(r,v)):t.nodes.length+p.length+1<=m?(t.nodes.push(v),RTree.Rectangle.expand_rectangle(t,v)):(q.nodes.push(v),RTree.Rectangle.expand_rectangle(q,v))}f=k;1>h.length&&(c.nodes.push(k[0]),h.push(c),f=k[1])}}else RTree.Rectangle.expand_rectangle(c,f),f={x:c.x,y:c.y,w:c.w,h:c.h}}while(0<h.length)}};this.get_tree=function(){return z};this.set_tree=function(a,b){b||(b=z);var c=b;c.nodes=a.nodes;c.x=a.x;c.y=a.y;c.w=a.w;c.h=a.h;return c};this.search=function(b,c,g){if(1>arguments.length)throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=!1;case 2:arguments[2]=[];case 3:arguments[3]=z;default:arguments.length=4}return a.apply(this,arguments)};this.toJSON=function(a,b){var g=[],f=[],h={},k=3,p=1,r="";if(a&&!RTree.Rectangle.overlap_rectangle(a,z))return"";b?(k+=4,f.push(b.nodes.length),g.push(b.nodes),r+="var main_tree \x3d {x:"+b.x.toFixed()+",y:"+b.y.toFixed()+",w:"+b.w.toFixed()+",h:"+b.h.toFixed()+",nodes:["):(f.push(z.nodes.length),g.push(z.nodes),r+="var main_tree \x3d {x:"+z.x.toFixed()+",y:"+z.y.toFixed()+",w:"+z.w.toFixed()+",h:"+z.h.toFixed()+",nodes:[");do{var q=g.pop(),t=f.pop()-1;for(0<=t&&t<q.length-1&&(r+=",");0<=t;){var v=q[t];if(!a||RTree.Rectangle.overlap_rectangle(a,v))if(v.nodes)if(p>=k){var w=c("saved_subtree"),r=r+("{x:"+v.x.toFixed()+",y:"+v.y.toFixed()+",w:"+v.w.toFixed()+",h:"+v.h.toFixed()+",load:'"+w+".js'}");h[w]=this.toJSON(a,v);0<t&&(r+=",")}else r+="{x:"+v.x.toFixed()+",y:"+v.y.toFixed()+",w:"+v.w.toFixed()+",h:"+v.h.toFixed()+",nodes:[",p+=1,f.push(t),g.push(q),q=v.nodes,t=v.nodes.length;else v.leaf?(w=v.leaf.toJSON?v.leaf.toJSON():JSON.stringify(v.leaf),r+="{x:"+v.x.toFixed()+",y:"+v.y.toFixed()+",w:"+v.w.toFixed()+",h:"+v.h.toFixed()+",leaf:"+w+"}",0<t&&(r+=",")):v.load&&(r+="{x:"+v.x.toFixed()+",y:"+v.y.toFixed()+",w:"+v.w.toFixed()+",h:"+v.h.toFixed()+",load:'"+v.load+"'}",0<t&&(r+=","));--t}0>t&&(r+="]}",--p)}while(0<g.length);var r=r+";",m;for(m in h)r+="\nvar "+m+" \x3d function(){"+h[m]+" return(main_tree);};";return r};this.remove=function(a,b){if(1>arguments.length)throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=!1;case 2:arguments[2]=z;default:arguments.length=3}if(!1===arguments[1]){var c=0,f=[];do c=f.length,f=f.concat(h.apply(this,arguments));while(c!=f.length);return f}return h.apply(this,arguments)};this.insert=function(a,c){if(2>arguments.length)throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object.";return b({x:a.x,y:a.y,w:a.w,h:a.h,leaf:c},z)}};RTree.Rectangle=function(f,m,n,z){var c,h,a,b,d,e;f.x?(c=f.x,a=f.y,0!==f.w&&!f.w&&f.x2?(d=f.x2-f.x,e=f.y2-f.y):(d=f.w,e=f.h)):(c=f,a=m,d=n,e=z);h=c+d;b=a+e;this.x1=this.x=function(){return c};this.y1=this.y=function(){return a};this.x2=function(){return h};this.y2=function(){return b};this.w=function(){return d};this.h=function(){return e};this.toJSON=function(){return'{"x":'+c.toString()+', "y":'+a.toString()+', "w":'+d.toString()+', "h":'+e.toString()+"}"};this.overlap=function(a){return this.x()<a.x2()&&this.x2()>a.x()&&this.y()<a.y2()&&this.y2()>a.y()};this.expand=function(b){var f=Math.min(this.x(),b.x()),h=Math.min(this.y(),b.y());d=Math.max(this.x2(),b.x2())-f;e=Math.max(this.y2(),b.y2())-h;c=f;a=h;return this};this.setRect=function(a,b,c,d){}};RTree.Rectangle.overlap_rectangle=function(f,m){return f.x<m.x+m.w&&f.x+f.w>m.x&&f.y<m.y+m.h&&f.y+f.h>m.y};RTree.Rectangle.contains_rectangle=function(f,m){return f.x+f.w<=m.x+m.w&&f.x>=m.x&&f.y+f.h<=m.y+m.h&&f.y>=m.y};RTree.Rectangle.expand_rectangle=function(f,m){var n=Math.min(f.x,m.x),z=Math.min(f.y,m.y);f.w=Math.max(f.x+f.w,m.x+m.w)-n;f.h=Math.max(f.y+f.h,m.y+m.h)-z;f.x=n;f.y=z;return f};RTree.Rectangle.make_MBR=function(f,m){if(1>f.length)return{x:0,y:0,w:0,h:0};m?m.x=f[0].x:m={x:f[0].x,y:f[0].y,w:f[0].w,h:f[0].h};m.y=f[0].y;m.w=f[0].w;m.h=f[0].h;for(var n=f.length-1;0<n;n--)RTree.Rectangle.expand_rectangle(m,f[n]);return m};(function(f){"Function"===typeof define?define(f()):f(window.Rtmap||{})})(function(f){var m={enable:!0,airportpoi:{18:"\u673a\u573a\u76f8\u5173POI",isAirportpoi:function(f){return f?0==f.toString().indexOf("18")?!0:!1:!1}},restaurantpoi:{10:"\u9910\u996e\u76f8\u5173",isRestaurantPoi:function(f){return f?0==f.toString().indexOf("10")?!0:!1:!1}},businesspoi:{11:"\u670d\u9970\u978b\u5305",12:"\u8d2d\u7269\u76f8\u5173",13:"\u4f11\u95f2\u5a31\u4e50",isBusinessPoi:function(f){return f?0==f.toString().indexOf("11")||0==f.toString().indexOf("12")||0==f.toString().indexOf("13")?!0:!1:!1}},travelpoi:{180101:"\u56fd\u5185\u4e58\u673a\u624b\u7eed\u529e\u7406",180102:"\u56fd\u9645\u4e58\u673a\u624b\u7eed\u529e\u7406",180201:"\u5b89\u68c0",180301:"\u767b\u673a\u53e3",180502:"\u884c\u674e\u63d0\u53d6",isTravelPoi:function(f){return f?0==f.toString().indexOf("180101")||0==f.toString().indexOf("180102")||0==f.toString().indexOf("180201")||0==f.toString().indexOf("180301")||0==f.toString().indexOf("180502")?!0:!1:!1}},zoomHash:{},twoClassHash:{180301:"static/public/img/boarding.png",180402:"static/public/img/arrive.png",190206:"static/public/img/doorway.png",190401:"static/public/img/information_desk.png",190402:"static/public/img/information_desk.png"},smallIconHash:{150704:"static/public/img/tel.png",190101:"static/public/img/wc.png",190201:"static/public/img/elevator.png",190202:"static/public/img/escalator.png",190203:"static/public/img/stairway_new.png",190303:"static/public/img/power.png"},largeIconHash:{180101:"static/public/img/checkin.png",180102:"static/public/img/checkin.png",180103:"static/public/img/checkin.png",180104:"static/public/img/checkin.png",180105:"static/public/img/checkin.png",180106:"static/public/img/fly.png",180107:"static/public/img/fly.png",180108:"static/public/img/fly.png",180109:"static/public/img/ticket.png",180201:"static/public/img/security.png",180202:"static/public/img/customs.png",180203:"static/public/img/borderdefence.png",180204:"static/public/img/quarantine.png",180401:"static/public/img/transfer.png",180501:"static/public/img/luggageelated.png",180502:"static/public/img/luggageclaim.png",180503:"static/public/img/luggageelated.png",180505:"static/public/img/luggageelated.png",200105:"static/public/img/ticket.png",190500:"static/public/img/reservationcenter.png",190501:"static/public/img/boardingpoint.png"},getLayerStyle:function(f){f=f.feature;var c=f.properties.style;return Rtmap.Classification.enable?Rtmap.Classification.travelpoi.isTravelPoi(f.properties.two_class)?{type:5,fillColor:"#e8c377",color:"#af7d0c",weight:.5,opacity:1,fillOpacity:1,hover:{fillColor:"#dddddd",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1}}:Rtmap.Classification.airportpoi.isAirportpoi(f.properties.two_class)?{type:5,fillColor:"#d0dee2",color:"#8eadc1",weight:.5,opacity:1,fillOpacity:1,hover:{fillColor:"#dddddd",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1}}:Rtmap.Classification.businesspoi.isBusinessPoi(f.properties.two_class)?{type:5,fillColor:"#d8e0ca",color:"#97a869",weight:.5,opacity:1,fillOpacity:1,hover:{fillColor:"#dddddd",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1}}:Rtmap.Classification.restaurantpoi.isRestaurantPoi(f.properties.two_class)?{type:5,fillColor:"#efe5ce",color:"#c9a659",weight:.5,opacity:1,fillOpacity:1,hover:{fillColor:"#dddddd",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1}}:Rtmap.Style.getStyleByPoiType(c):Rtmap.Style.getStyleByPoiType(c)}};f.Classification=m;var n=L.Layer.extend({initialize:function(f,c,h,a){this._latlng=f;this._text=c;this.type=a;L.Util.setOptions(this,h)},options:{offset:new L.Point(0,2)},rePosition:function(f,c){var h={offset:new L.Point(f,c)};L.Util.setOptions(this,h)},moveToCenter:function(){this.getSize();var f=this._size.width,c=this._size.height;this.haveIcon?this.rePosition(-f/2,c/2):$(this._container).find("img").length?"smallIconWithText"==this._iconStyle?this.rePosition(-11,c/2):"largeIconWithText"==this._iconStyle?this.rePosition(-11,c/2):"smallIcon"==this._iconStyle?this.rePosition(-11,c/2):this.rePosition(-7.5,c/2):this.rePosition(-f/2,c/2);this._reset()},getCenterPoint:function(){return"smallIconWithText"==this._iconStyle||"largeIconWithText"==this._iconStyle?new L.Point(this._pos.x+this.getSize().width/2,this._pos.y):this._pos},getSize:function(){this._size||(this._size={width:this._container.clientWidth,height:this._container.clientHeight,padding_left:0});return this._size},getEvents:function(){return{zoom:this._reset,viewreset:this._reset,moveend:this._reset}},onAdd:function(f){this._map=f;this._container||this._initLayout();f.getPanes().overlayPane.appendChild(this._container);var c=Rtmap.Style.getImageConfig(this.two_class);c?(this.haveIcon=!0,this._text=null,this._container.innerHTML='\x3cimg src\x3d"'+c+'" width\x3d"18px" height\x3d"18px"\x3e'):(this.haveIcon=!1,this._container.innerHTML=this._text);f.on("viewreset",this._reset,this);this._reset()},onRemove:function(f){f.getPanes().overlayPane.removeChild(this._container);f.off("viewreset",this._reset,this)},_reset:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._pos=f;f=new L.Point(f.x+this.options.offset.x,f.y-this.options.offset.y);L.DomUtil.setPosition(this._container,f)},addClass:function(f){$(this._container).addClass(f)},_initLayout:function(){f.Config.getOption().PoiStart?this.star=f.Config.getOption().PoiStart[this._text]||0:this.star=0;this._container=L.DomUtil.create("div","rtmap_room_name");if(f.Config.getOption().showIcon){var m=f.Config.getOption().PoiClass[this.class_extension];m&&(this.haveIcon=!0,$(this._container).addClass(m))}(m=f.Style.getGlobalConfig("font_color"))&&$(this._container).css({color:m})},_iconStyle:"none",_nowLayer:null,setDisplayStyle:function(){f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&this.filterByZoom(this._map.getZoom());"circle-point"!=f.Config.getOption().labelStyle?this._iconStyle="none":this.two_class&&(m.twoClassHash[this.two_class]?(this._container.innerHTML="\x3cimg src\x3d"+m.twoClassHash[this.two_class]+" width\x3d'22px'/\x3e"+this._container.textContent,this._iconStyle="smallIconWithText"):m.largeIconHash[this.two_class]?(this._container.innerHTML='\x3cimg src\x3d"'+m.largeIconHash[this.two_class]+'" width\x3d"22px" height\x3d"22px" style\x3d"position: absolute;" \x3e\x3cdiv\x3e'+this._text+"\x3c/div\x3e",this._iconStyle="largeIconWithText"):m.smallIconHash[this.two_class]&&(this._container.innerHTML='\x3cimg src\x3d"'+m.smallIconHash[this.two_class]+'" width\x3d"22px" height\x3d"22px"\x3e',this._iconStyle="smallIcon"));this.moveToCenter()},filterByZoom:function(f){if(f=m.zoomHash[parseInt(f)]){var c=!1;if(this.two_class)for(var h=this.two_class.toString(),a=0;a<f.length;a++)if(0==h.indexOf(f[a])){c=!0;break}c?this.iconLabelShow():this.iconLabelHide()}else this.iconLabelShow()},_labelHideStatus:!1,iconLabelHide:function(){this._labelHideStatus=!0},iconLabelShow:function(){this._labelHideStatus=!1},_geoBound:null,getBounds:function(){if(!this._geoBound){var f=this.getCenterPoint(),c=this._container.clientWidth,h=this._container.clientHeight,a=this._map.layerPointToLatLng([f.x-c/2,f.y-h/2]),f=this._map.layerPointToLatLng([f.x+c/2,f.y+h/2]);this._geoBound=L.latLngBounds(a,f)}return this._geoBound},setZoomVisble:function(f,c){this["zoom"+f+"visble"]=c},getZoomVisble:function(f){return this["zoom"+f+"visble"]},setLabelFontColor:function(f){$(this._container).css({color:f})}});f.Control=function(){var m=null,c=[],h=null,a=null,b=!0,d=null,e=null,g=null,l=null,n=function(){function e(){var a=localStorage.getItem("searchHistory");return a?a.split(","):[]}function g(){localStorage.setItem("searchHistory","")}function l(){t();y();n("clearSearchResult");B=d=null;f.Search.FocusResult=null;h&&(h?Rtmap.Scene.removeLayer(h,!0):"",h=null);Rtmap.Scene.SelectMarker?Rtmap.Scene.removeLayer(Rtmap.Scene.SelectMarker,!0):"";Rtmap.Scene.SelectMarker=null}function t(){D=null;A=1;b=!0;$(E.html).find(".resultListBox").hide();E.hideBackBtn();$(E.html).find(".searchInput").val("");$(E.html).find(".clearInput").hide();$(E.html).find(".resultListBox ul").html("");var a=Rtmap.Scene.SelectMarker;a?Rtmap.Scene.removeLayer(a,!0):"";Rtmap.Scene.SelectMarker=null;n("clearResultList")}function k(a){for(var b=localStorage.getItem("searchHistory"),b=b?b.split(","):[],c=0;c<b.length;c++)if(b[c]==a)return;b.push(a);5<b.length&&b.splice(0,b.length-5);try{localStorage.setItem("searchHistory",b)}catch(d){console.log("please turn off '\u65e0\u75d5\u6d4f\u89c8'!")}}function w(a){t();y();var b=[],d=f.Style.getGlobalConfig("focus_icon_url"),e=f.Style.getGlobalConfig("normal_icon_url"),g=L.icon({iconUrl:d,iconRetinaUrl:d,iconSize:[30,30],iconAnchor:[15,30],shadowSize:[68,95],shadowAnchor:[22,94]}),l=L.icon({iconUrl:e,iconRetinaUrl:e,iconSize:[30,30],iconAnchor:[15,30],shadowSize:[68,95],shadowAnchor:[22,94]});c.length=0;Rtmap.PoiLabelFactory.resetIconStatus();for(d=0;d<a.length;d++){var e=a[d].x,k=a[d].y,p=Rtmap.Scene.getPoiByNum(a[d].floor,a[d].poi_no);p&&(e=p.feature.properties.x_coord,k=p.feature.properties.y_coord);p=Rtmap.Scene.createMarker({icon:0==d?g:l,fillOpacity:1,opacity:1,fillColor:"red",color:"#ddd",size:10,x:e,y:k});c.push(p);p.on("click",function(){for(var a=0;a<c.length;a++)c[a].setIcon(l),delete c[a].selected;this.setIcon(g);this.selected=!0});0==d&&(p.selected=!0);e=L.CRS.EPSG3395.projection.unproject(new L.Point(e,k));b.push(e)}d=Rtmap.Scene.getMap();1<b.length||1==a.length&&Rtmap.Scene.moveTo({x:a[0].x,y:a[0].y},d.zoom);h?Rtmap.Scene.removeLayer(h,!0):"";Rtmap.Scene.removeLayer(h,!0);n("markerSearchToMap",[a,c])}function y(){for(var a=0;a<c.length;a++)Rtmap.Scene.removeLayer(c[a],!0)}function n(a,b){if(G[a])for(var c=0;c<G[a].length;c++)G[a][c].apply(self,b)}var E=null,A=1,D,B=null,F=L.Control.extend({option:{position:"topright"},bindEvent:function(){function c(){var a=$("\x3cul/\x3e"),b=e();if(1>b.length)$(C).find(".searchHistoryBox").hide();else{for(i=b.length-1;-1<i;i--){var f=$("\x3cli/\x3e",{text:b[i],"class":"history_item"});a.append(f);f.click(function(){d=$(this).text();$(C).find(".searchInput").blur();t();$(C).find(".searchInput").val(d);$(C).find(".clearInput").show();E()})}$(C).find(".searchHistoryBox ul").remove();$(C).find(".searchHistoryBox").show().prepend(a)}}function I(c){function d(a,b){a.click(function(){event.stopPropagation();var a=Rtmap.Scene.getNowFloor();b.floor.toLowerCase()!=a&&(n("changeToNearFloor",[b.floor]),Rtmap.Scene.changeFloorTo(b.floor));J(b);window.locationModel="free";Rtmap.Control.disableLocal()})}var e=$(C).find(".resultListBox");e.show();e=e.find("ul");b&&(e.html(""),e[0].scrollTop=0);for(var g=0;g<c.length;g++){var h=$("\x3cli/\x3e",{}),k='\x3cspan class\x3d"poi_name"\x3e'+c[g].name+'\x3c/span\x3e\x3cspan class\x3d"floor"\x3e'+f.Config.getFloorAliasName(c[g].floor)+"\x3c/span\x3e";h.append(k);e.append(h);d(h,c[g])}a=l}function J(b){h?Rtmap.Scene.removeLayer(h,!0):"";var c=f.Style.getGlobalConfig("focus_icon_url"),c=L.icon({iconUrl:c,iconRetinaUrl:c,iconSize:[30,30],iconAnchor:[15,30],shadowSize:[68,95],shadowAnchor:[22,94]});h=Rtmap.Scene.createMarker({x:b.x,y:b.y,icon:c});h.selected=!0;y();Rtmap.Scene.moveTo({x:b.x,y:b.y},19);var d=$(C).find(".resultListBox");d.hide();a=function(){d.show();a=l};B={};B.x=b.x;B.y=b.y;B.floor=b.floor;B.poi_no=b.poi_no;f.Search.FocusResult=B;n("markerSearchToMap",[[b],[h]])}function E(a,b){var c=d;-1<M.getCategoryList().concat(["\u7535\u68af"]).indexOf(c)&&(a="category");""!=c&&(a||k(c),f.Search.request({searchPageIndex:A,keyword:c,searchType:a,className:b||""},function(b,c,d){m=b;D=c.pagecount;if(!(A>D))if(c.poilist&&0<c.poilist.length)if("category"==a){b=Rtmap.Scene.getNowFloor();var e=m[b];e?w(e,d.className):(e=function(a,b){function c(a){a=a.toLowerCase();a=a.replace(/b/g,"-");a=a.replace(/f/g,"");return a=parseFloat(a)}function d(b){var c=a.indexOf(e+b),f=a.indexOf(e-b);return-1<c?c:-1<f?f:d(b+.5)}for(var e=c(b),f=0;f<a.length;f++)a[f]=c(a[f]);a.sort(function(a,b){return a-b});f=d(0);return a[f]},c.floor_result&&0<c.floor_result.length&&(c=e(c.floor_result,b),c=0<c?"f"+c:"b"+-c,n("changeToNearFloor",[c]),Rtmap.Scene.changeFloorTo(c,function(){E("category",d.className)}),D=null))}else I(c.poilist),M.showBackBtn();else l(),M.hideBackBtn()}))}function x(a,b){var c=b.attr("searchData");c?c=-1!=c.indexOf("_")?c.split("_"):[c]:console.log("no such data");f.Search.searchTwoClass(c,function(c,d){m=c;D=d.pagecount;if(d.poilist&&0<d.poilist.length)if("category"==a){var e=Rtmap.Scene.getNowFloor(),f=m[e];f?w(f):(f=function(a,b){function c(a){a=a.toLowerCase();a=a.replace(/b/g,"-");a=a.replace(/f/g,"");return a=parseFloat(a)}function d(b){var c=a.indexOf(e+b),f=a.indexOf(e-b);return-1<c?c:-1<f?f:d(b+.5)}for(var e=c(b),f=0;f<a.length;f++)a[f]=c(a[f]);a.sort(function(a,b){return a-b});f=d(0);return a[f]},d.floor_result&&0<d.floor_result.length&&(e=f(d.floor_result,e),e=0<e?"f"+e:"b"+-e,n("changeToNearFloor",[e]),Rtmap.Scene.changeFloorTo(e,null,function(){x("category",b)}),D=null))}else I(d.poilist),M.showBackBtn();else l(),M.hideBackBtn()})}var M=this,C=this.html;$(C).find(".searchBtn").click(function(a){a.stopPropagation();n("searchBtn",[a]);d=$(C).find(".searchInput").val().trim();D=null;b=!0;A=1;E()});$(C).find(".back").click(function(b){b.stopPropagation();a?a():""});Rtmap.Scene.on("mapDrag",function(){$(C).find(".searchInput").blur()});Rtmap.Scene.on("mapAction",function(){"follow"!=window.locationModel&&$(C).find(".category_box").slideUp()});Rtmap.Scene.on("poiClick",function(a,b){$(C).find(".searchInput").blur();$(C).find(".category_box").slideUp()});$(C).find(".searchInput").on("input",function(){event.stopPropagation();0<$(C).find(".searchInput").val().length?($(C).find(".clearInput").show(),$(C).find(".searchHistoryBox").hide()):($(C).find(".clearInput").hide(),0<e().length&&$(C).find(".searchHistoryBox").show());d=$(C).find(".searchInput").val().trim();D=null;b=!0;A=1;E()});$(C).find(".searchInput").click(function(a){a.stopPropagation()});$(C).find(".clearInput").click(function(a){a.stopPropagation();l()});$(C).find(".categoryBtn").click(function(a){a.stopPropagation();$(C).find(".searchInput").blur();$(C).find(".category_box").slideToggle();n("categoryBtn",[a])});$(C).find(".categoryList li").click(function(a){a.stopPropagation();d=$(this).attr("searchData");t();x("category",$(this));t();$(C).find(".category_box").slideUp()});$(C).find(".clearHistoryBtn").click(function(){g()});$(C).find(".clearHistoryBtn").bind("touchstart",function(){event.stopPropagation();g()});$(C).find(".searchInput").bind("touchstart",function(a){a.stopPropagation()});$(C).find(".searchInput").focus(function(a){$(this).val()||setTimeout(function(){c()},200);$(C).find(".category_box").slideUp();n("searchFocus",[a])});$(C).find(".slideupHistoryBtn").bind("touchstart",function(a){a.stopPropagation();a.preventDefault();$(C).find(".searchInput").blur()});$(C).find(".searchInput").blur(function(a){setTimeout(function(){$(C).find(".searchHistoryBox").hide()},200)});$(C).find(".searchBtn").bind("touchstart",function(a){a.stopPropagation();n("searchBtn",[a]);d=$(C).find(".searchInput").val().trim();E()});$(C).find(".resultListBox").bind("mousewheel",function(){event.stopPropagation()});$(C).find(".resultListBox").bind("touchstart",function(){event.stopPropagation()});$(C).find(".resultListBox").bind("touchmove",function(){event.stopPropagation()});$(C).find(".resultListBox").bind("touchend",function(){event.stopPropagation()});$(C).find(".resultListBox ul").scroll(function(a){event.stopPropagation();a=$(this).height();this.scrollHeight==a+this.scrollTop&&(this.bottomAlert||$(this).append(this.bottomAlert),A++,b=!1,A<=D&&E())})},showBackBtn:function(){$(this.html).find(".rtmap_search_box").addClass("result")},hideBackBtn:function(){$(this.html).find(".rtmap_search_box").removeClass("result")},getCategoryList:function(){var a=[];$(this.html).find(".categoryList li").each(function(){var b=$(this).attr("searchData");a.push(b)});return a},onAdd:function(){var a=L.DomUtil.create("div",""),b="\u536b\u751f\u95f4",c="\u51fa\u5165\u53e3",d="\u76f4\u68af",e="\u6276\u68af",f="\u95ee\u8baf",g="\u9910\u996e",h="\u5546\u4e1a",l="\u5145\u7535\u8bbe\u5907",k="\u6e05\u7a7a\u5386\u53f2";Rtmap.Locales?b=Rtmap.Locales.getFormatValue("toilet"):"";Rtmap.Locales?c=Rtmap.Locales.getFormatValue("doorway"):"";Rtmap.Locales?d=Rtmap.Locales.getFormatValue("elevator"):"";Rtmap.Locales?f=Rtmap.Locales.getFormatValue("information"):"";Rtmap.Locales?e=Rtmap.Locales.getFormatValue("escalator"):"";Rtmap.Locales?g=Rtmap.Locales.getFormatValue("restaurant"):"";Rtmap.Locales?h=Rtmap.Locales.getFormatValue("shopping"):"";Rtmap.Locales?l=Rtmap.Locales.getFormatValue("charger"):"";Rtmap.Locales?k=Rtmap.Locales.getFormatValue("clearHistory"):"";a.innerHTML='\x3cdiv class\x3d"rtmap_search_box"\x3e\x3cdiv class\x3d"back"\x3e\x3ci class\x3d"fa fa-chevron-left"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"input_box"\x3e\x3cinput type\x3d"text" class\x3d"rtmap_search_input searchInput"/\x3e\x3ci class\x3d"fa fa-close clear_input_btn clearInput"\x3e\x3c/i\x3e\x3cdiv class\x3d"search_history_box searchHistoryBox"\x3e\x3cdiv class\x3d"history_btn_bar"\x3e\x3cdiv class\x3d"slideup_history slideupHistoryBtn"\x3e\x3ci class\x3d"fa fa-angle-up"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"clear_history_btn clearHistoryBtn"\x3e'+k+'\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3ci class\x3d"fa fa-th-list search_category categoryBtn"\x3e\x3c/i\x3e\x3cdiv class\x3d"category_box" style\x3d"display: none;"\x3e\x3cul class\x3d"categoryList"\x3e\x3cli class\x3d"wc" searchData\x3d"1901%"\x3e'+b+'\x3c/li\x3e\x3cli class\x3d"doorway" searchData\x3d"190206"\x3e'+c+'\x3c/li\x3e\x3cli class\x3d"elevator" searchData\x3d"190201"\x3e'+d+'\x3c/li\x3e\x3cli class\x3d"ladder" searchData\x3d"190202"\x3e'+e+'\x3c/li\x3e\x3cli class\x3d"information_desk" searchData\x3d"190401_190402"\x3e'+f+'\x3c/li\x3e\x3cli class\x3d"restaurant" searchData\x3d"10%"\x3e'+g+'\x3c/li\x3e\x3cli class\x3d"business" searchData\x3d"11%_12%_13%_14%_15%_16%"\x3e'+h+'\x3c/li\x3e\x3cli class\x3d"power" searchData\x3d"190303"\x3e'+l+'\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"resultListBox"\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"yellow_notice"\x3e\x3c/div\x3e';this.html=a;this.bindEvent();return a}}),G={};return{render:function(){var a=Rtmap.Scene.getMap();E=new F;a.addControl(E)},on:function(a,b){G[a]||(G[a]=[]);G[a].push(b)},clearResultList:t,hideCategory:function(){$(E.html).find(".category_box").slideUp()},clearSearchResult:l,getCurrentSearchPoi:function(){return B}}}(),k=function(){var a=null;return{render:function(){a=L.Control.extend({openstatus:!1,_bindEvent:function(){function a(){var c=b.listScroll[0].scrollTop,d=b.listScroll[0].scrollHeight;offsetHeight=b.listScroll[0].offsetHeight;realyHeight=d-offsetHeight;c==realyHeight?($(".topAngle .fa").removeClass("disable"),$(".bottomAngle .fa").addClass("disable"),0==c&&0==realyHeight&&($(".topAngle .fa").addClass("disable"),$(".bottomAngle .fa").addClass("disable"))):(0==c?$(".topAngle .fa").addClass("disable"):$(".topAngle .fa").removeClass("disable"),$(".bottomAngle .fa").removeClass("disable"))}var b=this;this.listScroll.bind("mousewheel",function(){event.stopPropagation()});this.listScroll.scroll(function(){a()});this.listScroll.bind("touchstart",function(){event.stopPropagation()});this.listScroll.bind("touchmove",function(a){a.stopPropagation()});this.listScroll.bind("touchend",function(){event.stopPropagation()});this.floorBtn.click(function(c){c.stopPropagation();c.preventDefault();b.openstatus=!b.openstatus;b.changeList.slideToggle(300);if(b.openstatus){var d=function(){g+=f;b.listScroll[0].scrollTop=g;Math.abs(g-e)<=Math.abs(f)?(b.listScroll[0].scrollTop=e,a()):(a(),requestAnimationFrame(d))},e=b.listScroll.find("li.active")[0].offsetTop-80;c=b.listScroll[0].scrollTop;var f=(e-c)/30,g=c;d()}});Rtmap.Scene.on("changeFloor",function(a){var c=f.Config.getFloorAliasName(a),d=f.Config.getFloorSubject(a);0<c.indexOf(".")&&(c=c.replace("B",""),c=c.replace("F",""),c=Math.round(parseFloat(c)),c=a.substring(0,1)+(c.toString()+"M"));b.floorBtn.html(c.toUpperCase()+"\x3c/br\x3e\x3ci class\x3d'floor_subject_btn'\x3e"+d+"\x3c/i\x3e");b.listScroll.find("li.active").removeClass("active");b.listScroll.find("li."+c.toLowerCase()).addClass("active");b.changeList.slideUp();b.openstatus=!1});Rtmap.Scene.on("mapAction",function(){"follow"!=window.locationModel&&(b.changeList.slideUp(),b.openstatus=!1)})},setData:function(a){function b(a,c){a.click(function(a){window.locationModel="free";Rtmap.Control.disableLocal();a.stopPropagation();a=Rtmap.Scene.getNowFloor();c!=a&&Rtmap.Scene.changeFloorTo(c)})}var c=this.listScroll.find(".floor_list");c.html("");this.dataLength=a.length;for(var d=0;d<a.length;d++){var e=a[d].floor.toLocaleLowerCase(),g=a[d].floor_subject||"",h=f.Config.getFloorAliasName(e);if(0<h.indexOf("."))var h=h.replace("B",""),h=h.replace("F",""),l=Math.round(parseFloat(h)),h=e.substring(0,1)+(l.toString()+"M");l=$("\x3cli/\x3e",{"class":h.toLowerCase()});g||l.css({"line-height":"40px","font-size":"20px"});l.html(h.toUpperCase()+"\x3c/br\x3e\x3ci class\x3d'floor_subject'\x3e"+g+"\x3c/i\x3e");g=Rtmap.Scene.getNowFloor();e==g&&l.addClass("active");b(l,e);c.append(l)}},options:{},onAdd:function(){var a=L.DomUtil.create("div","");a.innerHTML='\x3cdiv class\x3d"floor_change_box"\x3e\x3cdiv class\x3d"rtmap_floor_change_list"\x3e\x3cdiv class\x3d"list_scroll"\x3e\x3cul class\x3d"floor_list"\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"rtmap_floor_btn"\x3e\x3ci class\x3d"fa fa-spinner fa-spin"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e';var b=$(a).find(".list_scroll");this.floorBtn=$(a).find(".rtmap_floor_btn");this.listScroll=b;this.changeList=$(a).find(".rtmap_floor_change_list");this._bindEvent();$(a).parent().addClass("flo");return a}});var b=new a({position:"bottomleft"});Rtmap.Scene.getMap().addControl(b);return b}}}();return{showScale:function(){if(e)return!0;var a=L.control.scale({position:"bottomleft",imperial:!1,className:"fa"});Rtmap.Scene.getMap().addControl(a);var b=a.getContainer(),b=$(b);b.addClass("rtmap_scale");b.parent().addClass("rtmap_scale_box");return e=a},showZoom:function(){var a=L.control.zoom({position:"bottomright",zoomInText:"+",zoomOutText:"-"});Rtmap.Scene.getMap().addControl(a);var b=a.getContainer(),b=$(b);b.addClass("rtmap_zoom");b.parent().addClass("rtmap_zoom_box");var b=$(".leaflet-control-zoom-out"),c=$(".leaflet-control-zoom-in");b.bind("touchstart",function(a){-1<$(this).attr("class").indexOf("leaflet-disabled")&&(a.preventDefault(),a.stopPropagation())});c.bind("touchstart",function(a){-1<$(this).attr("class").indexOf("leaflet-disabled")&&(a.preventDefault(),a.stopPropagation())});return a},showLocal:function(a){var b=new (L.Control.extend({_enable:!0,setEnable:function(a){this._enable!=a&&(this._enable=a,a=$(this._container),this._enable?a.css({background:"rgba(255,255,255,0) url(public/img/control.png) center center no-repeat","background-size":"cover"}):a.css({background:"rgba(255,255,255,0) url(public/img/control_disable.png) center center no-repeat","background-size":"cover"}))},options:{},onAdd:function(){var b=L.DomUtil.create("i","fa fa-crosshairs");$(b).click(function(){a();var b=$(this);b.css({"pointer-events":"none"});setTimeout(function(){b.css({"pointer-events":"auto"})},2E3)});$(b).dblclick(function(){return!1});$(b).addClass("rtmap_local");return this.html=b}}))({position:"bottomright"});Rtmap.Scene.getMap().addControl(b);g=b},disableLocal:function(){g?g.setEnable(!1):""},enableLocal:function(){g?g.setEnable(!0):""},showSearch:function(){n.render();return n},showFloorChange:function(){l||(l=k.render());return l},getFloorChangeControl:function(){return l}}}();f.PoiLabelFactory=function(){function m(){q=f.Scene.getMap();var a=q.options.maxZoom-q.options.minZoom,b=Math.round(q._zoom)-q.options.minZoom;r=Math.pow(2,b);0>b&&(r=2);p=.2>=b/a?1.6:.4>=b/a?1.5:.6>=b/a?1.4:.8>=b/a?1.3:1.2}function c(a,b){b||(b=1);var c=a.getCenterPoint()||{},d=a.getSize()||{};return{x:c.x,y:c.y,height:d.height*b,width:d.width*b}}function h(a,b){return Math.abs(b.x-a.x)<a.width/2+b.width/2&&Math.abs(b.y-a.y)<a.height/2+b.height/2?!0:!1}function a(a,b){if(g&&g[a])for(var c=0;c<g[a].length;c++)if(g[a][c]==d[i]){g[a].splice(c,1);break}}function b(a,b,c){if(b=E[b][c])for(c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}var d=[],e=null,g={},l=!1,E={},k=null,p,r,q;return{getLabelLayers:function(){return d},getLabelByPoiNum:function(a){for(var b=d.length;b--;)if(d[b].poiNum==a)return d[b]},getLabelGroupLayer:function(){return e},getLabelCache:function(){return g},setLableEnvirement:function(a,b,c){g=a;d=b;e=c},setNonePartialRefresh:function(a){l=a},setPrettyShowCallback:function(a){k=a},eachLabel:function(a){for(var b=0;b<d.length;b++)a(d[b])},removeLabelCache:function(a,b){var c=g[b];if(c)for(var d=0;d<c.length;d++)a==c[d]&&c.splice(d,1)},clearAll:function(){f.Scene.removeLayers(d);d=[];g={};e=null},allLabelsHidden:!1,hideLabel:function(a){for(var b=0;b<d.length;b++)if(d[b].poiNum==a){d[b].iconLabelHide();d[b].show=!1;$(d[b]._container).addClass("hide");break}},showLabel:function(a){for(var b=0;b<d.length;b++)if(d[b].poiNum==a){d[b].iconLabelShow();d[b].show=!0;$(d[b]._container).removeClass("hide");break}},hideAllLabels:function(){f.Scene.hideLayers(d);allLabelsHidden=!0},prettyShow:function(){var a=f.Scene.getMap();if(f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&(f.Scene.filterLayersByZoom(),0==d.length||parseInt(f.Scene.getMap()._zoom)<=a.options.minZoom))return;var e;l?e=!1:(q=f.Scene.getMap(),e=q._zoom>q.options.minZoom+2?!0:!1);m();var a=a.getBounds().pad(.1),r=Math.round(f.Scene.getMap()._zoom),n;Rtmap.Scene.getMap();n=Rtmap.Scene.getNowZoomLevel();var u=Rtmap.Scene.getNowFloor();if(E&&E[u]&&E[u][n]){for(var x=0;x<d.length;x++){var A=d[x].getZoomVisble(n);null==A&&(A=b(d[x].poiNum,u,n));d[x].setZoomVisble(n,A);d[x].getZoomVisble(n)?(d[x].iconLabelShow(),d[x].show=!0,$(d[x]._container).removeClass("hide")):(d[x].iconLabelHide(),d[x].show=!1,$(d[x]._container).addClass("hide"))}n=!0}else n=!1;console.log(n);if(!n)if(g[r])for(x=g[r],n=0;n<x.length;n++)u=x[n],f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&u.filterByZoom(r),u.show=!0,u._labelHideStatus?($(u._container).addClass("hide"),u.show=!1):e&&!a.contains(u._latlng)?($(u._container).addClass("hide"),u.show=!1):$(u._container).removeClass("hide");else{g[r]=[];for(n=0;n<d.length;n++)if(u=d[n],f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&u.filterByZoom(r),x=u.OL_Array){for(var A=!1,D=0;D<x.length;D++){var B=x[D];if(B!=u&&h(c(u,p),c(B,p))&&B.show){if(u.haveIcon&&!B.haveIcon||u.getZoomVisble(r-1))$(B._container).addClass("hide"),B.show=!1,this.removeLabelCache(B,r);if(!u.haveIcon&&B.haveIcon||!u.getZoomVisble(r-1)){A=!0;break}}}A?($(u._container).addClass("hide"),u.show=!1):(g[r].push(u),$(u._container).removeClass("hide"),u.show=!0)}else g[r].push(u),$(u._container).removeClass("hide"),u.show=!0;if(e)for(e=0;e<g[r].length;e++)n=g[r][e],a.contains(n._latlng)||($(n._container).addClass("hide"),n.show=!1);delete g[r]}allLabelsHidden=!1;k?k():""},addLabel:function(g,l){var k=new n(g.latlng,g.name,{},g.type);k.poiNum=g.poiNum;k.two_class=g.two_class;k.class_extension=g.class_extension;k.layer=g.layer;d.push(k);null==e&&(e=L.layerGroup(),f.Scene.addLayer(e));e.addLayer(k);k._nowLayer=l;k.setDisplayStyle();k.show=!0;var y=Rtmap.Scene.getNowZoomLevel(),u=Rtmap.Scene.getNowFloor();if(E&&E[y]){var x=k.getZoomVisble(y);null==x&&(x=b(k.poiNum,u,y));k.setZoomVisble(y,x);k.getZoomVisble(y)?(k.iconLabelShow(),k.show=!0,$(k._container).removeClass("hide")):(k.iconLabelHide(),k.show=!1,$(k._container).addClass("hide"))}else{m();for(y=0;y<d.length;y++)k!=d[y]&&h(c(d[y],r),c(k,r))&&(k.OL_Array?"":k.OL_Array=[],k.OL_Array.push(d[y]),d[y].minZoomVisble&&k.haveIcon&&!d[y].haveIcon&&!k._labelHideStatus&&a(q.options.minZoom,d[y]),h(c(d[y],p),c(k,p))&&d[y].show&&(!k.haveIcon||d[y].haveIcon||k._labelHideStatus?($(k._container).addClass("hide"),k.show=!1):(a(q.options.minZoom,d[y]),$(d[y]._container).addClass("hide"),d[y].show=!1)));f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&(k._labelHideStatus||Math.round(q._zoom)==q.options.minZoom)&&($(k._container).addClass("hide"),k.show=!1)}return k},addExistLabel:function(a){d.push(a)},resetIconStatus:function(){for(var a=0;a<d.length;a++)d[a].iconLabelShow()},setShowCacheLabel:function(a){E=a},getShowCacheLabel:function(){return E},clearShowCacheLable:function(){E={}}}}();f.Scene=function(){function m(){if(!l)throw Error("you need create Map first!");}function c(a){a=a.features;for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];if("MultiPolygon"==e.geometry.type)for(var f=e.geometry.coordinates[0][0],g=0;g<f.length;g++)b.push(f[g][0]),c.push(f[g][1]);else for(var h=0;h<e.geometry.coordinates[0].length;h++)for(f=e.geometry.coordinates[0][h],g=0;g<f.length;g++)b.push(f[0]),c.push(f[1])}b.sort(function(a,b){return parseFloat(a)-parseFloat(b)});c.sort(function(a,b){return parseFloat(a)-parseFloat(b)});return{left:b[0],right:b[b.length-1],bottom:c[0],top:c[c.length-1],centerX:(b[0]+b[b.length-1])/2,centerY:(c[0]+c[c.length-1])/2}}function h(b,d,e){H=f.Config.getOption().loadModel;v=b;if(x[b]){k=x[b].poi_layer;p=x[b].poi_layer_childs;q=x[b].bk_layer;t=x[b].fn_layer;r=x[b].typedata_layers;q?Rtmap.Scene.addLayer(q):"";q?q.hide=!1:"";t?Rtmap.Scene.addLayer(t):"";t?t.hide=!1:"";for(var h in r)r[h].addToMap&&(Rtmap.Scene.addLayer(r[h]),r[h].hide=!1);k?Rtmap.Scene.addLayer(k):"";k?k.hide=!1:"";f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&f.Scene.filterLayersByZoom();Rtmap.PoiLabelFactory.setLableEnvirement(x[b].labelCache,x[b].labelLayers,x[b].labelGrouplayer);for(h=0;h<x[b].labelLayers.length;h++)x[b].labelLayers[h]&&(Rtmap.Scene.addLayer(x[b].labelLayers[h]),x[b].labelLayers[h].setDisplayStyle());Rtmap.PoiLabelFactory.hideAllLabels();Rtmap.PoiLabelFactory.prettyShow();d?d():"";setTimeout(function(){u._call("drawedMap",[b,e])},100)}else if("cdn"==H){var l,m,n,E,z;"airport"==Rtmap.Config.getBuildingType()?Rtmap.DataProvider.getBKCDN({floor:b},function(a){l=a;w=c(a);G?g(null,!1)&&(G=!1):g(null,!0);Rtmap.Scene.createBK(l);Rtmap.DataProvider.getBasicCDN({floor:b},function(a){m=a;Rtmap.Scene.createFN(m);Rtmap.DataProvider.getShoppingCDN({floor:b},function(a){n=a;Rtmap.Scene.createPoi(n,!0);Rtmap.DataProvider.getTypeDataCDN({floor:b},"infrastructure",function(a){E=a;Rtmap.Scene.createTypeData(E,"infrastructure");Rtmap.DataProvider.getTypeDataCDN({floor:b},"traffic",function(a){z=a;Rtmap.Scene.createTypeData(z,"traffic",!0);d?d():"";x[b]={layers:r,bk_layer:q,fn_layer:t,poi_layer:k,poi_layer_childs:p,typedata_layers:r,labelCache:f.PoiLabelFactory.getLabelCache(),labelLayers:f.PoiLabelFactory.getLabelLayers(),labelGrouplayer:f.PoiLabelFactory.getLabelGroupLayer()};u._call("drawedMap",[b,e])})})})})},function(){H="server";a(b,d);f.Config.setup({loadModel:H})}):Rtmap.DataProvider.getBKCDN({floor:b},function(a){l=a;w=c(a);G?g(null,!1)&&(G=!1):g(null,!0);Rtmap.Scene.createBK(l);Rtmap.DataProvider.getFNCDN({floor:b},function(a){m=a;Rtmap.Scene.createFN(m);Rtmap.DataProvider.getPoiCDN({floor:b},function(a){n=a;Rtmap.Scene.createPoi(n,!0);x[b]={layers:r,bk_layer:q,fn_layer:t,poi_layer:k,poi_layer_childs:p,typedata_layers:r,labelCache:f.PoiLabelFactory.getLabelCache(),labelLayers:f.PoiLabelFactory.getLabelLayers(),labelGrouplayer:f.PoiLabelFactory.getLabelGroupLayer()};setTimeout(function(){u._call("drawedMap",[b,e])},100)})})},function(){H="server";a(b,d);f.Config.setup({loadModel:H})})}else a(b,d);f.Config.setup({loadModel:H})}function a(a,b){var d,e,f;Rtmap.DataProvider.getBK({floor:a},function(h){d=h;w=c(h);G?g(null,!1)&&(G=!1):g(null,!0);Rtmap.DataProvider.getFN({floor:a},function(c){e=c;Rtmap.DataProvider.getPoi({floor:a},function(c){f=c;Rtmap.Scene.createBK(d);Rtmap.Scene.createFN(e);Rtmap.Scene.createPoi(f,!0);u._call("drawedMap",[a]);b?b():""})})})}function b(){l.on("move",function(a,b,c){u._call("mapAction")});l.on("click",function(a){u._call("mapAction");u._call("mapClick");if(A){var b=e(a.latlng);u._call("poiClick",[a,b])}});l.on("drag",function(a,b,c){u._call("mapAction");u._call("mapDrag");return!1});l.on("dragend",function(a,b){var c=l.getCenter(),d=f.Scene.getBuildBounds(),c=L.CRS.EPSG3395.projection.project(c),e=c.x,g=c.y,h=!1;c.x<d.left?(e=d.left,h=!0):c.x>d.right&&(e=d.right,h=!0);c.y>d.top?(g=d.top,h=!0):c.y<d.bottom&&(g=d.bottom,h=!0);h&&f.Scene.moveTo({x:e,y:g})});l.on("zoomstart",function(){f.PoiLabelFactory.hideAllLabels()});l.on("zoomend",function(){});l.on("dragstart",function(){});l.on("dragend",function(){f.PoiLabelFactory.prettyShow()});l.on("moveend",function(){f.PoiLabelFactory.prettyShow()});debugTools&&$("#show").show()}function d(a,b){u[a]||(u[a]=[]);u[a].push(b)}function e(a){for(var b=Rtmap.PoiLabelFactory.getLabelLayers(),c=0;c<b.length;c++){var d=b[c];if(d._nowLayer._latlng&&d.show&&d.getBounds().contains(a))return d._nowLayer}}function g(a,b){if(a)return l.fitBounds(a.getBounds().pad(.5)),!0;l.options.minZoom=17;var c=!1;if(w.left&&w.top){var d=new L.Point(w.left,w.top),e=new L.Point(w.right,w.bottom);if(500<Math.abs(w.right-w.left)||500<Math.abs(w.top-w.bottom))c=!0;d=L.CRS.EPSG3395.projection.unproject(d);e=L.CRS.EPSG3395.projection.unproject(e);e=L.polyline([d,e]);d=l.getBoundsZoom(e.getBounds(),!1);b||l.fitBounds(e.getBounds());l.options.minZoom=d-F;Rtmap.Scene.minZoom=d-F;f.Config.setup({largeScene:c});return!0}return!1}var l=null,n=null,k=null,p={},r={},q=null,t=null,v=null,w=null,y={},u={_call:function(a,b){var c=this[a];if(c)for(var d=0;d<c.length;d++)c[d].apply(this,b)},changeFloor:[],BKClick:[],poiClick:[]},x={},A=!0,D=!0,B=!0,F=1,G=!0,H="server";d("changeFloor",function(a){if(y[a])for(var b=0;b<y[a].length;b++)l.addLayer(y[a][b])});return{clearAll:function(){f.PoiLabelFactory.clearAll();k?l.removeLayer(k):"";q?l.removeLayer(q):"";t?l.removeLayer(t):"";for(var a in y)if(0<y[a].length)for(var b=0;b<y[a].length;b++)l.removeLayer(y[a][b]);for(var c in r)l.removeLayer(r[c]);r={};t=q=k=null},on:d,off:function(a,b){if(u[a])for(var c=0;c<u[a].length;c++)if(b==u[a][c]){u[a].splice(c,1);break}},getNowFloor:function(){return v},getPoiByNum:function(a,b){for(var c in r)for(var d=r[c].getLayers(),e=0;e<d.length;e++)if(d[e].poiNo==b)return d[e]},getPoiByName:function(a,b){for(var c in r)for(var d=r[c].getLayers(),e=0;e<d.length;e++)if(d[e].feature.properties.name_chinese==b||d[e].feature.properties.store_id==b)return d[e]},changeFloorTo:function(a,b,c){f.Scene.clearAll();a=a.toLowerCase();h(a,c,b);u._call("changeFloor",arguments)},initMapContext:function(a,c){G=!0;x=[];Rtmap.DataProvider.clearAllCache();Rtmap.PoiLabelFactory.clearAll();var d=a||{};d.crs=d.crs||L.CRS.EPSG3395;d.center=d.center||[-50,115];d.zoom=d.zoom||1;d.zoomControl=d.zoomControl||!1;f.Config.getOption().minZoomOffset?F=f.Config.getOption().minZoomOffset:"";var e=L.CRS.EPSG3395.projection.unproject(new L.Point(115,-35)),g=1,h=!1,k=!1;Rtmap.Scene.maxZoom=22;-1!=navigator.userAgent.indexOf("iPhone")?(k=!1,h=!0,g=1):(k=!0,h=!1,g=.2);var p=L.svg();p.options.padding=g;l=new L.Map(d.parentDOM,{crs:L.CRS.EPSG3395,center:e,zoom:16,minZoom:16,maxZoom:22,zoomControl:!1,attributionControl:!1,bounceAtZoomLimits:!1,doubleClickZoom:!1,inertia:h,noMoveStart:k,renderer:p,zoomDelta:.5,zoomSnap:0,zoomAnimation:f.Config.getOption().zoomAnimation});l._drawMoreRatio=g;b();n=$("#"+d.parentDOM);return this},panBy:function(a){l.panBy(a)},createMarker:function(a){var b;if(a.Lat&&a.Lng)b=new L.Point(a.Lat,a.Lng);else if(a.x&&a.y)b=L.CRS.EPSG3395.projection.unproject(new L.Point(a.x,a.y));else return!1;if("circle"==a.type)a.color=a.color||"#1e6ac0",a.fillColor=a.fillColor||"#1e6ac0",b=L.circleMarker(b,a).addTo(l);else{var c=f.Style.getGlobalConfig("normal_icon_url"),c=L.icon({iconUrl:c,iconRetinaUrl:c,iconSize:[30,30],iconAnchor:[15,30],shadowSize:[68,95],shadowAnchor:[22,94]});a.icon=a.icon||c;b=L.marker(b,a).addTo(l)}a.floor=a.floor||Rtmap.Scene.getNowFloor().toLowerCase();y[a.floor]||(y[a.floor]=[]);y[a.floor].push(b);return b},addExistMarker:function(a,b){y[b]||(y[b]=[]);y[b].push(a)},createLine:function(a,b){var c=[];if(a.PointA.Lat&&a.PointA.Lng){var d=new L.Point(a.pointA.Lat,a.pointA.Lng),e=new L.Point(a.pointB.Lat,a.pointB.Lng);c.push(d,e)}else if(a.PointA.x&&a.PointA.y)d=L.CRS.EPSG3395.projection.unproject(new L.Point(a.PointA.x,a.PointA.y)),e=L.CRS.EPSG3395.projection.unproject(new L.Point(a.PointB.x,a.PointB.y)),c.push(d,e);else return!1;c=L.polyline(c,{color:"red"}).addTo(l);y[a.floor]||(y[a.floor]=[]);y[a.floor].push(c);return c},eachPoiNameLayer:function(a){f.PoiLabelFactory.eachLabel(a)},getMap:function(){return l},setAllowPoiClick:function(a){A=a},setAllowPoiSelected:function(a){D=a},getAllowPoiSelected:function(a){return D},setLabelVisble:function(a){B=a},getIsShowLabel:function(){return B},getNowZoomLevel:function(){var a=Rtmap.Scene.getMap().getZoom(),b=.5*parseInt((a-parseInt(a))/.5);return parseInt(a)+b},fitBounds:g,getParentDOM:function(){return n},getBuildBounds:function(){return w},getCenter:function(){return{x:w.centerX,y:w.centerY}},moveToCenter:function(a){var b=this.getCenter(),b=L.CRS.EPSG3395.projection.unproject(new L.Point(b.x,b.y));l.setView(b,a)},moveTo:function(a,b){var c;if("undefined"!=typeof a.Lat&&"undefined"!=typeof a.Lng)c=new L.Point(a.Lat,a.Lng);else if("undefined"!=typeof a.x&&"undefined"!=typeof a.y)c=L.CRS.EPSG3395.projection.unproject(new L.Point(a.x,a.y));else return!1;l.setView(c,b)},setZoom:function(a){l.setZoom(a)},addLayer:function(a){l.addLayer(a)},getLayer:function(){return k},getFNLayer:function(){return t},getBKLayer:function(){return q},getTypeDataLayer:function(){return r},removeMarker:function(a){a.animate?a.animate.stop():"";a?l.removeLayer(a):""},removeLayer:function(a,b){if(b)for(var c in y)if(0<y[c].length)for(var d=0;d<y[c].length;d++)y[c][d]==a&&y[c].splice(d,1);a?l.removeLayer(a):""},removeLayers:function(a){for(var b=0;b<a.length;b++)a[b]?l.removeLayer(a[b]):""},hideLayers:function(a){for(var b=0;b<a.length;b++)a[b].show&&($(a[b]._container).addClass("hide"),a[b].show=!1)},showLayers:function(a){for(var b=a.length,c=0;c<b;c++)a[c].show||($(a[c]._container).removeClass("hide"),a[c].show=!0)},createFN:function(a){m();t=L.geoJson(a,{style:{},filter:function(a,b){return 20<a.properties.style?!1:!0},coordsToLatLng:function(a){a=L.point(a[0],a[1]);return L.CRS.EPSG3395.projection.unproject(a)},onEachFeature:function(a,b){b.setStyle(f.Style.getStyleByPoiType(a.properties.style));b.on("click",function(a){if(A){var b=e(a.latlng);u._call("poiClick",[a,b]);L.DomEvent.stopPropagation(a)}})}}).addTo(l)},createBK:function(a){m();q=L.geoJson(a,{style:{},coordsToLatLng:function(a){a=L.point(a[0],a[1]);return L.CRS.EPSG3395.projection.unproject(a)},onEachFeature:function(a,b){b.setStyle(f.Style.getStyleByPoiType(a.properties.style));b.on("click",function(a){if(A){u._call("BKClick",[a]);var b=e(a.latlng);u._call("poiClick",[a,b]);L.DomEvent.stopPropagation(a)}})}}).addTo(l)},createPoi:function(a,b){function c(a,b){b.on({click:function(a){A&&(u._call("poiClick",[a,b]),L.DomEvent.stopPropagation(a))}})}m();if(!a)throw Error("createPoi function need arguments!");for(var d=0,e=0;e<a.features.length;e++)a.features[e].geometry||d++;k=L.geoJson(a,{crs:L.CRS.EPSG3395,style:{},coordsToLatLng:function(a){a=L.point(a[0],a[1]);return L.CRS.EPSG3395.projection.unproject(a)},onEachFeature:function(a,b){var d="en"==Rtmap.Locales.getlanguage()?a.properties.name_english:a.properties.name_chinese,e=a.properties.style,g=a.properties.poi_no;if(d&&""!=d){var h=L.point(a.properties.x_coord,a.properties.y_coord),h=L.CRS.EPSG3395.projection.unproject(h);B&&f.PoiLabelFactory.addLabel({latlng:h,name:d,type:e,poiNum:g,two_class:a.properties.two_class,layer:b,class_extension:a.properties.class_extension},b)}b.setStyle(Rtmap.Classification.getLayerStyle(b));b.poiNo=g;c(a,b)}});r.POI=k;k.hide=!0;b&&(k.addTo(l),k.hide=!1);Page.capturemode&&Rtmap.FeatureSelect.initCenterPoint()},createTypeData:function(a,b,c){function d(a,b){b.on({click:function(a){A&&(u._call("poiClick",[a,b]),L.DomEvent.stopPropagation(a))}})}m();if(!a)throw Error("createTypeData function need arguments!");for(var e=0,g=0;g<a.features.length;g++)a.features[g].geometry||e++;a=L.geoJson(a,{crs:L.CRS.EPSG3395,style:{},coordsToLatLng:function(a){a=L.point(a[0],a[1]);return L.CRS.EPSG3395.projection.unproject(a)},onEachFeature:function(a,e){var g="en"==Rtmap.Locales.getlanguage()?a.properties.name_english:a.properties.name_chinese,h=a.properties.style,l=a.properties.poi_no;p[a.properties.floor]||(p[a.properties.floor]={});p[a.properties.floor][l]=e._leaflet_id;if(g&&""!=g){var k=L.point(a.properties.x_coord,a.properties.y_coord),k=L.CRS.EPSG3395.projection.unproject(k);B&&f.PoiLabelFactory.addLabel({latlng:k,name:g,type:h,poiNum:l,two_class:a.properties.two_class,layer:e,class_extension:a.properties.class_extension},e)}e.setStyle&&e.setStyle(Rtmap.Classification.getLayerStyle(e));c&&d(a,e);e.poiNo=l;e.dataType=b}});c&&(a.addTo(l),a.addToMap=!0);return r[b]=a},filterLayersByZoom:function(){map=f.Scene.getMap();var a=f.Scene.getFNLayer();16.2>map._zoom?a&&!a.hide&&(map.removeLayer(a),a.hide=!0):(a&&a.hide&&(map.addLayer(a),a.hide=!1),Rtmap.TrackFactory.resetTrackLine());17.2>=map._zoom?(a=f.Scene.getTypeDataLayer(),a.POI&&!a.POI.hide&&(map.removeLayer(a.POI),a.POI.hide=!0),a.traffic&&!a.traffic.hide&&(map.removeLayer(a.traffic),a.traffic.hide=!0),Rtmap.TrackFactory.resetTrackLine()):17.2<map._zoom&&(a=f.Scene.getTypeDataLayer(),a.POI&&a.POI.hide&&(map.addLayer(a.POI),a.POI.hide=!1),a.traffic&&a.traffic.hide&&(map.addLayer(a.traffic),a.traffic.hide=!1),Rtmap.TrackFactory.resetTrackLine())}}}();f.Style=function(){var f={canvas_color:"#fcffd5",focus_icon_url:"static/public/img/red.png",font_color:"#000000",normal_icon_url:"static/public/img/blue.png",start_icon_url:"static/public/img/start.png",end_icon_url:"static/public/img/end.png",wc_icon_url:"static/public/img/wc.png",atm_icon_url:"static/public/img/atm.png",cashier_desk_icon_url:"static/public/img/cashier_desk.png",information_desk_icon_url:"static/public/img/information_desk.png",elevator_icon_url:"static/public/img/elevator.png",ladder_icon_url:"static/public/img/escalator.png",stairway_icon_url:"static/public/img/stairway.png",doorway_icon_url:"static/public/img/doorway.png",restaurant_icon_url:"static/public/img/restaurant.png",business_icon_url:"static/public/img/supermarket.png",power_icon_url:"static/public/img/supermarket.png",wc_red_icon_url:"static/public/img/wc.png",atm_red_icon_url:"static/public/img/atm.png",cashier_desk_red_icon_url:"static/public/img/cashier_desk.png",information_desk_red_icon_url:"static/public/img/information_desk.png",elevator_red_icon_url:"static/public/img/elevator.png",ladder_red_icon_url:"static/public/img/escalator.png",stairway_red_icon_url:"static/public/img/stairway.png",doorway_red_icon_url:"static/public/img/doorway.png"},c={},h={color:"#844d8c",fillColor:"#c28dc4",weight:1,opacity:1,fillOpacity:1},a={3:{fillColor:"#efefef",color:"#333",weight:3,opacity:1,fillOpacity:1},4:{fillColor:"#d5ebab",color:"#9bceb2",weight:1,opacity:1,fillOpacity:1},5:{fillColor:"#fdc8c4",color:"#f4c3b4",weight:1,opacity:1,fillOpacity:1,hover:{fillColor:"#ffb1ac",color:"#f4c3b4",weight:1,opacity:1}},6:{fillColor:"#ffeda0",color:"#ffeda0",weight:1,opacity:1,fillOpacity:1},7:{fillColor:"#d5b9e9",color:"#678d88",weight:1,opacity:1,fillOpacity:1},8:{fillColor:"#ddd",color:"#999",weight:1,opacity:1,fillOpacity:1},12:{fillColor:"#ffeda0",color:"#ffeda0",weight:1,opacity:1,fillOpacity:1}},b={free:{type:20,fillColor:"#A9A9F0",color:"#6e6e6e",weight:.5,opacity:1,fillOpacity:1},busy:{type:20,fillColor:"#E97F7F",color:"#6e6e6e",weight:.5,opacity:1,fillOpacity:1},plan:{type:20,fillColor:"#5B65E8",color:"#6e6e6e",weight:.5,opacity:1,fillOpacity:1}};return{getStyleByPoiType:function(b){return a[b]},setPoiDefaultStyle:function(b,c){a[b]?"":a[b]={};for(var f in c)a[b][f]=c[f]},setGlobalConfig:function(a){for(var b in a)a[b]?f[b]=a[b]:""},getGlobalConfig:function(a){return f[a]},setImageConfig:function(a){for(var b in a)a[b]?c[b]=a[b]:""},getImageConfig:function(a){return c[a]},getParkingStatusStyle:function(){return b},getOverStyle:function(){return h},setOverStyle:function(a){h=a}}}();f.DataProvider=function(){function m(a,c){if(b[a])for(var f=0;f<b[a].length;f++)b[a][f].apply(this,c)}function c(b,c){var g={},h=f.Config.getOption();g.key=h.Key;var n=f.Config.getOption().Token;n?g.access_token=n:"";g.buildid=h.buildId;g.floor=b.floor||h.defaultFloor;g.maptype=b.type;g.codeType=2;var k=(new Date).getTime();a[b.type]&&a[b.type][b.floor]?c(a[b.type][b.floor]):(m("beforeGetPoi",[k]),$.ajax({timeout:6E4,type:"POST",url:"http://lbsapi.rtmap.com/rtmap_lbs_api/v1/rtmap/floor_geojson",data:JSON.stringify(g),dataType:"text"}).done(function(f){if(g.floor==Rtmap.Scene.getNowFloor()){a:{var h=f.length,l=f[0].charCodeAt(0),h=(h-24)%l;0==h?h+=1:"";var l=f.substr(h+1,24),k;try{k=atob(l)}catch(m){f={type:"FeatureCollection",features:[],totalFeatures:0};break a}Rtmap.Config.setup({buildId:k});h=Rtmap.Config.getOption().buildId;f=f.replace(new RegExp(l),"");for(k=l=0;k<h.length;k++)l+=parseInt(h[k]);h=l%10+10;l="";for(k=0;k<f.length;k++)var n=k%h^f[k].charCodeAt(0),l=l+String.fromCharCode(n);try{var E=JSON.parse(l)}catch(u){console.error("")}f=E}f.result&&"0"!=f.result.error_code?alert(f.result.error_msg):(a[b.type]||(a[b.type]={}),a[b.type][b.floor]=f,c(f))}}).error(function(){var a=(new Date).getTime();m("afterGetPoi",[k,a])}).complete(function(a){a=(new Date).getTime();m("afterGetPoi",[k,a])}))}function h(b,c,g){var h,n=f.Config.getOption(),k=n.dataPath;k||(k="data");f.Config.getOption().Token||"";h=b.floor||n.defaultFloor;var p=(new Date).getTime();a[b.type]&&a[b.type][b.floor]?c(a[b.type][b.floor]):(m("beforeGetPoi",[p]),$.ajax({timeout:6E4,type:"GET",url:k+"/"+n.buildId+"_"+b.floor+"_"+b.type+".json",dataType:"json"}).done(function(f){h==Rtmap.Scene.getNowFloor()&&(f.result&&"0"!=f.result.error_code?alert(f.result.error_msg):(a[b.type]||(a[b.type]={}),a[b.type][b.floor]=f,c(f)))}).error(function(){var a=(new Date).getTime();m("afterGetPoi",[p,a]);g?g():""}).complete(function(a){a=(new Date).getTime();m("afterGetPoi",[p,a])}))}var a={},b={};return{getBuildInfo:function(a,b){var c=f.Config.getFloorData();if(c&&1<c.length)"",setTimeout(function(){b?b({name_chn:f.Config.getOption().buildName,floorinfo:c}):""},100);else{var h={};h.key=a.key||f.Config.getOption().Key;var n=f.Config.getOption().Token;n?h.access_token=n:"";h.buildid=a.buildId||f.Config.getOption().buildId;h.map_version=$("#map_version").attr("value");var k=(new Date).getTime();m("beforGetBuildInfo",[k]);$.ajax({type:"POST",url:"http://lbsapi.rtmap.com/rtmap_lbs_api/v1/rtmap/build_detail",data:JSON.stringify(h),dataType:"json"}).done(function(a){"0"==a.result.error_code?(f.Config.setup({vendorDetailUrl:a.build_detail.url}),f.Config.setup({poiDetialType:a.build_detail.type}),"",b?b(a.build_detail):""):(alert(a.result.error_msg),b?b("get Data error"):"")}).complete(function(){m("afterGetBuildInfo",[k])})}},on:function(a,c){b[a]||(b[a]=[]);b[a].push(c)},getTypeData:function(a,b,c){h({type:b,floor:a.floor},function(a){c(a)})},getPoi:function(a,b){c({type:"poi",floor:a.floor},function(a){0!=a.features.length&&b(a)})},getFN:function(a,b){c({type:"fn",floor:a.floor},b)},getBK:function(a,b){c({type:"bk",floor:a.floor},b)},getBKCDN:function(a,b,c){h({type:"bk",floor:a.floor},b,c)},getFNCDN:function(a,b){h({type:"fn",floor:a.floor},b)},getBasicCDN:function(a,b){h({type:"basic",floor:a.floor},b)},getPoiCDN:function(a,b){h({type:"poi",floor:a.floor},function(a){b(a)})},getShoppingCDN:function(a,b){h({type:"shopping",floor:a.floor},function(a){b(a)})},getTypeDataCDN:function(a,b,c){h({type:b,floor:a.floor},function(a){c(a)})},jsonpGetLabelCache:function(a,b){var c=f.Config.getOption(),h=c.dataPath;h||(h="data");$.ajax({timeout:6E4,type:"GET",url:"labelcache_"+c.buildId+".json",dataType:"json"}).done(function(b){a(b)}).error(function(){b?b():""}).complete(function(a){})},clearCache:function(b,c){a[b]&&a[b][c]&&(a[b][c]={})},clearAllCache:function(){a={}}}}();f.TrackFactory=function(){function m(a){var b=f.Style.getGlobalConfig("start_icon_url"),c=f.Style.getGlobalConfig("start_icon_url");a&&"car"==a&&(c=b="static/public/img/car.png");a=L.icon({iconUrl:b,iconRetinaUrl:c,iconSize:[40,40],iconAnchor:[20,40],shadowSize:[68,95],shadowAnchor:[22,94]});b=new L.Point(q.x_coord,q.y_coord);b=L.CRS.EPSG3395.projection.unproject(b);q.Marker?f.Scene.removeLayer(q.Marker):"";q.Marker=L.marker(b,{icon:a});q.floor==f.Scene.getNowFloor()&&f.Scene.addLayer(q.Marker)}function c(a,b){var c=f.Style.getGlobalConfig("end_icon_url"),d=f.Style.getGlobalConfig("end_icon_url");b&&"car"==b&&(d=c="static/public/img/car.png");c=L.icon({iconUrl:c,iconRetinaUrl:d,iconSize:[40,40],iconAnchor:[20,40],shadowSize:[0,0],shadowAnchor:[22,94]});d=new L.Point(t.x_coord,t.y_coord);d=L.CRS.EPSG3395.projection.unproject(d);t.Marker?f.Scene.removeLayer(t.Marker):"";t.Marker=L.marker(d,{icon:c});t.floor==f.Scene.getNowFloor()&&(f.Scene.addLayer(t.Marker),t.Marker.update());Page.wechat&&(Page.wechat.clearLocationTargetLine?Page.wechat.clearLocationTargetLine():"")}function h(a,b){if(w[a])for(var c=0;c<w[a].length;c++)w[a][c].apply(this,b)}function a(a){function c(){var a={};a.key=f.Config.getOption().Key;var b=f.Config.getOption().Token;b?a.access_token=b:"";var b=q.x_coord,d=q.y_coord,e=t.x_coord,g=t.y_coord;a.buildid=f.Config.getOption().buildId;a.pointlist=[{floor:q.floor,x:b,y:-d},{floor:t.floor,x:e,y:-g}];v?a.route_pointlist=v:"";return JSON.stringify(a)}if(q.Poi&&t.Poi&&q.Poi!=t.Poi){var d=c();h("beforeRequest");g();$.ajax({timeout:6E3,type:"POST",url:"http://lbsapi.rtmap.com/rtmap_lbs_api/v2/rtmap/navigation",data:d}).done(function(c){if("0"==c.result.error_code){var d=c.pointlist;y=c.pointlist;for(var e=d.length;e--;){var g=d[e];g.x_indoor=parseInt(g.x)/1E3;g.y_indoor=parseInt(g.y)/1E3}for(var e={},l=g=null,k=null,m=0;m<d.length;m++){var p=d[m],r=new L.Point(p.x_indoor,-p.y_indoor),v=L.CRS.EPSG3395.projection.unproject(r);p.floor.toLowerCase()!=g&&(l&&(l.next_floor=p.floor.toLowerCase(),l.endPOI={name:k,poiInfo:p,lastPoiInfo:d[m-1]}),g=p.floor.toLowerCase(),e[g]?(e[g].extend_points=[],r=g+"-1",e[g].extendRoute=r,e[r]={to_floor:null,endPOI:null,points:[]},e[r].floor=g,e[r].extend_points=e[g].points,l?e[r].prev_floor=l.floor:"",l=e[r],e[e[r].prev_floor].next_floor=r):(e[g]={to_floor:null,endPOI:null,points:[]},e[g].floor=g,l?e[g].prev_floor=l.floor:"",l=e[g]));k=p.poi_name;0==m&&(r=new L.Point(q.x_coord,q.y_coord),p=L.CRS.EPSG3395.projection.unproject(r),p.rt_attr=0,e[g].points.push(p));e[g].extend_points?(e[g].extend_points.push(v),r=e[g].extendRoute,e[r].points.push(v)):e[g].points.push(v);m==d.length-1&&(r=new L.Point(t.x_coord,t.y_coord),v=L.CRS.EPSG3395.projection.unproject(r),v.rt_attr=1,e[g].points.push(v))}(u=e)?h("successTrack",[u,c.distance]):"";window.Page.loading?window.Page.loading.show():"";q.floor!=f.Scene.getNowFloor()?f.Scene.changeFloorTo(q.floor):b();F&&F.hasfit&&n()}N=c;a?a(c):""}).error(function(b){a?a(b):""}).complete(function(){h("afterRequest")})}else K&&(g(),K=!1)}function b(a){var b=f.Scene.getNowFloor();if(u[b]){var c=u[b].points;A?f.Scene.removeLayer(A):"";x?f.Scene.removeLayer(x):"";D?f.Scene.removeLayer(D):"";B?f.Scene.removeLayer(B):"";B=null;"";G?f.Scene.removeLayer(G):"";H?f.Scene.removeLayer(H):"";I?f.Scene.removeLayer(I):"";J?f.Scene.removeLayer(J):"";if(0==c[0].rt_attr){var d=c[0],e=c[1];x=L.polyline([d,e],{color:"#1b1b60",dashArray:[5,5],weight:6,opacity:.8,className:"wha",renderer:L.svg()});f.Scene.addLayer(x);c=c.concat();c.splice(0,1)}1==c[c.length-1].rt_attr&&(d=c[c.length-2],e=c[c.length-1],u[b].extend_points&&(e=u[b].extend_points,d=e[e.length-2],e=e[e.length-1]),D=L.polyline([d,e],{color:"#1b1b60",dashArray:[5,5],weight:6,opacity:.8,className:"wha",renderer:L.svg()}),f.Scene.addLayer(D),c=c.concat(),c.splice(c.length-1,1));A=L.polyline(c,{color:"#1b1b60",weight:6,opacity:.8,className:"wha",renderer:L.svg()});A.setText("\uff1e",{repeat:!0,offset:3,attributes:{"letter-spacing":"20px",fill:"white","font-weight":"normal","font-size":"7"}});f.Scene.addLayer(A);u[b].extend_points&&(a?"":a=b+"-1",e=u[b].extend_points,B=L.polyline(e,{color:"#1b1b60",weight:6,opacity:.8,className:"wha",renderer:L.svg()}),B.setText("\uff1e",{repeat:!0,offset:3,attributes:{"letter-spacing":"20px",fill:"white","font-weight":"normal","font-size":"7"}}),f.Scene.addLayer(B),d=p(),d=k(d),J=L.marker(B.getLatLngs()[0],{icon:d}),f.Scene.addLayer(J),e=d=null,(c=u[a].endPOI)?(c.poiInfo?d=p(c.poiInfo):d=p(),e=k(d),I=L.marker(B.getLatLngs()[B.getLatLngs().length-1],{icon:e}),f.Scene.addLayer(I),c=r(c.poiInfo.desc),I.bindPopup(c,{autoPan:!1}).openPopup()):(d=p(),e=k(d),I=L.marker(B.getLatLngs()[B.getLatLngs().length-1],{icon:e}),f.Scene.addLayer(I)));A&&A._map&&((c=u[b].endPOI)&&c.poiInfo&&(d=p(c.poiInfo),d=k(d),e=new L.Point(c.lastPoiInfo.x_indoor,-c.lastPoiInfo.y_indoor),L.CRS.EPSG3395.projection.unproject(e),G=L.marker(A.getLatLngs()[A.getLatLngs().length-1],{icon:d}),f.Scene.addLayer(G),c=r(c.poiInfo.desc),G.bindPopup(c,{autoPan:!1}).openPopup()),t.floor.toUpperCase()!=q.floor.toUpperCase()&&Rtmap.Scene.getNowFloor().toUpperCase()!=q.floor.toUpperCase()&&(d=p(),d=k(d),H=L.marker(A.getLatLngs()[0],{icon:d}),f.Scene.addLayer(H)));K=!0;!a&&u[b].extend_points?h("drawPath",[u,A]):a&&0<a.indexOf("-")&&B?h("drawPath",[u,B]):h("drawPath",[u,A])}else h("drawPath")}function d(){q.Marker?f.Scene.removeLayer(q.Marker):"";for(var a in q)q[a]=null}function e(){t.Marker?f.Scene.removeLayer(t.Marker):"";for(var a in t)t[a]=null}function g(){A?f.Scene.removeLayer(A):"";x?f.Scene.removeLayer(x):"";D?f.Scene.removeLayer(D):"";B?f.Scene.removeLayer(B):"";v=null;G?f.Scene.removeLayer(G):"";H?f.Scene.removeLayer(H):"";I?f.Scene.removeLayer(I):"";J?f.Scene.removeLayer(J):""}function l(a,b,c){n();for(var d,e,g=0;g<y.length;g++)y[g].floor==a.floor&&y[g].x==a.x&&y[g].y==a.y&&(d=g),y[g].floor==b.floor&&y[g].x==b.x&&y[g].y==b.y&&(e=g);a=[];for(g=d;g<=e;g++)b=new L.Point(y[g].x_indoor,-y[g].y_indoor),b=L.CRS.EPSG3395.projection.unproject(b),a.push(b);F=L.polyline(a,{color:"#E80A0A",weight:6,opacity:.7,className:"wha",renderer:L.svg()});0==d&&1==e&&(F.willNoFit=!0);f.Scene.getNowFloor().toUpperCase()==c.toUpperCase()&&window.setTimeout(function(){F&&(F.willNoFit||f.Scene.getMap().setView(F.getBounds().getCenter()),f.Scene.addLayer(F),F.hasfit=!0,F.floor=c);window.Page.loading?window.Page.loading.hide():""},700)}function n(){F&&F._map&&f.Scene.removeLayer(F)}function k(a){return L.icon({iconUrl:a,iconRetinaUrl:a,iconSize:[30,30],iconAnchor:[15,15]})}function p(a){if(a){var b="up";a.desc&&(0<a.desc.indexOf("\u4e0a\u884c")&&(b="up"),0<a.desc.indexOf("\u4e0b\u884c")&&(b="down"));if(-1<a.poi_name.indexOf("\u7535\u68af"))return"static/public/img/elevator_"+b+".png";if(-1<a.poi_name.indexOf("\u6276\u68af"))return"static/public/img/escalator_"+b+".png";if(-1<a.poi_name.indexOf("\u697c\u68af"))return"static/public/img/stair_"+b+".png"}return"static/public/img/elevator.png"}function r(a){for(var b=f.Config.getFloorData(),c=0;c<b.length;c++)b[c].floor_alias&&(a=a.replace(b[c].floor,b[c].floor_alias));return a}var q={Poi:null,Marker:null,floor:null,x_coord:null,y_coord:null},t={Poi:null,Marker:null,floor:null},v=null,w={},y=null,u={},x=null,A=null,D=null,B=null,F=null,G=null,H=null,I=null,J=null,K=!1,N=null;f.Scene.on("drawedMap",function(a,c){q.Marker?f.Scene.removeLayer(q.Marker):"";t.Marker?f.Scene.removeLayer(t.Marker):"";A?f.Scene.removeLayer(A):"";x?f.Scene.removeLayer(x):"";D?f.Scene.removeLayer(D):"";B?f.Scene.removeLayer(B):"";G?f.Scene.removeLayer(G):"";H?f.Scene.removeLayer(H):"";u[a]?b(c):"";f.Config.getOption().largeScene&&"cdn"==f.Config.getOption().loadModel&&"airport"==f.Config.getBuildingType()&&f.Scene.filterLayersByZoom();q.Marker&&a==q.floor&&f.Scene.addLayer(q.Marker);t.Marker&&a==t.floor&&f.Scene.addLayer(t.Marker);F&&F.hasfit&&(F.floor.toUpperCase()==a.toUpperCase()?f.Scene.addLayer(F):n())});return{on:function(a,b){w[a]||(w[a]=[]);w[a].push(b)},getStartPoi:function(){return q},getEndPoi:function(){return t},setStartPoi:function(a,b){if(!a&&Rtmap.Search.FocusResult)q.floor=Rtmap.Search.FocusResult.floor.toLowerCase(),q.x_coord=Rtmap.Search.FocusResult.x,q.y_coord=Rtmap.Search.FocusResult.y,q.Poi=Rtmap.Search.FocusResult;else{var c=a.feature?a.feature.properties:"";q.Poi=a;c?(q.floor=Rtmap.Scene.getNowFloor().toLowerCase(),q.x_coord=c.x_coord,q.y_coord=c.y_coord):(q.floor=a.floor.toLowerCase(),q.x_coord=a.x,q.y_coord=a.y)}(c=Rtmap.Scene.SelectMarker)?Rtmap.Scene.removeLayer(c,!0):"";Rtmap.Scene.SelectMarker=null;m(b);q.Poi==t.Poi&&e()},setStartPoiXY:function(a,b,c,d){q.floor=a.toLowerCase();q.x_coord=b;q.y_coord=c;q.Poi={};q.Poi.floor=a.toLowerCase();q.Poi.x=b;q.Poi.y=c;m()},clearStartPoi:d,clearEndPoi:e,getTrackStatus:function(){return K},setRoutePoints:function(a){v=a},setEndPoi:function(a,b){if(!a&&Rtmap.Search.FocusResult)t.floor=Rtmap.Search.FocusResult.floor.toLowerCase(),t.x_coord=Rtmap.Search.FocusResult.x,t.y_coord=Rtmap.Search.FocusResult.y,t.Poi=Rtmap.Search.FocusResult.y;else{var e=a.feature?a.feature.properties:"";t.Poi=a;e?(t.floor=Rtmap.Scene.getNowFloor().toLowerCase(),t.x_coord=e.x_coord,t.y_coord=e.y_coord):(t.floor=a.floor.toLowerCase(),t.x_coord=a.x,t.y_coord=a.y)}(e=Rtmap.Scene.SelectMarker)?Rtmap.Scene.removeLayer(e,!0):"";Rtmap.Scene.SelectMarker=null;c(a,b);q.Poi==t.Poi&&d();q.Poi||b||!Page.wechat.getLocaler()||(e=Page.wechat.getLocaler(),q.Poi=e,q.floor=e.floor.toLowerCase(),q.x_coord=e.x,q.y_coord=e.y)},setEndPoiXY:function(b,d,e,f){t.floor=b.toLowerCase();t.x_coord=d;t.y_coord=e;t.Poi={};t.Poi.x=d;t.Poi.y=e;t.floor.y=b.toLowerCase();c();!q.Poi&&Page.wechat.getLocaler()&&(b=Page.wechat.getLocaler(),q.Poi=b,q.floor=b.floor.toLowerCase(),q.x_coord=b.x,q.y_coord=b.y);a(f)},getRoutePoints:function(){return y},getRequestData:function(){return N},resetTrackLine:function(){A&&A._map&&(f.Scene.removeLayer(A),f.Scene.addLayer(A));x&&x._map&&(f.Scene.removeLayer(x),f.Scene.addLayer(x));D&&D._map&&(f.Scene.removeLayer(D),f.Scene.addLayer(D));B&&B._map&&(f.Scene.removeLayer(B),f.Scene.addLayer(B));F&&F._map&&(f.Scene.removeLayer(F),f.Scene.addLayer(F))},drawCTrackLine:function(a,b,c){window.locationModel="free";Rtmap.Control.disableLocal();f.Scene.getNowFloor().toUpperCase()!=c.toUpperCase()?(window.Page.loading?window.Page.loading.show():"",f.Scene.changeFloorTo(c,null,function(){l(a,b,c)})):l(a,b,c)},getCTrackLine:function(){return F},requestTrackFromServer:a,clearCTrackLine:n,clearPath:function(){"";d();e();g();n();u={};K=!1;h("clearPath")},clearAll:function(){d();e();this.clearPath()}}}();f.Search=function(){function m(b,c){if(a[b])for(var e=0;e<a[b].length;e++)a[b][e].apply(this,c)}function c(a){for(var c={},e=a.length,f=0;f<e;f++){var h=a[f],m=h.floor.toLocaleLowerCase();c[m]||(c[m]=[]);c[m].push(h)}return c}var h={},a={};return{request:function(a,d){var e={};e.key=Rtmap.Config.getOption().Key;var g=f.Config.getOption().Token;g?e.access_token=g:"";e.buildid=Rtmap.Config.getOption().buildId;e.keywords=a.keyword;e.floor=Rtmap.Scene.getNowFloor().toUpperCase();e.pagesize="30";e.pageindex=a.searchPageIndex;g=h.x&&h.y?h:Rtmap.Scene.getCenter();e.refer_point={x:g.x.toString(),y:g.y.toString()};var l=(new Date).getTime();m("beforeSearch",[l]);$.ajax({type:"POST",url:"http://lbsapi.rtmap.com/rtmap_lbs_api/v1/rtmap/search_keywords",data:JSON.stringify(e)}).done(function(e){if("0"==e.result.error_code){var f=c(e.poilist||[]);d?d(f,e,a):""}else alert(e.result.error_msg)}).complete(function(c){try{var d=JSON.parse(c.responseText);d.searchType=a.searchType}catch(e){console.log(e)}m("afterSearch",[d,l])})},searchTwoClass:function(a,d){var e={};e.buildid=Rtmap.Config.getOption().buildId;e.key=Rtmap.Config.getOption().Key;e.pagesize="999";e.pageindex="1";e.floor=Rtmap.Scene.getNowFloor().toUpperCase();e.classid=a;var f=Rtmap.Scene.getMap().getBounds().getCenter();e.refer_point={x:f.lat.toString(),y:f.lng.toString()};$.ajax({url:"http://lbsapi.rtmap.com/rtmap_lbs_api/v1/search_classification",type:"post",dataType:"json",data:JSON.stringify(e),success:function(a){if("0"==a.result.error_code){var b=c(a.poilist||[]);d?d(b,a):""}else alert(a.result.error_msg)}})},on:function(b,c){a[b]||(a[b]=[]);a[b].push(c)},setSearchPoint:function(a,c){h.x=a;h.y=c}}}();f.Animate=function(){return function(f){function c(){var b=(new Date).getTime();L.Util.requestAnimFrame(function(){var d=(new Date).getTime();f(d-b);h||a||c()})}var h=!1,a=!1;this.run=function(){h=!1;c()};this.stop=function(){h=!0};this.clear=function(){a=!0}}}();f.Config=function(){var f={buildId:null,service:"WFS",version:"1.0.0",request:"getFeature",maxFeatures:5E3,outputFormat:"text/javascript",defalutFloor:"f1",key:null,labelStyle:"standard",loadModel:"server",largeScene:!1,scene:"",poiDetialType:"0",zoomAnimation:!0},c=[];return{setup:function(c){for(var a in c)f[a]=c[a]},getOption:function(){return f},setFloorData:function(f){c=f},getFloorData:function(){return c},getFloorAliasName:function(f){for(var a=0;a<c.length;a++)if(c[a].floor.toUpperCase()==f.toUpperCase()&&c[a].floor_alias)return c[a].floor_alias.toUpperCase();return f.toUpperCase()},getFloorDesc:function(f){for(var a=0;a<c.length;a++)if(c[a].floor.toUpperCase()==f.toUpperCase()&&c[a].desc)return c[a].desc;return""},getFloorSubject:function(f){for(var a=0;a<c.length;a++)if(c[a].floor.toUpperCase()==f.toUpperCase()&&c[a].floor_subject)return c[a].floor_subject;return""},getBuildingType:function(){if(f.buildId)return"1"==f.buildId.substring(12,13)?"airport":"market"}}}();f.Location=function(){var f={_call:function(c,a){var b=this[c];if(b)for(var d=0;d<b.length;d++)b[d].apply(this,a)}},c=null;return{_setLocationData:function(c){f._call("haveLocation",[c])},_startHandler:function(f){c?c(f):""},_stopHandler:function(c){stopHandler?stopHandler(c):""},start:function(f){window.SDK_Location?(c=f,SDK_Location.start()):f("This function need Rtmap Native APP SDK!")},stop:function(c){window.SDK_Location?(stopHandler=c,SDK_Location.stop()):c("This function need Rtmap Native APP SDK!")},on:function(c,a){f[c]||(f[c]=[]);f[c].push(a)}}}();f.FeatureSelect=function(){function f(b){var c="";0<b.layers.length&&(c=b.layers[0].feature.properties.name_chinese);a=c+"_"+b.centerPoint.x.toString()+"_"+b.centerPoint.y.toString();window.jsObj&&window.jsObj.HtmlSendCenterPointLocationInfo(c,b.centerPoint.x.toString(),b.centerPoint.y.toString());window.HtmlSendCenterPointLocationInfoForIOS&&window.HtmlSendCenterPointLocationInfoForIOS(c,b.centerPoint.x.toString(),b.centerPoint.y.toString())}var c=L.Class.extend({includes:L.Mixin.Events,options:{icon:L.divIcon({iconSize:[64,64],iconAnchor:[32,32],className:"leaflet-feature-selector"}),selectSize:[64,64],featureGroup:null},initialize:function(a,c){L.setOptions(this,c);this._map=a;this.options.selectSize=L.point(this.options.selectSize)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this._center=this._map.getCenter(),this.layers={},this._marker=L.marker(this._center).addTo(this._map),this._map.on("zoomend",this._zoomEnd,this),this._map.on("drag",this._drag,this),this._map.on("dragend",this._dragEnd,this),this.options.featureGroup.on("layeradd",function(a){this._checkIntersections()},this),this.options.featureGroup.on("layerremove",function(a){this._handleNoIntersection(a.layer);this._checkIntersections()},this))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.off("zoomend",this._zoomEnd,this),this._map.off("drag",this._drag,this),this._map.off("dragend",this._dragEnd,this),this._map.removeLayer(this._marker))},addHooks:function(){var a=this._map;a&&(L.DomUtil.disableTextSelection(),a.getContainer().focus());this._map._container.style.cursor="default"},removeHooks:function(){this._map&&L.DomUtil.enableTextSelection();this._map._container.style.cursor=""},_handleIntersection:function(a){this.layers[L.stamp(a)]||(this.layers[L.stamp(a)]=a,this.justSelected.push(a))},_handleNoIntersection:function(a){this.layers[L.stamp(a)]&&(delete this.layers[L.stamp(a)],this.justUnselected.push(a))},_checkIntersections:function(a){if(a){a=this._map.options.crs.project(this._center);var c,e;this.justSelected=[];this.justUnselected=[];var f=this._map.options.crs,h=L.point(a.x+this.options.selectSize.x/2,a.y-this.options.selectSize.y/2),m=L.point(a.x-this.options.selectSize.x/2,a.y+this.options.selectSize.y/2),h=f.projection.unproject(h),f=f.projection.unproject(m);c=L.latLngBounds(h,f);e=L.rectangle(c).toGeoJSON().geometry.coordinates[0];this.options.featureGroup.eachLayer(function(a){var b=a.feature.geometry.coordinates,f,g=!1;switch(a.feature.geometry.type){case "Point":b=[b];case "MultiPoint":for(f=0;f<b.length;f++)c.contains(L.latLng([b[f][1],b[f][0]]))&&(g=!0);break;case "LineString":b=[b];case "MultiLineString":for(f=0;f<b.length;f++)c.intersects(a.getBounds())&&this._lineStringsIntersect(e,b[f])&&(g=!0);break;case "Polygon":b=[b];case "MultiPolygon":var h=this._map.options.crs.project(this._center);for(f=0;f<b.length;f++)c.intersects(a.getBounds())&&this._pointInPolygon(h.x,h.y,b[f][0])&&(g=!0)}if(!g)for(f=0;f<this.justSelected.length;f++)if(this.justSelected[f]==a){g=!0;break}g?this._handleIntersection(a):this._handleNoIntersection(a)},this);this.fire("unselect",{layers:this.justUnselected,centerPoint:a});this.fire("select",{layers:this.justSelected,centerPoint:a})}},_lineStringsIntersect:function(a,c){for(var e=0;e<=a.length-2;++e)for(var f=0;f<=c.length-2;++f){var h=a[e][1],m=a[e][0],k=a[e+1][1],p=a[e+1][0],n=c[f][1],q=c[f][0],t=c[f+1][1],v=c[f+1][0],w=(t-n)*(m-q)-(v-q)*(h-n),y=(k-h)*(m-q)-(p-m)*(h-n),h=(v-q)*(k-h)-(t-n)*(p-m);if(0!==h&&(w/=h,y/=h,0<=w&&1>=w&&0<=y&&1>=y))return!0}return!1},_pointInPolygon:function(a,c,e){var f=!1,h,m,k;m=0;for(k=e.length-1;m<e.length;k=m++){h=e[m][0];var p=e[m][1],n=e[k][0];k=e[k][1];(h=p>c!==k>c&&a<(n-h)*(c-p)/(k-p)+h)&&(f=!f)}return f},_mouseMove:function(a){this._marker.setLatLng(a.latlng);this._center=a.latlng},_drag:function(a){this._center=this._map.getCenter();this._marker.setLatLng(this._center)},_dragEnd:function(a){this._center=this._map.getCenter();this._marker.setLatLng(this._center);this._checkIntersections(a)},_zoomEnd:function(a){this._center=this._map.getCenter();this._marker.setLatLng(this._center);this._checkIntersections(a)}}),h,a;return{initCenterPoint:function(){var a=Rtmap.Scene.getMap();h&&(h.off("select",f),h.disable());h=new c(a,{featureGroup:Rtmap.Scene.getLayer(),selectSize:[16,16]});h.enable();h.on("select",f)},getCenterPointLoctionInfo:function(){return a}}}();return window.Rtmap=f});function rgbToHex(){for(var f="#",m=0;m<arguments.length;m++)f+=arguments[m].toString(16);console.log(f)}(function(){var f=L.Polyline.prototype.onAdd,m=L.Polyline.prototype.onRemove,n=L.Polyline.prototype._updatePath,z=L.Polyline.prototype.bringToFront;L.Polyline.include({onAdd:function(c){f.call(this,c);this._textRedraw()},onRemove:function(c){if((c=c||this._map)&&this._textNode){var f=this._map._pathRoot;f||(f=this._renderer._container);f.removeChild(this._textNode)}m.call(this,c)},bringToFront:function(){z.call(this);this._textRedraw()},_updatePath:function(){n.call(this);this._textRedraw()},_textRedraw:function(){var c=this._text,f=this._textOptions;c&&this.setText(null).setText(c,f)},_createElement:function(c){return document.createElementNS("http://www.w3.org/2000/svg",c)},setText:function(c,f){this._text=c;this._textOptions=f;if(!L.Browser.svg||"undefined"===typeof this._map)return this;f=L.Util.extend({repeat:!1,fillColor:"black",attributes:{},below:!1},f);if(!c){if(this._textNode&&this._textNode.parentNode){var a=this._map._pathRoot;a||(a=this._renderer._container);a.removeChild(this._textNode);delete this._textNode}return this}c=c.replace(/ /g,"\u00a0");var b="pathdef-"+L.Util.stamp(this),a=this._map._pathRoot;a||(a=this._renderer._container);this._path.setAttribute("id",b);if(f.repeat){var d=this._createElement("text"),e;for(e in f.attributes)d.setAttribute(e,f.attributes[e]);d.appendChild(document.createTextNode(c));a.appendChild(d);var g=d.getComputedTextLength();a.removeChild(d);c=Array(Math.ceil(this._path.getTotalLength()/g)).join(c)}var d=this._createElement("text"),g=this._createElement("textPath"),l=f.offset||this._path.getAttribute("stroke-width");g.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+b);d.setAttribute("dy",l);for(e in f.attributes)d.setAttribute(e,f.attributes[e]);g.appendChild(document.createTextNode(c));d.appendChild(g);this._textNode=d;f.below?a.insertBefore(d,a.firstChild):a.appendChild(d);f.center&&(a=d.getComputedTextLength(),b=this._path.getTotalLength(),d.setAttribute("dx",b/2-a/2));if(this.options.clickable)for(!L.Browser.svg&&L.Browser.vml||g.setAttribute("class","leaflet-clickable"),L.DomEvent.on(d,"click",this._onMouseClick,this),a="dblclick mousedown mouseover mouseout mousemove contextmenu".split(" "),b=0;b<a.length;b++)L.DomEvent.on(d,a[b],this._fireMouseEvent,this);d.style.pointerEvents="none";return this}});L.LayerGroup.include({setText:function(c,f){for(var a in this._layers)"function"===typeof this._layers[a].setText&&this._layers[a].setText(c,f);return this}})})();(function(){try{var f=-1!=navigator.userAgent.indexOf("iPhone")?"iPhone":"Android";window.accessLogAppender=function(m,z){var c=(new Date).getTime();$.post("http://lbsapi.rtmap.com/rtmap_lbs_api/v1/rtmap/opt_log",JSON.stringify({key:z,timestamp:c,source:"\u673a\u573a",device_type:f,version:"3.0",opt:m}))}}catch(m){console.log(m)}})();window.Rtmap?"":window.Rtmap={};window.Rtmap.WechatLocation=function(){var f=Array(50),m=Array(50),n=Array(50),z=Array(50),c=null;-1!=navigator.userAgent.indexOf("iPhone")?window.DeviceMotionEvent&&window.DeviceOrientationEvent?(window.addEventListener("devicemotion",function(c){var a={};c=c.accelerationIncludingGravity;a.GravityX=c.x;a.GravityY=c.y;a.GravityZ=c.z;f.timestamp=(new Date).getTime();f.push(a);f.shift()},!1),window.addEventListener("deviceorientation",function(c){var a={};a.alpha=c.alpha;a.beta=c.beta;a.gamma=c.gamma;a.heading=c.webkitCompassHeading;a.accuracy=c.webkitCompassAccuracy;m.timestamp=(new Date).getTime();m.push(a);m.shift()},!0)):alert("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301"):-1!=navigator.userAgent.indexOf("Android")&&(window.DeviceMotionEvent&&window.DeviceOrientationEvent?(window.addEventListener("devicemotion",function(c){var a={};c=c.accelerationIncludingGravity;a.GravityX=c.x;a.GravityY=c.y;a.GravityZ=c.z;n.timestamp=(new Date).getTime();n.push(a);n.shift()},!1),window.addEventListener("deviceorientation",function(c){var a={};a.alpha=c.alpha;a.beta=c.beta;a.gamma=c.gamma;a.heading=c.webkitCompassHeading;a.accuracy=c.webkitCompassAccuracy;z.timestamp=(new Date).getTime();z.push(a);z.shift()},!0)):alert("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301"));return{prepare:function(f,a){a?c=a:"";window.wechat.onScanStart=function(a){};window.wechat.onScanSearch=function(a,c){var e={beacons:[]};if(-1!=navigator.userAgent.indexOf("iPhone")){var f=gSensor.getDiffStep(),h=gSensor.getStep(),n=0;0<f?n=1:"";window.wechat.param.locate_data.pdr={move_status:n,step:f};var k=window.compassStandard(m);window.wechat.param.locate_data.compass={standard:parseInt(k),average:parseInt(m[m.length-1].heading)};$("#show .step").html("\x3cp\x3e\u8ba1\u6b65\uff1a"+(f+n).toString()+"\u52a8\u9759\uff1a"+n.toString()+" \u89d2\u5ea6:"+((parseInt(m[m.length-1].heading)+window.getBuildAngle())%360).toString()+" \u65b0\u8ba1\u6b65:"+f+" \u603b\u6b65\u6570:"+h+"\x3c/p\x3e")}else if(-1!=navigator.userAgent.indexOf("Android")){f=gSensor.getDiffStep();h=gSensor.getStep();n=0;0<f?n=1:"";window.wechat.param.locate_data.pdr={move_status:n,step:f};var p=360-parseFloat(z[z.length-1].alpha),k=window.compassStandard(z);window.wechat.param.locate_data.compass={standard:parseInt(k),average:parseInt(p)};$("#show .step").html("\x3cp\x3e\u8ba1\u6b65\uff1a"+(f+n).toString()+"\u52a8\u9759\uff1a"+n.toString()+" \u89d2\u5ea6:"+((parseInt(p)+window.getBuildAngle())%360).toString()+" \u65b0\u8ba1\u6b65:"+f+" \u603b\u6b65\u6570:"+h+"\x3c/p\x3e")}for(f=0;f<a.beacons.length;f++)0!=a.beacons[f].rssi&&e.beacons.push(a.beacons[f]);if(0!=e.beacons.length){for(f=0;f<e.beacons.length-1;f++)for(h=0;h<e.beacons.length-1;h++)parseInt(e.beacons[h].rssi)<parseInt(e.beacons[h+1].rssi)&&(n=e.beacons[h],e.beacons[h]=e.beacons[h+1],e.beacons[h+1]=n);window.wechat.param.timestamp=(new Date).getTime();c(e)}};window.wechat.onPost=function(a){a.timestamp&&parseInt(a.timestamp)<parseInt(window.timeTmp)||(window.timeTmp=a.timestamp,c?c(a):"")};window.wechat.onScanStop=function(a){};window.wechat.onOverTime=function(){};window.wechat.init()}}}();(function(f){var m,n=[],z=[],c=0,h=0,a=0,b=[],d=[Array(6),Array(6)],e=[],g=-1;z[0]=-(1/19.6133*240);z[1]=-(1/60*240);f.countStep=function(a){for(var f,k=m=0;k<a.length;k++){f=a[k];var p=0,r;for(r in f)var q=240+f[r]*z[1],p=p+q;q=p/3;f=q>n[0]?1:q<n[0]?-1:0;if(f==-b[0]){p=0<f?0:1;d[p][0]=n[0];var t=Math.abs(d[p][0]-d[1-p][0]);if(10<t){var v=e[0]>t/3,w=g!=1-p;t>2*e[0]/3&&v&&w?(c=(new Date).getTime(),300<c-h&&(m++,g=p,h=c)):g=-1}e[0]=t}b[0]=f;n[0]=q}return m};f.moveStatus=function(a){if(a.length){for(var b=0,c=0,d=0;d<a.length;d++){var e=0;if(a[d]){a[d].sq=0;for(var f in a[d])var g=parseFloat(a[d][f]),e=e+g*g;b+=Math.sqrt(e);a[d].sq=Math.sqrt(e)}}b/=a.length;for(d=0;d<a.length;d++)e=0,e=a[d].sq-b,c+=Math.pow(e,2);c/=a.length;return.2<c?1:0}return 1};f.compassStandard=function(a){function b(a){var c=0,d=0;null!=a[0]&&(d=parseFloat(a[0].alpha));for(var e=0;e<a.length;e++)if(a[e]){var f=parseFloat(a[e].alpha)-d;180<f?f-=360:180>f&&(f+=360);c+=f+d}c/=a.length;0>c&&(c+=360);return c}function c(a,b){for(var d=0,e=0,f=0;f<a.length;f++)null!=a[f]&&(e=a[f].alpha-b,0>e&&(e=-e),180<e&&(e-=360),0>e&&(e=-e)),d+=e*e;d/=a.length;return Math.sqrt(d)}if(a.length){var d=b(a);return c(a,d)}return 127};f.initBuildAngle=function(b){b=Page.URL.getParameter("buildid");var c=Page.URL.getParameter("key"),d=[];d.push(b);$.ajax({type:"post",url:"http://lbsapi.rtmap.com/rtmap_lbs_api/v1/rtmap/build_angle",dataType:"json",data:JSON.stringify({key:c,buildid_list:d})}).done(function(b){b.build_angle_list&&(a=b.build_angle_list[0].angle)})};f.getBuildAngle=function(){return a?parseInt(a):0}})(window);window.gSensor=function(){var f=[],m=[],n=0,z=!1,c=0,h=0,a=!1,b=0,d=0,e=0,g=0,l=0,E=0,k=0,p=2,r=0,q=0,t=0;window.addEventListener("devicemotion",function(w){f.splice(0,f.length);w=w.accelerationIncludingGravity;f.push(w.x);f.push(w.y);f.push(w.z);w=E=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);if(0==k)k=w;else{var y;y=k;a=z;w>=y?(z=!0,c++):(h=c,c=0,z=!1);!z&&a&&(2<=h||20<=y)?(b=y,y=!0):(!a&&z&&(d=y),y=!1);if(y&&(g=e,l=(new Date).getTime(),250<=l-g&&b-d>=p&&(e=l,r++,t=r-q),250<=l-g&&1.3<=b-d)){e=l;y=b-d;var u=p;if(4>n)m[n]=y,n++;else{for(var x=u=0;4>x;x++)u+=m[x];u/=4;u=8<=u?4.3:7<=u&&8>u?3.3:4<=u&&7>u?2.3:3<=u&&4>u?2:1.3;for(x=1;4>x;x++)m[x-1]=m[x];m[3]=y}p=u}}k=w;(w=document.getElementById("step"))?w.innerHTML=gSensor.getStep():"";v?v(r):""},!1);var v=null;return{setCallback:function(a){v=a},getDiffStep:function(){t=r-q;q=r;return t},getStep:function(){return r}}}();var RTMAP_MAP_COLOR_CONFIG_ZHIHUITU={imageData:{},globalData:{canvas_color:"#ffffff",font_color:"#872406",start_icon_url:"",end_icon_url:"",focus_icon_url:"",normal_icon_url:""},colorData:{0:{type:0,fillColor:"#ffffff",color:"#777777",weight:.5,opacity:1,fillOpacity:1},1:{type:1,fillColor:"#ffffff",color:"#777777",weight:.5,opacity:1,fillOpacity:1},2:{type:2,fillColor:"#f6f6f6",color:"#777777",weight:.5,opacity:1,fillOpacity:1},3:{type:3,fillColor:"#e8e8e8",color:"#777777",weight:.5,opacity:1,fillOpacity:1},4:{type:4,fillColor:"#f4f4f4",color:"#777777",weight:.5,opacity:1,fillOpacity:1},5:{type:5,fillColor:"#d8e0ca",color:"#97a869",weight:.5,opacity:1,fillOpacity:1,hover:{fillColor:"#dddddd",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1}},6:{type:6,fillColor:"#ead6d6",color:"#ba9d9d",weight:.5,opacity:1,fillOpacity:1},7:{type:7,fillColor:"#efefef",color:"#6e6e6e",weight:.5,opacity:1,fillOpacity:1},8:{type:8,fillColor:"#cccccb",color:"#878c93",weight:1,opacity:.9,fillOpacity:0},9:{type:9,fillColor:"#fffffa",color:"#777777",weight:.5,opacity:1,fillOpacity:1},10:{type:10,fillColor:"#d0dee2",color:"#8eabc1",weight:.5,opacity:1,fillOpacity:1},11:{type:11,fillColor:"#f7ebe2",color:"#828282",weight:.5,opacity:1,fillOpacity:1,dashArray:"3"},12:{type:12,fillColor:"#efefef",color:"#6e6e6e",weight:.5,opacity:1,fillOpacity:1},13:{type:13,fillColor:"#fffbf0",color:"#a0a0a0",weight:.5,opacity:0,fillOpacity:0},14:{type:14,fillColor:"#fffbf0",color:"#a0a0a0",weight:.5,opacity:0,fillOpacity:0},15:{type:15,fillColor:"#fffbf0",color:"#a0a0a0",weight:.5,opacity:0,fillOpacity:0}}},RTMAP_MAP_COLOR_CONFIG_001=[{type:0,fillColor:"#ffffff",color:"#777777",weight:.5,opacity:1,fillOpacity:1},{type:1,fillColor:"#ffffff",color:"#777777",weight:.5,opacity:1,fillOpacity:1},{type:2,fillColor:"#f6f6f6",color:"#777777",weight:.5,opacity:1,fillOpacity:1},{type:3,fillColor:"#f1fcfe",color:"#f1fcfe",weight:.5,opacity:1,fillOpacity:1},{type:4,fillColor:"#f4f4f4",color:"#777777",weight:.5,opacity:1,fillOpacity:1},{type:5,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1,hover:{fillColor:"#dddddd",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1}},{type:6,fillColor:"#ead6d6",color:"#ba9d9d",weight:.5,opacity:1,fillOpacity:1},{type:7,fillColor:"#efefef",color:"#6e6e6e",weight:.5,opacity:1,fillOpacity:1},{type:8,fillColor:"#cccccb",color:"#dfe7e0",weight:.5,opacity:1,fillOpacity:0},{type:9,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1},{type:10,fillColor:"#f1fcfe",color:"#f1fcfe",weight:.5,opacity:1,fillOpacity:1},{type:11,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1},{type:12,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:1,fillOpacity:1},{type:13,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:0,fillOpacity:0},{type:14,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:0,fillOpacity:0},{type:15,fillColor:"#fffbf0",color:"#e9bbba",weight:.5,opacity:0,fillOpacity:0}];window.Rtmap?"":window.Rtmap={};window.Rtmap.Locales?"":window.Rtmap.Locales={};(function(){var f="zh",m={start:"\u4ece\u8fd9\u51fa\u53d1",end:"\u5230\u8fd9\u53bb",starterrorinfo:"\u8d77\u70b9\u4e0d\u80fd\u4e3a\u7a7a",enderrorinfo:"\u7ec8\u70b9\u4e0d\u80fd\u4e3a\u7a7a",clear:"\u6e05\u9664",clearHistory:"\u6e05\u7a7a\u5386\u53f2",detail:"\u8be6\u60c5",selectfrommap:"\u5730\u56fe\u9009\u70b9",search:"\u641c\u7d22",routeplan:"\u8def\u7ebf\u89c4\u5212",searchtip:"\u641c\u7d22\u5e97\u94fa",toilet:"\u536b\u751f\u95f4",doorway:"\u51fa\u5165\u53e3",elevator:"\u76f4\u68af",information:"\u95ee\u8baf",escalator:"\u6276\u68af",restaurant:"\u9910\u996e",shopping:"\u5546\u4e1a",charger:"\u5145\u7535\u8bbe\u5907"},n={start:"Start Point",end:"End Point",starterrorinfo:"please select start point",enderrorinfo:"please select end point",clear:"Clear",clearHistory:"Clear History",detail:"Detail",selectfrommap:"Select from map",routeplan:"Route Planning",searchtip:"Search",search:"Search",toilet:"Toilet",doorway:"Door Way",elevator:"Elevator",escalator:"Escalator",information:"Information",restaurant:"Restaurant",shopping:"Shopping",charger:" Charging"};window.Rtmap.Locales={setlanguage:function(m){f=m},getlanguage:function(){return f},getFormatValue:function(z){return"en"==f?n[z]:m[z]}}})();var Page=window.Page||{},debugTools=!1,locationModel="follow";function initializeLocalColorConfig(){var f=RTMAP_MAP_COLOR_CONFIG_ZHIHUITU.globalData,m=RTMAP_MAP_COLOR_CONFIG_ZHIHUITU.imageData,n=RTMAP_MAP_COLOR_CONFIG_ZHIHUITU.colorData;for(i in n){var z=n[i];Rtmap.Style.setPoiDefaultStyle(z.type,z)}Rtmap.Style.setImageConfig(m);Rtmap.Style.setGlobalConfig(f)}(function(f){f.URL={getParameter:function(f,n){return decodeURIComponent(((new RegExp("[?|\x26]"+f+"\x3d([^\x26;]+?)(\x26|#|;|$)")).exec(n||location.search)||[,""])[1].replace(/\+/g,"%20"))||null}}})(window.Page);var lang=Page.URL.getParameter("lang");Rtmap.Locales?Rtmap.Locales.setlanguage(lang):"";(function(f){var m={};f.controllerHelper={up:function(f){m[f]=!0},down:function(f){delete m[f];for(var z in m);}}})(window.Page);(function(f){function m(c,f){if(Rtmap.Scene.getAllowPoiSelected())if(f){var a=Rtmap.Scene.SelectMarker;a?Rtmap.Scene.removeLayer(a,!0):"";Page.Tip.show({layer:f,poiName:"en"==Rtmap.Locales.getlanguage()?f.feature.properties.name_english:f.feature.properties.name_chinese,parentDOM:$("#infoBox"),start:function(){Rtmap.TrackFactory.setStartPoi(f)},end:function(){Rtmap.TrackFactory.setEndPoi(f)}});a=Rtmap.Style.getGlobalConfig("focus_icon_url");a=L.icon({iconUrl:a,iconRetinaUrl:a,iconSize:[30,30],iconAnchor:[15,30],shadowSize:[68,95],shadowAnchor:[22,94]});a=Rtmap.Scene.createMarker({x:f.feature.properties.x_coord,y:f.feature.properties.y_coord,icon:a});a.selected=!0;Rtmap.Scene.SelectMarker=a}else Page.Tip.close()}var n=function(){return{getShow:function(c){var f=$("\x3cdiv/\x3e",{"class":"alertBox"});f.text(c);$("body").append(f);return f},clearShow:function(c){c&&c.remove()}}}(),z=function(){function c(a){a.animate({opacity:.01},500,function(){a.html("").remove().css({opacity:1})})}var f=null;return{show:function(a,b){f=$("\x3cdiv/\x3e",{"class":"dialog_label"});var d=$("\x3cdiv/\x3e",{"class":"content",text:a});f.html("").css({opacity:1}).append(d);$("body").append(f);height=d[0].scrollHeight;d.css({"margin-top":-height/2+"px"});d.css({"text-shadow":"0 0 0"});b&&function(){var a=f;setTimeout(function(){c(a)},b)}();return f},close:c}}();f.Controller={bindGlobalEvent:function(){Rtmap.DataProvider.getBuildInfo({},function(c){if(c){Rtmap.FloorControl?Rtmap.FloorControl.setData(c.floorinfo):"";Rtmap.Config.setFloorData(c.floorinfo);var a=Rtmap.Scene.getNowFloor(),b=Rtmap.Config.getFloorAliasName(a),a=Rtmap.Config.getFloorSubject(a);a||($(".rtmap_floor_btn").css({"line-height":"43px","font-size":"25px",width:"50px",height:"50px"}),$(".rtmap_floor_change_list").css({width:"36px","margin-left":"6.5px","font-size":"15px"}),$(".rtmap_floor_change_list").find(".list_scroll").css({"margin-left":"-2px"}));$(".rtmap_floor_btn").html(b+"\x3c/br\x3e\x3ci class\x3d'floor_subject_btn'\x3e"+a+"\x3c/i\x3e");(b=Rtmap.Control.getFloorChangeControl())?b.setData(c.floorinfo):"";$("\x3cdiv/\x3e",{text:c.name_chn,"class":"build_name"});(b=Rtmap.Config.getOption().title)||(b="en"!=Rtmap.Locales.getlanguage()?c.name_chn:c.name_en);c="\u641c\u7d22\u5e97\u94fa";Rtmap.Locales?c=Rtmap.Locales.getFormatValue("searchtip"):"";$(".searchInput").attr("placeholder",c+" @"+b);$("title[class\x3dbdn]").html(b)}});var c=!1;Page.SearchControl&&(Page.SearchControl.on("changeToNearFloor",function(f){c=!0;Page.SearchControl.changeToFloor=f.toUpperCase();Page.SearchControl.isChangeToNearFloor=!0}),Page.SearchControl.on("markerSearchToMap",function(f,a){function b(){Page.SearchControl.clearSearchResult()}function d(){l?Rtmap.Scene.addLayer(l):"";for(var b=0;b<a.length;b++)if(a[b].selected){l=a[b];Rtmap.Scene.removeLayer(a[b]);break}}function e(a){Page.Tip.show({layer:Rtmap.Scene.getPoiByNum(a.floor,a.poi_no),poiName:a.name,parentDOM:$("#infoBox"),start:function(){var b=Rtmap.Scene.getPoiByNum(a.floor,a.poi_no);d();Rtmap.TrackFactory.setStartPoi(b)},end:function(){var b=Rtmap.Scene.getPoiByNum(a.floor,a.poi_no);d();Rtmap.TrackFactory.setEndPoi(b)},data:a})}Page.ClearBtn.show("Search");Page.ClearBtn.removeEvent(b);Page.ClearBtn.addEvent(b);for(var g=0;g<a.length;g++)(function(){var b=f[g];a[g].on("click",function(){e(b)})})();c||e(f[0]);c=!1;var l;Page.ClearBtn.addEvent(function(){Page.Tip.close()});Rtmap.TrackFactory.getTrackStatus()&&(Rtmap.TrackFactory.clearPath(),Page.controllerHelper.down("TrackDashboard"),Page.TrackDashboard.close())}),Page.SearchControl.on("searchFocus",function(c){Page.Tip.closeCusDetail()}),Page.SearchControl.on("categoryBtn",function(c){Page.Tip.closeCusDetail()}),Page.SearchControl.on("searchBtn",function(c){Page.Tip.closeCusDetail()}),Page.SearchControl.on("clearSearchResult",function(c){Rtmap.TrackFactory.getTrackStatus()||Page.ClearBtn.close("Search")}));(function(){var c={};Rtmap.Search.on("beforeSearch",function(a){c[a]=Page.Controller.DialogLabel.show("\u6b63\u5728\u641c\u7d22...")});Rtmap.Search.on("afterSearch",function(a,b){Page.Controller.DialogLabel.close(c[b]);(!a.poilist||1>a.poilist.length)&&Page.Controller.DialogLabel.show("\u6ca1\u6709\u627e\u5230\u76f8\u5173\u5e97\u94fa\u6216\u8bbe\u65bd",1E3)})})();Rtmap.Scene.off("poiClick",m);Rtmap.Scene.on("poiClick",m)},initMap:function(){var c=Rtmap.Config.getOption().defaultFloor;Rtmap.Scene.changeFloorTo(c)},AlertLabel:n,DialogLabel:z}})(window.Page);(function(f){var m=!1,n=[],z={},c=$('\x3cdiv class\x3d"clearBtn clearSearch"\x3e\x3cimg src\x3d"static/public/img/cleanup.png"\x3e\x3c/div\x3e'),h={};c.click(function(){for(var a in z)z[a]();for(a=0;a<n.length;a++)n[a]();m||(n.length=0);$(".tip_box").hide()});f.ClearBtn={show:function(a){h[a]=0;m=!0;$(".top_right_bar").append(c);c.show();$(".top_right_bar").hide()},addEvent:function(a){n.push(a)},removeEvent:function(a){for(var b=0;b<n.length;b++)if(n[b].name==a.name){n.splice(b,1);break}},bind:function(a,b){z[a]=b},close:function(a){delete h[a];a=!1;for(var b in h)a=!0;a||(m=!1,c.hide())}}})(window.Page);(function(f){function m(a){var b="",d="",e="",f="",g="";if(a){a.poi_image&&(b='\x3cdiv class\x3d"group"\x3e\x3cimg class\x3d"poi_image" src\x3d"'+a.poi_image+'" /\x3e\x3c/div\x3e');a.poi_descript&&(d='\x3cdiv class\x3d"group"\x3e\x3cp\x3e'+a.poi_descript+"\x3c/p\x3e\x3c/div\x3e");a.support_currecy&&(f='\x3cp class\x3d"poi_phone_list"\x3e\x3cspan\x3e\u652f\u6301\u8d27\u5e01:\x3c/span\x3e\x3cspan class\x3d"poi_phone"\x3e'+(a.support_currecy||"")+"\x3c/span\x3e\x3c/p\x3e");a.more&&(e='\x3ca class\x3d"more"\x3e\u66f4\u591a...\x3c/a\x3e');if(a.phone_number)for(var h=a.phone_number.split(","),k=0;k<h.length;k++)g+='\x3ca href\x3d"tel:'+h[k]+'"\x3e'+h[k]+"\x3c/a\x3e \x26nbsp;";r='\x3cdiv class\x3d"cus_detail"\x3e\x3cdiv class\x3d"detail_box"\x3e\x3cdiv class\x3d"poi_info"\x3e\x3cdiv class\x3d"group"\x3e\x3cdiv class\x3d"poi_logo"\x3e'+(a.poi_logo?"\x3cimg src\x3d"+a.poi_logo+"\x3e":"")+'\x3c/div\x3e\x3cspan class\x3d"poi_title"\x3e'+(a.poi_name||"")+'\x3c/span\x3e\x3cp class\x3d"poi_address_list"\x3e\x3cspan\x3e\u5730\u5740\uff1a\x3c/span\x3e\x3cspan class\x3d"poi_address"\x3e'+(a.poi_address||"")+'\x3c/span\x3e\x3c/p\x3e\x3cp class\x3d"poi_phone_list"\x3e\x3cspan\x3e\u7535\u8bdd\uff1a\x3c/span\x3e\x3cspan class\x3d"poi_phone"\x3e'+g+'\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"group"\x3e\x3cp class\x3d"poi_address_list"\x3e\x3cspan\x3e\u5206\u7c7b\uff1a\x3c/span\x3e\x3cspan class\x3d"poi_address"\x3e'+(a.business_type||"")+'\x3c/span\x3e\x3c/p\x3e\x3cp class\x3d"poi_phone_list"\x3e\x3cspan\x3e\u8425\u4e1a\u65f6\u95f4\uff1a\x3c/span\x3e\x3cspan class\x3d"poi_phone"\x3e'+(a.business_time||"")+"\x3c/span\x3e\x3c/p\x3e"+f+"\x3c/div\x3e"+b+d+e+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}q?q.remove():"";a?(q=$(r),q.find(".more").click(function(){c(a.more)})):q=""}function n(a){t?z():(m(a),t=!0,$("body .detail_content").append(q),b.find(".detail_enter").find("i").removeClass("fa-angle-up").addClass("fa-angle-down"))}function z(){b.find(".detail_enter").find("i").removeClass("fa-angle-down").addClass("fa-angle-up");t=!1;q?q.remove():""}function c(a){d.html("").append('\x3cdiv class\x3d"back"\x3e\x3ci class\x3d"fa fa-close"\x3e\x3c/i\x3e\x3c/div\x3e\x3ciframe src\x3d""\x3e\x3c/iframe\x3e');d.find(".back").click(function(){d.remove()});d.find("iframe").attr("src",a);$("body").append(d)}function h(){if(l&&l.feature&&!l.ParkingStatus){var a=Rtmap.Classification.getLayerStyle(l);l.setStyle&&l.setStyle(a)}}function a(a){if(a.layer){var c=a.layer.feature.properties;z();if(Rtmap.Config.getOption().vendorDetailUrl)if("1"!=Rtmap.Config.getOption().poiDetialType)Page.PoiDetail.getVendorDetail(c,function(a){"0"==a.result.error_code&&(a.url?(b.find(".detail_enter").show(),b.find(".detail_enter").data("url",a.url),b.find(".detail_enter").data("type",a.type),b.find(".detail_enter").data("data",c)):0==c.classify_attr?b.find(".detail_enter").data("url",null).hide():b.find(".detail_enter").data("url",null).data("data",c).show())});else{if(5==c.style&&(a=Rtmap.Scene.getNowFloor(),!(-1<Rtmap.Config.getFloorDesc(a).indexOf("\u505c\u8f66\u573a")))){a=Rtmap.Config.getOption().vendorDetailUrl;Rtmap.Config.getOption();a=c.floor;var d=c.poi_no;a=Rtmap.Config.getOption().vendorDetailUrl+"\x26floor\x3d"+a.toLowerCase()+"\x26store\x3d"+d;b.find(".detail_enter").show();b.find(".detail_enter").data("url",a);b.find(".detail_enter").data("type","html");b.find(".detail_enter").data("data",c)}}else c.classify_attr&&0!=c.classify_attr?b.find(".detail_enter").data("url",null).data("data",c).show():b.find(".detail_enter").hide().data("url",null).data("data","")}}var b=$("\x3cdiv/\x3e",{"class":"tip_box"}),d=$("\x3cdiv/\x3e",{"class":"detail_Tip"}),e=null,g=null,l=null,E="\u4ece\u8fd9\u91cc\u51fa\u53d1",k="\u53bb\u8fd9\u91cc",p="\u8be6\u60c5";Rtmap.Locales?E=Rtmap.Locales.getFormatValue("start"):"";Rtmap.Locales?k=Rtmap.Locales.getFormatValue("end"):"";Rtmap.Locales?p=Rtmap.Locales.getFormatValue("detail"):"";var r=null,q=null,t=!1;b.append('\x3cdiv class\x3d"top_bar"\x3e\x3cdiv class\x3d"title"\x3e\x3c/div\x3e\x3ci class\x3d"fa fa-close close"\x3e\x3c/i\x3e\x3cdiv class\x3d"detail_enter"\x3e\x3ci class\x3d"fa fa-angle-up"\x3e\x3c/i\x3e'+p+'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"detail_content"\x3e\x3c/div\x3e\x3cdiv class\x3d"btn_bar"\x3e\x3cdiv class\x3d"start"\x3e\x3ci class\x3d"fa fa-long-arrow-up"\x3e\x3c/i\x3e'+E+'\x3c/div\x3e\x3cdiv class\x3d"end"\x3e\x3ci class\x3d"fa fa-long-arrow-down"\x3e\x3c/i\x3e'+k+"\x3c/div\x3e\x3c/div\x3e");b.find(".close").click(function(){h();f.Tip.close()});b.find(".start").click(function(){e?e():"";b.hide();Page.Tip.set("all");h();f.Tip.close();Page.ClearBtn.show("Track");Page.ClearBtn.bind("clearPath",function(){Rtmap.TrackFactory.clearPath();Page.controllerHelper.down("Tip");Page.RoutePlan.reset();Page.Tip.set("all")});window.Page.RoutePlan&&(l.feature?window.Page.RoutePlan.show({x:l.feature.properties.x_coord,y:l.feature.properties.y_coord,floor:Rtmap.Scene.getNowFloor().toLowerCase(),poi_no:l.feature.properties.poi_no,name:"en"==Rtmap.Locales.getlanguage()?l.feature.properties.name_english:l.feature.properties.name_chinese,type:"start"}):window.Page.RoutePlan.show({x:l.x,y:l.y,floor:l.floor.toLowerCase(),poi_no:l.poi_no,name:l.name,type:"start"}))});b.find(".end").click(function(){g?g():"";b.hide();Page.Tip.set("all");h();f.Tip.close();Page.ClearBtn.show("Track");Page.ClearBtn.bind("clearPath",function(){Rtmap.TrackFactory.clearPath();Page.controllerHelper.down("Tip")});window.Page.RoutePlan&&(l.feature?window.Page.RoutePlan.show({x:l.feature.properties.x_coord,y:l.feature.properties.y_coord,floor:Rtmap.Scene.getNowFloor().toLowerCase(),poi_no:l.feature.properties.poi_no,name:"en"==Rtmap.Locales.getlanguage()?l.feature.properties.name_english:l.feature.properties.name_chinese,type:"end"}):window.Page.RoutePlan.show({x:l.x,y:l.y,floor:l.floor.toLowerCase(),poi_no:l.poi_no,name:l.name,type:"end"}))});b.find(".detail_enter").click(function(){Page.SearchControl?Page.SearchControl.hideCategory():"";var a=$(this).data("url"),b=$(this).data("type"),d=$(this).data("data");a?"html"==b?c(a):"button"==b&&(d.classify_attr?Page.PoiDetail.getDetailData(d,function(b,c){b||(c.more=a,n(c))}):n({more:a,poi_name:d.name_chinese})):Page.PoiDetail.getDetailData(d,function(a,b){a||n(b)})});Rtmap.TrackFactory.on("drawPath",function(a,b){Page.SearchControl?Page.SearchControl.clearSearchResult():"";b&&window.setTimeout(function(){Rtmap.TrackFactory.getCTrackLine()?Rtmap.TrackFactory.getCTrackLine().willNoFit&&Rtmap.Scene.getMap().fitBounds(b.getBounds().pad(.2)):Rtmap.Scene.getMap().fitBounds(b.getBounds().pad(.2))},350)});Rtmap.TrackFactory.on("clearPath",function(){Page.ClearBtn.close("Track");Page.controllerHelper.down("TrackDashboard")});Rtmap.TrackFactory.on("needStartPoi",function(){Page.Controller.DialogLabel.show("\u8bf7\u9009\u62e9\u8d77\u70b9",1E3)});(function(){Rtmap.TrackFactory.on("beforeRequest",function(a){});Rtmap.TrackFactory.on("afterRequest",function(){})})();f.Tip={show:function(c){Page.controllerHelper.up("Tip");h();(l=c.layer)?l.ParkingStatus||(l.setStyle?l.setStyle(Rtmap.Style.getOverStyle()):""):l=c.data;Page.SearchControl&&(b.show(),b.find(".title").text(c.poiName),b.find(".detail_enter").hide(),a(c),e=c.start,g=c.end,$("body").append(b),$(".dashboardList").hide())},set:function(a){var c=b.find(".end"),d=b.find(".start");switch(a){case "start":c.hide();d.show().css({width:"100%"});break;case "end":c.show().css({width:"100%"});d.hide();break;default:d.show().css({width:"50%",display:"inline-block"}),c.show().css({width:"50%",display:"inline-block"})}Page.controllerHelper.down("Tip")},close:function(){var a=Rtmap.Scene.SelectMarker;a?Rtmap.Scene.removeLayer(a,!0):"";h();$(".dashboardList").show();b.hide();z();Page.controllerHelper.down("Tip")},closeCusDetail:z}})(window.Page);(function(f){f.PoiDetail={getDetailData:function(f,n){$.ajax({type:"post",url:"http://lbsapi.rtmap.com:8080/rtmap_lbs_api/v1/rtmap/classify_poiinfo",data:JSON.stringify({key:Page.URL.getParameter("key"),buildid:Rtmap.Config.getOption().buildId,floor:f.floor||"F2",poi_no:f.poi_no||"75",classify_id:f.classify_attr||"1"})}).done(function(f){0==f.result.error_code&&(n?n(null,f.poiinfo):"");n?n(f.result.error_msg):""})},getVendorDetail:function(f,n){$.ajax({type:"get",url:Rtmap.Config.getOption().vendorDetailUrl,data:{buildid:f.id_build,floor:f.floor,poi_no:f.poi_no},jsonp:"callback",jsonpCallback:"handler",dataType:"jsonp"}).done(function(f){n?n(f):""})}}})(Page);(function(){window.hashDirection={1:["static/public/img/straight.png","\u76f4\u884c"],2:["static/public/img/right_front.png","\u53f3\u524d"],3:["static/public/img/right.png","\u53f3\u8f6c"],4:["static/public/img/right_rear.png","\u53f3\u540e"],5:["static/public/img/left_rear.png","\u5de6\u540e"],6:["static/public/img/left.png","\u5de6\u8f6c"],7:["static/public/img/left_front.png","\u5de6\u524d"],8:["static/public/img/elevator_up.png","\u4e0a\u76f4\u68af"],9:["static/public/img/elevator_down.png","\u4e0b\u76f4\u68af"],10:["static/public/img/stair_up.png","\u4e0a\u6276\u68af"],11:["static/public/img/stair_down.png","\u4e0b\u6276\u68af"]}})();(function(){window.__onTrackSuccess=function(f){1!=f.pointlist.length&&(window.__store=f,locationModel="free",Rtmap.Control.disableLocal())}})();